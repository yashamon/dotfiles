!function o(a,s,u){function l(t,e){if(!s[t]){if(!a[t]){var i="function"==typeof require&&require;if(!e&&i)return i(t,!0);if(c)return c(t,!0);var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}var r=s[t]={exports:{}};a[t][0].call(r.exports,function(e){return l(a[t][1][e]||e)},r,r.exports,o,a,s,u)}return s[t].exports}for(var c="function"==typeof require&&require,e=0;e<u.length;e++)l(u[e]);return l}({1:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.prepareFloatVideoInAdvance=d,i.default=function(e,t){if(e)a||d(),h||(document.getElementById("listener").appendChild(s),function(){if(!s)return;s.style.position="absolute",s.style.left=p+"px",s.style.top=m+"px",s.style.width=f+"px",s.style.height=v+"px"}(),h=!0),a.onViewUpdate({viewRenderType:1,activeView:{userID:t.userList[0].userID},viewSubType:r.default.getVideoUserById(t.userList[0].userID).isMyself?1:2}),t.canPin?s.classList.add("canShowPin"):s.classList.remove("canShowPin");else{if(!a||!h)return;h=!1,a.clearAll(),s.remove(),document.querySelectorAll("."+u).forEach(function(e){return e.remove()})}},i.resetCacheSizePositionToDefault=y,i.getFloatVideoCachePostion=function(){return{top:m,left:p,width:f,height:v}},i.setFloatVideoCachePosition=function(e){m=void 0!==e.top?e.top:m,p=void 0!==e.left?e.left:p,f=void 0!==e.width?e.width:f,v=void 0!==e.height?e.height:v},i.drawFloatVideoFrame=function(e){a&&a.drawVideoFrame(e)},i.getRenderedVideoUserList=function(){return a&&a.getRenderedVideoUserList()},i.getFloatScreenWindow=function(){return a},i.getIsRenderingFloatVideo=function(){return h};var n=o(e("./rendererMgr.js")),r=(o(e("./class/ViewElement/baseViewElmt.class")),o(e("./videoUserListMgr.js")));function o(e){return e&&e.__esModule?e:{default:e}}var a=void 0,s=void 0,u="float-video-container",l="attendee",c="drag-resize";function d(){var e,t=((e=e||{}).maxWidth=g.getConstants().FLOAT_VIDEO_MAX_WIDTH,e.maxHeight=9*g.getConstants().FLOAT_VIDEO_MAX_WIDTH/16,e.container=document.createElement("div"),e.container.style.zIndex=40,e.container.classList.add(u),e.container.classList.add(l),e.container.classList.add(c),e.container.innerHTML='   <div class="crop-line crop-top-line" data-dir="u"></div>\n   <div class="crop-line crop-right-line" data-dir="r"></div>\n   <div class="crop-line crop-bottom-line" data-dir="d"></div>\n   <div class="crop-line crop-left-line" data-dir="l"></div>\n   <div class="crop-corner crop-top-left-corner" data-dir="lu"></div>\n   <div class="crop-corner crop-top-right-corner" data-dir="ru"></div>\n   <div class="crop-corner crop-bottom-right-corner" data-dir="rd"></div>\n   <div class="crop-corner crop-bottom-left-corner" data-dir="ld"></div>\n',s=e.container,e);a=n.default.getFloatVideoScreenWindow(t)}window.eev&&window.eev.on(g.getConstants().CONF_STR.CONF_READY,y);var h=!1;var f=214,v=120,p=screen.width-f-30,m=200;function y(){f=214,v=120,p=screen.width-f-30,m=200}},{"./class/ViewElement/baseViewElmt.class":5,"./rendererMgr.js":30,"./videoUserListMgr.js":32}],2:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.MicDevice=i.CameraDevice=i.ChromeSpeakerDevice=i.Device=void 0;var n,r=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),o=e("../deviceMgr"),a=(n=o)&&n.__esModule?n:{default:n};function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var c=i.Device=function(){function t(e){l(this,t),this._kind=e.kind,this._deviceId=e.deviceId,this._label=e.label,this._originalName=e.originalName,this._groupId=e.groupId||"",this._isSystemDefault=e.isSystemDefault||0,this._isManualSelected=e.isManualSelected||0,this._isRemoved=e.isRemoved||0,this._hasNotifyWeb=e.hasNotifyWeb||1}return r(t,[{key:"_saveId",value:function(){switch(this._kind){case"audioinput":saveToLocal("lastMicrophoneDeviceId",this._deviceId);break;case"audiooutput":saveToLocal("lastSpeakerDeviceId",this._deviceId);break;case"videoinput":saveToLocal("lastCameraDeviceId",this._deviceId)}}},{key:"_saveManualSelection",value:function(){var e=this.toInfo();switch(this._kind){case"audioinput":saveToLocal("manualSelectMic",e);break;case"audiooutput":saveToLocal("manualSelectSpk",e);break;case"videoinput":saveToLocal("manualSelectCam",e)}}},{key:"toInfo",value:function(e){return{kind:this._kind,deviceId:this._deviceId,label:this._label,originalName:this._originalName,groupId:this._groupId,selected:e||0,manualSelected:this._isManualSelected,isRemoved:this._isRemoved,hasNotifyWeb:this._hasNotifyWeb}}},{key:"kind",get:function(){return this._kind},set:function(e){this._kind=e}},{key:"deviceId",get:function(){return this._deviceId},set:function(e){this._deviceId=e}},{key:"label",get:function(){return this._label},set:function(e){return this._label=e}},{key:"originalName",get:function(){return this._originalName},set:function(e){this._originalName=e}},{key:"groupId",get:function(){return this._groupId},set:function(e){this._groupId=e}},{key:"isSystemDefault",get:function(){return this._isSystemDefault},set:function(e){this._isSystemDefault=e}},{key:"isManualSelected",get:function(){return this._isManualSelected},set:function(e){void 0!==this._isManualSelected&&(this._isManualSelected=e),e&&(this._saveId(),this._saveManualSelection())}},{key:"isRemoved",get:function(){return this._isRemoved},set:function(e){e===this._isRemoved&&this._hasNotifyWeb||(this._hasNotifyWeb=0,this._isRemoved=e,a.default.getInstance().naclDeviceRemoved(this,e),this._saveManualSelection())}},{key:"hasNotifyWeb",get:function(){return this._hasNotifyWeb},set:function(e){this._hasNotifyWeb=e}}]),t}();i.ChromeSpeakerDevice=function(e){function i(e){l(this,i);var t=s(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e));return t._deviceType=e.deviceType,t._isActive=e.isActive,t._level=e.level,t}return u(i,c),r(i,[{key:"setSpeakerLevel",value:function(e){this._level!==e&&chrome.audio.setProperties(this._deviceId,{level:e},function(){})}},{key:"setActiveSpeaker",value:function(){chrome.audio.setActiveDevices({output:[this._deviceId]},function(){chrome.runtime.lastError&&this.setActiveSpeaker()}.bind(this))}},{key:"toInfo",value:function(e){return{kind:this._kind,deviceId:this._deviceId,label:this._label,originalName:this._originalName,deviceType:this._deviceType,groupId:this._groupId,selected:e||0,manualSelected:this._isManualSelected}}},{key:"deviceType",get:function(){return this._deviceType},set:function(e){this._deviceType=e}},{key:"isActive",get:function(){return this._isActive},set:function(e){(this._isActive=e)&&this.setActiveSpeaker()}},{key:"level",get:function(){return this._level},set:function(e){this._level=e}}]),i}(),i.CameraDevice=function(e){function i(e){l(this,i);var t=s(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e));return t._isInMeetingUsing=e.isInMeetingUsing||0,t._mirrorEffect=e.mirrorEffect||1,t._ptzSupport=e.ptzSupport||0,t}return u(i,c),r(i,[{key:"toInfo",value:function(e){return{kind:this._kind,deviceId:this._deviceId,label:this._label,originalName:this._originalName,groupId:this._groupId,selected:e||0,mirrorEffect:this._mirrorEffect,manualSelected:this._isManualSelected,isRemoved:this._isRemoved,hasNotifyWeb:this._hasNotifyWeb,isptzSupport:this._ptzSupport}}},{key:"isInMeetingUsing",get:function(){return this._isInMeetingUsing},set:function(e){this._isInMeetingUsing=e}},{key:"mirrorEffect",get:function(){return this._mirrorEffect},set:function(e){var t=this;if(this._mirrorEffect=e){var i=localStorage.mirrorEffectOffList||[];i=i.map(function(e){if(e.deviceId!==t._deviceId)return e}).filter(function(e){return e}),saveToLocal("mirrorEffectOffList",i)}else{var n=localStorage.mirrorEffectOffList||[],r=n.findIndex(function(e){return e.deviceId===t._deviceId});-1<r?n[r]=this.toInfo():(n.push(this.toInfo()),5<n.length&&n.shift()),saveToLocal("mirrorEffectOffList",n)}}},{key:"ptzSupport",get:function(){return this._ptzSupport},set:function(e){this._ptzSupport=e}}]),i}(),i.MicDevice=function(e){function i(e){l(this,i);var t=s(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e));return t._isInMeetingUsing=e.isInMeetingUsing||0,t}return u(i,c),r(i,[{key:"toInfo",value:function(e){return{kind:this._kind,deviceId:this._deviceId,label:this._label,originalName:this._originalName,groupId:this._groupId,selected:e||0,manualSelected:this._isManualSelected,isRemoved:this._isRemoved,hasNotifyWeb:this._hasNotifyWeb}}},{key:"isInMeetingUsing",get:function(){return this._isInMeetingUsing},set:function(e){this._isInMeetingUsing=e}}]),i}()},{"../deviceMgr":27}],3:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n,r=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),o=function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(n):void 0},a=e("./baseVideoElmt"),s=(n=a)&&n.__esModule?n:{default:n};var u=function(e){function i(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e));return t.showNameTag=t.showNameTag.bind(t),t.generateNameTag=t.generateNameTag.bind(t),t.generateAvatar=t.generateAvatar.bind(t),t.avatar=null,t.midName=null,t.notShowMidName=e.notShowMidName||!1,t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,s.default),r(i,[{key:"mounted",value:function(){o(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"mounted",this).call(this),this.notShowMidName||this.initAvatar()}},{key:"layoutFinished",value:function(){if(this.midName){var e=Math.max(18,Math.min(48,this.getContainer().offsetWidth/17));this.midName.style.fontSize=e+"px"}}},{key:"initAvatar",value:function(){if(this.removeTargetElement(),this.container.style.background="rgb(34,34,34)",""===this.videoUser.smallPicUrl&&""===this.videoUser.bigPicUrl){this.hideNameSpan();var e=this.generateNameTag();if(this.midName=e,this.videoUser.isTelephoneUser){var t=document.createElement("img");(this.avatar=t).style.className="mid",t.style.position="absolute",t.style.left="40%",t.style.top="20%",t.style.width="20%",t.style.transform="rotate(-135deg)",t.src="/build/static/images/phone.svg",this.container.appendChild(t),e.style.top="65%"}this.container.appendChild(e)}else this.videoUser.picBlob?this.refreshAvatar():(this.showNameTag(),this.videoUser.fetchAvatar(this.refreshAvatar.bind(this)))}},{key:"showNameTag",value:function(){var e=this.generateNameTag();this.midName=e,this.container.appendChild(e),this.hideNameSpan()}},{key:"hideNameSpan",value:function(){var e=this.container.querySelector('[class*="name_"]');e&&e.classList.add("forceHide")}},{key:"showNameSpan",value:function(){var e=this.container.querySelector('[class*="name_"]');e&&e.classList.remove("forceHide")}},{key:"generateNameTag",value:function(){var e=document.createElement("span");e.className="mid avatar-name";var t=Math.max(18,Math.min(48,this.getContainer().offsetWidth/17));return e.style.fontSize=t+"px",e.innerHTML=util.htmlEncode(this.videoUser.getName()),e}},{key:"generateAvatar",value:function(){var e=document.createElement("img");return e.style.className="mid",e.style.position="absolute",e.style.left="50%",e.style.top="50%",e.style.width="35%",e.style.maxHeight="90%",e.style.transform="translate(-50%, -50%)",e.src=this.videoUser.picBlob,e}},{key:"refreshAvatar",value:function(){this.videoUser.videoIsSending||this.videoUser.picBlob&&(this.midName&&this.midName.remove(),this.avatar=this.generateAvatar(),this.container.appendChild(this.avatar),this.showNameSpan())}},{key:"replaceWith",value:function(e){this.showNameSpan(),this.removeTargetElement(),o(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"replaceWith",this).call(this,e)}},{key:"removeTargetElement",value:function(){this.midName&&(this.midName.remove(),this.midName=null),this.avatar&&(this.avatar.remove(),this.avatar=null)}}]),i}();i.default=u},{"./baseVideoElmt":4}],4:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n,r=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),o=e("./baseViewElmt.class"),a=(n=o)&&n.__esModule?n:{default:n};var s=function(e){function i(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e));return t.videoUser=e.videoUser,t.orderIndex=0,t.isHide=e.hide||!1,(void 0===e.createDom||e.createDom)&&(t.container.classList.add("video-window-container"),t.refreshShowHide(),t.initVideoTag()),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,a.default),r(i,[{key:"refreshShowHide",value:function(){this.isHide?this.container.classList.add("forceHide"):this.container.classList.remove("forceHide")}},{key:"getUserId",value:function(){return this.videoUser.getUserId()}},{key:"initVideoTag",value:function(){if(this.container.querySelector('[class*="name_"]'))this.refreshVideoTag();else{var e=this.getUserId()>>10<<10,t=document.createElement("i");t.style.display="inline-block",t.className="img-bandwidth img-sprite forceHide "+this.videoUser.netQuality;var i=document.createElement("i");i.style.display="inline-block",i.className="img-listAudioOff img-sprite forceHide";var n=document.createElement("i");n.style.display="inline-block",n.className="img-listPhoneOff img-sprite forceHide";var r=document.createElement("span");r.classList.add("name-tag"),r.classList.add("name_"+e),r.innerHTML=util.htmlEncode(this.videoUser.getName());var o=document.createElement("div");o.className="left-bottom-container",o.append(t,i,n,r);var a=document.createElement("div");a.className="div-video-toolbar",a.style.display="none";var s=document.createElement("span");s.className="div-video-toolbar-pin",s.dataset.name="pin",a.appendChild(s),this.container.dataset.userId=this.getUserId(),this.container.append(o,a),this.refreshAudioStatus()}}},{key:"refreshNameTag",value:function(){var e=this.container.querySelector('[class*="name_"]');return e.innerHTML=util.htmlEncode(this.videoUser.getName()),e}},{key:"refreshVideoTag",value:function(){var e=this.getUserId()>>10<<10;this.refreshNameTag().className="name-tag name_"+e,this.container.dataset.userId=this.getUserId(),this.refreshAudioStatus()}},{key:"refreshAudioStatus",value:function(){var e=this.container.getElementsByClassName("img-listAudioOff").item(0),t=this.container.getElementsByClassName("img-listPhoneOff").item(0);switch(this.videoUser.audioIsMuted?(e.classList.remove("unmute-icon"),t.classList.remove("unmute-icon")):(e.classList.add("unmute-icon"),t.classList.add("unmute-icon")),this.videoUser.audioType){case"AUDIO_TELEPHONY":e.classList.add("forceHide"),t.classList.remove("forceHide");break;case"AUDIO_VOIP":t.classList.add("forceHide"),e.classList.remove("forceHide");break;case"AUDIO_NONE":e.classList.add("forceHide"),t.classList.add("forceHide")}}},{key:"refreshNetworkStatus",value:function(){var e=this.container.getElementsByClassName("img-bandwidth").item(0);e.classList.remove("good","normal","bad","forceHide"),e.classList.add(this.videoUser.netQuality)}},{key:"refreshIsPinned",value:function(e){var t=this.container.getElementsByClassName("div-video-toolbar").item(0);e?(t.style.display="",this.container.classList.add("pinned-user")):(t.style.display="none",this.container.classList.remove("pinned-user"))}},{key:"replaceWith",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;e.container=this.container,e.webglVideoContainer=this.webglVideoContainer,this.videoUser=e.videoUser,t||(e.webglVideoContainer&&e.webglVideoContainer.stopShow(),this.refreshVideoTag()),this.hasMounted?(e.hasMounted=1,e.mounted()):e.mount(),e.show(),e.replaced()}},{key:"replaced",value:function(){}},{key:"hide",value:function(){this.isHide=1,this.container.classList.add("forceHide")}},{key:"show",value:function(){this.isHide=0,this.container.classList.remove("forceHide")}},{key:"setOrderIndex",value:function(e){this.orderIndex=e}},{key:"getOderIndex",value:function(){return this.orderIndex}}]),i}();i.default=s},{"./baseViewElmt.class":5}],5:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();var r=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.viewContainer=e.viewContainer,(void(this.hasMounted=0)===e.createDom||e.createDom)&&this.createContainer()}return n(t,[{key:"createContainer",value:function(){this.container=document.createElement("div")}},{key:"mount",value:function(){(0<arguments.length&&void 0!==arguments[0]?arguments[0]:1)?this.viewContainer.appendChild(this.container):this.viewContainer.insertBefore(this.container,this.viewContainer.childNodes[0]),this.hasMounted=1,this.mounted()}},{key:"mounted",value:function(){}},{key:"destroy",value:function(){this.hasMounted=0,this.container.remove()}},{key:"getContainer",value:function(){return this.container}},{key:"layoutFinished",value:function(){}},{key:"show",value:function(){}},{key:"hide",value:function(){}}]),t}();i.default=r},{}],6:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n,r=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),o=function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(n):void 0},a=e("./baseVideoElmt"),s=(n=a)&&n.__esModule?n:{default:n};var u=function(e){function i(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e));return t.mediaStream=e.mediaStream,t.mirror=e.mirror,t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,s.default),r(i,[{key:"mounted",value:function(){o(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"mounted",this).call(this),this.targetElement=document.createElement("video"),this.container.insertBefore(this.targetElement,this.container.childNodes[0]),this.applyCamStream()}},{key:"applyCamStream",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.mediaStream,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.mirror;this.mediaStream=e,this.mirror=t,this.targetElement.style.width="100%",this.targetElement.style.height="100%",this.targetElement.style.transform=this.mirror?"rotateY(180deg)":"",this.targetElement.srcObject=this.mediaStream,this.targetElement.play()}},{key:"applyCamMirror",value:function(e){this.mirror=e,this.targetElement.style.transform=this.mirror?"rotateY(180deg)":""}},{key:"replaceWith",value:function(e){this.targetElement.remove(),o(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"replaceWith",this).call(this,e)}},{key:"show",value:function(){this.targetElement&&this.targetElement.play(),o(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"show",this).call(this)}},{key:"hide",value:function(){this.targetElement&&this.targetElement.pause(),o(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"hide",this).call(this)}}]),i}();i.default=u},{"./baseVideoElmt":4}],7:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n,r=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),o=e("./baseViewElmt.class"),a=(n=o)&&n.__esModule?n:{default:n};var s=function(e){function i(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e));return t.webglVideoContainer=null,t.glCanvas=e.glCanvas,t.init(),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,a.default),r(i,[{key:"init",value:function(){this.glCanvas.startRender(),this._requestAS(),this.mount()}},{key:"destroy",value:function(){(0<arguments.length&&void 0!==arguments[0]?arguments[0]:1)&&(this.glCanvas.stopAllVideo(),this.glCanvas.stopRender()),this._postMsgStopAS(),function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(n):void 0}(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"destroy",this).call(this)}},{key:"_requestAS",value:function(){}},{key:"layoutFinished",value:function(){this.webglVideoContainer?this.webglVideoContainer.dstRect={left:this.container.offsetLeft,top:this.container.offsetTop,width:this.container.offsetWidth,height:this.container.offsetHeight}:(this.webglVideoContainer=this.glCanvas.createVideoContainer({left:this.container.offsetLeft,top:this.container.offsetTop,width:this.container.offsetWidth,height:this.container.offsetHeight}),this.webglVideoContainer.bkColor={r:0,g:0,b:0,a:255},this.webglVideoContainer.startShow())}},{key:"_postMsgStopAS",value:function(){}},{key:"drawDirectShare",value:function(e){this.webglVideoContainer&&this.webglVideoContainer.setPicture({data:new Uint8Array(e.data),streamWidth:e.stream_width,streamHeight:e.stream_height,rotation:e.rotation,mirrorX:!1,mirrorY:!1,picType:0,layer:0},{left:e.video_left,top:e.video_top,width:e.video_width,height:e.video_height},{left:this.container.offsetLeft,top:this.container.offsetTop,width:this.container.offsetWidth,height:this.container.offsetHeight},e.cursor)}}]),i}();i.default=s},{"./baseViewElmt.class":5}],8:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n,r=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),o=e("./baseViewElmt.class"),a=(n=o)&&n.__esModule?n:{default:n};var s=function(e){function i(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e));return t.container.className="digital-signage-wrapper",t.init(),t.mount(),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,a.default),r(i,[{key:"init",value:function(){this.$webviewWrapper=$('<div class="forceHide"></div>'),this.$imgWrapper=this.$webviewWrapper.clone(),this.$videoWrapper=this.$webviewWrapper.clone(),this.$webviewWrapper.addClass("webview-wrapper"),this.$imgWrapper.addClass("image-wrapper"),this.$videoWrapper.addClass("video-wrapper"),this.webview=document.createElement("webview"),this.webview.id="digital-signage-webview",this.webview.src="about:blank",this.$webviewWrapper.append(this.webview),this.img=document.createElement("img"),this.$imgWrapper.append(this.img),this.video=document.createElement("video"),this.video.loop=!0,this.video.autoplay=!1,this.video.id="digital-signage-video";var e=document.createElement("div");e.className="video-err forceHide",this.$videoWrapper.append(this.video,e),$(this.getContainer()).append(this.$webviewWrapper,this.$imgWrapper,this.$videoWrapper),cmmDualScreen.DigitalSignage.cloneDefaultVideoTag(this.video)}},{key:"destroy",value:function(){cmmDualScreen.DigitalSignage.hideAll(),function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(n):void 0}(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"destroy",this).call(this)}}]),i}();i.default=s},{"./baseViewElmt.class":5}],9:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n,r=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),o=e("./baseViewElmt.class"),a=(n=o)&&n.__esModule?n:{default:n};var s=function(e){function i(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e));return t.mediaStream=e.mediaStream,t.targetElement=document.createElement("video"),t.targetElement,t.container.appendChild(t.targetElement),t.applyHdmiStream(),t.mount(),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,a.default),r(i,[{key:"applyHdmiStream",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.mediaStream;e&&(this.mediaStream=e,this.targetElement.style.width="100%",this.targetElement.style.height="100%",this.targetElement.srcObject=this.mediaStream,this.targetElement.play())}}]),i}();i.default=s},{"./baseViewElmt.class":5}],10:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),r=function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(n):void 0},o=s(e("../../rendererMgr.js")),a=s(e("./baseVideoElmt"));function s(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function i(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e));return t.webglVideoContainer=null,t.receivedVideoFrame=0,t.glCanvas=e.glCanvas,t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,a.default),n(i,[{key:"mounted",value:function(){r(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"mounted",this).call(this)}},{key:"show",value:function(){this.webglVideoContainer&&this.webglVideoContainer.startShow(),r(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"show",this).call(this)}},{key:"hide",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;this.webglVideoContainer&&this.webglVideoContainer.stopShow(),e&&this._postMsgStopVideo(),r(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"hide",this).call(this)}},{key:"destroy",value:function(){this.webglVideoContainer&&this.webglVideoContainer.stopShow(),this._postMsgStopVideo(),r(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"destroy",this).call(this)}},{key:"layoutFinished",value:function(e){this.container.style.backgroundColor="transparent",this.container&&(this.webglVideoContainer?this.webglVideoContainer.dstRect={left:this.container.offsetLeft,top:this.container.offsetTop,width:this.container.offsetWidth,height:this.container.offsetHeight}:this.webglVideoContainer=this.glCanvas.createVideoContainer({left:this.container.offsetLeft,top:this.container.offsetTop,width:this.container.offsetWidth,height:this.container.offsetHeight})),void 0!==e&&this.videoSize!==e&&(this.videoSize=e,this.webglVideoContainer&&this.webglVideoContainer.startShow(),this._postMsgReqeustVideo(this.getUserId(),e))}},{key:"_postMsgStopVideo",value:function(){var e={cmd:"stopVideo",userId:this.getUserId(),displayId:chrome.app.window.current().displayId};window.secondaryScreenFlag?chrome.runtime.sendMessage(e,function(e){}):o.default.getInstance().checkCanStopVideo(e)}},{key:"_postMsgReqeustVideo",value:function(e,t){var i={cmd:"requestVideo",userId:e,videoSize:t};window.secondaryScreenFlag?chrome.runtime.sendMessage(i,function(e){}):o.default.getInstance()._naclReqeustVideo(i)}},{key:"replaceWith",value:function(e){this.isHide||this._postMsgStopVideo();var t=e instanceof i;r(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"replaceWith",this).call(this,e,t)}},{key:"drawVideoFrame",value:function(e){this.webglVideoContainer&&(this.receivedVideoFrame||(this.receivedVideoFrame=1,this.refreshVideoTag()),this.webglVideoContainer.setPicture({data:new Uint8Array(e.data),streamWidth:e.stream_width,streamHeight:e.stream_height,rotation:e.rotation,mirrorX:!1,mirrorY:!1,picType:0,layer:0},{left:e.video_left,top:e.video_top,width:e.video_width,height:e.video_height},{left:this.container.offsetLeft,top:this.container.offsetTop,width:this.container.offsetWidth,height:this.container.offsetHeight}))}}]),i}();i.default=u},{"../../rendererMgr.js":30,"./baseVideoElmt":4}],11:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n,r=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),o=function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(n):void 0},a=e("./baseViewElmt.class"),s=(n=a)&&n.__esModule?n:{default:n},u=e("../../rendererUtil");var l=function(e){function i(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e));return t.webglVideoContainer=null,t.shareUserId=e.shareUserId,t.receivedVideoFrame=0,t.screenWindow=e.screenWindow,t.drawBg=e.drawBg,t.glCanvas=e.glCanvas,t.init(),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,s.default),r(i,[{key:"init",value:function(){this.targetElement=document.createElement("div"),this.targetElement.className="share-user-wrapper",this.startingDiv=document.createElement("div"),this.startingDiv.className="share-starting-wrapper",this.renderShareName(),this.container.appendChild(this.targetElement),this.container.appendChild(this.startingDiv),this.glCanvas.startRender(),this._requestAS(),this.mount()}},{key:"renderShareName",value:function(){var e=this.screenWindow.getVideoUserById(this.shareUserId),t=this.screenWindow.getShareUserName();if(!e||e.isMyself)this.targetElement.classList.add("forceHide"),this.startingDiv.textContent="",this.startingDiv.classList.add("forceHide");else if(""!==t){var i=util.htmlEncode(t)+"'s";t.match(new RegExp("s$"))&&(i=util.htmlEncode(t).replace(new RegExp("s$"),"s'")),this.targetElement.innerHTML='<span class="share-user">'+i+" screen</span>",this.targetElement.classList.remove("forceHide"),30<t.length&&(t=t.substr(0,30)+"..."),this.startingDiv.textContent=t+" has started screen sharing"}}},{key:"onShareStop",value:function(){this.glCanvas.stopAllVideo()}},{key:"onRefreshShareUser",value:function(e,t){(0,u.equalUserId)(e,this.shareUserId)&&!t||(this.webglVideoContainer.stopShow(),this._postMsgStopAS(),this.shareUserId=e,this.webglVideoContainer.startShow(),this.receivedVideoFrame=0,this._requestAS(),this.startingDiv.classList.remove("forceHide"),this.renderShareName())}},{key:"destroy",value:function(){this.glCanvas.stopAllVideo(),this.glCanvas.stopRender(),this._postMsgStopAS(),o(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"destroy",this).call(this)}},{key:"getShareVideoSize",value:function(){return 3}},{key:"_requestAS",value:function(){chrome.runtime.sendMessage({cmd:"requestAS",userId:this.shareUserId,videoSize:this.getShareVideoSize()},function(e){})}},{key:"layoutFinished",value:function(){this.startingDiv.style.fontSize=Math.max(14,Math.min(38,this.getContainer().offsetWidth/17))+"px",this.webglVideoContainer?this.webglVideoContainer.dstRect={left:this.container.offsetLeft,top:this.container.offsetTop,width:this.container.offsetWidth,height:this.container.offsetHeight}:(this.webglVideoContainer=this.glCanvas.createVideoContainer({left:this.container.offsetLeft,top:this.container.offsetTop,width:this.container.offsetWidth,height:this.container.offsetHeight},this.drawBg),this.webglVideoContainer.bkColor={r:0,g:0,b:0,a:255},this.webglVideoContainer.startShow()),o(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"layoutFinished",this).call(this)}},{key:"_postMsgStopAS",value:function(){chrome.runtime.sendMessage({cmd:"requestStopAS",userId:this.shareUserId},function(e){})}},{key:"drawGeneralShare",value:function(e){this.webglVideoContainer&&(e.cursor?this.webglVideoContainer.setPicture({data:new Uint8Array(e.data),streamWidth:e.stream_width,streamHeight:e.stream_height,rotation:e.rotation,mirrorX:!1,mirrorY:!1,picType:e.cursor?1:0,layer:e.cursor?1:0},{left:0,top:0,width:e.stream_width,height:e.stream_height},{left:e.video_left,top:e.video_top,width:e.video_width,height:e.video_height},e.cursor):(this.receivedVideoFrame||(this.receivedVideoFrame=1,this.startingDiv.classList.add("forceHide")),this.webglVideoContainer.setPicture({data:new Uint8Array(e.data),streamWidth:e.stream_width,streamHeight:e.stream_height,rotation:e.rotation,mirrorX:!1,mirrorY:!1,picType:0,layer:0,logicWidth:e.logic_width,logicHeight:e.logic_height},{left:e.video_left,top:e.video_top,width:e.video_width,height:e.video_height},{left:this.container.offsetLeft,top:this.container.offsetTop,width:this.container.offsetWidth,height:this.container.offsetHeight},e.cursor)))}}]),i}();i.default=l},{"../../rendererUtil":31,"./baseViewElmt.class":5}],12:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),r=o(e("../ViewElement/baseViewElmt.class"));o(e("../ViewElement/avatarElmt.class"));function o(e){return e&&e.__esModule?e:{default:e}}var a=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.type=e.type,this.screenWindow=e.screenWindow,this.glCanvas=e.glCanvas||this.screenWindow&&this.screenWindow.getGLCanvas(),this.viewContainerElement=document.createElement("div"),this.elements=[],this.mountContainer=e.mountContainer||this.screenWindow.getMountDom()}return n(t,[{key:"initFromVideoUserList",value:function(){for(var e=this.screenWindow.getVideoUserList(),t=0;t<e.length;t++)this.addVideoUser(e[t])}},{key:"mount",value:function(e){e?this.mountContainer.insertBefore(this.viewContainerElement,this.mountContainer.childNodes[0]):this.mountContainer.appendChild(this.viewContainerElement),this.mounted()}},{key:"mounted",value:function(){}},{key:"addVideoUser",value:function(e){}},{key:"removeVideoUser",value:function(e){}},{key:"onUserVideoStatusChange",value:function(e){}},{key:"onUserAudioStatusChange",value:function(e){}},{key:"onUserNetworkQualityChange",value:function(e){}},{key:"onUserNameUpdate",value:function(e){}},{key:"onActiveSpeakUser",value:function(e){}},{key:"onShareStop",value:function(){}},{key:"destroy",value:function(e){for(var t=0;t<this.elements.length;t++)this.elements[t]instanceof r.default&&this.elements[t].destroy(e);this.elements.length=0,this.viewContainerElement.remove(),this.glCanvas=null}},{key:"getViewContainer",value:function(){return this.viewContainerElement}},{key:"viewLayoutFinished",value:function(e){}},{key:"layout",value:function(){this.layoutFinished()}},{key:"layoutFinished",value:function(e){for(var t=0;t<this.elements.length;t++)this.elements[t]instanceof r.default&&this.elements[t].layoutFinished(e)}},{key:"getRenderedVideoUserList",value:function(){return[]}},{key:"drawVideoFrame",value:function(){}},{key:"drawGeneralShare",value:function(){}},{key:"drawDirectShare",value:function(){}},{key:"syncShareUserName",value:function(){}},{key:"onSwitchCamCplt",value:function(){}},{key:"syncSelfVideoMirror",value:function(){}}]),t}();i.default=a},{"../ViewElement/avatarElmt.class":3,"../ViewElement/baseViewElmt.class":5}],13:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n,r=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),o=e("./baseRndrView.class"),a=(n=o)&&n.__esModule?n:{default:n},s=e("../../rendererUtil");var u=function(e){function i(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e));return t.mount(),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,a.default),r(i,[{key:"onUserNameUpdate",value:function(t){(function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(n):void 0})(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"onUserNameUpdate",this).call(this,t);var e=this.elements.find(function(e){return(0,s.equalUserId)(e.getUserId(),t.userId)});e&&e.videoUser&&e.refreshNameTag()}},{key:"getRenderedVideoUserList",value:function(){return this.elements.map(function(e){return e.getUserId()})}}]),i}();i.default=u},{"../../rendererUtil":31,"./baseRndrView.class":12}],14:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n,r=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),o=e("./baseRndrView.class"),a=(n=o)&&n.__esModule?n:{default:n};var s=function(e){function i(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(e=e||{}).type="bgRndrView";var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e));return e.fadeIn||(t.viewContainerElement.style.animation="none"),t.viewContainerElement.classList.add("bgRndrView"),t.updateBG(e.bgStr),t.mount(e.prepend),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,a.default),r(i,[{key:"updateBG",value:function(e){void 0===e&&(e=this.screenWindow.getBGStr()),this.viewContainerElement.style.backgroundImage!==e&&""!==e&&(this.viewContainerElement.style.backgroundImage=e)}},{key:"blurBG",value:function(e){e?this.viewContainerElement.classList.add("blur"):this.viewContainerElement.classList.remove("blur")}},{key:"initZoomRoomLogo",value:function(e){}},{key:"showHideZoomRoomLogo",value:function(e){}}]),i}();i.default=s},{"./baseRndrView.class":12}],15:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),r=function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(n):void 0},o=s(e("./baseRndrView.class")),a=s(e("../ViewElement/drsCttElmt.class"));function s(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function i(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(e=e||{}).type="drsRndrView";var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e));return t.viewContainerElement.classList.add("drsRndrView"),t.init(),t.mount(),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,o.default),n(i,[{key:"init",value:function(){this.elements.push(new a.default({glCanvas:this.glCanvas,viewContainer:this.viewContainerElement}))}},{key:"drawDirectShare",value:function(e){this.elements[0].drawDirectShare(e)}},{key:"layout",value:function(){this.elements[0]&&(this.elements[0].getContainer().style.width="100%",this.elements[0].getContainer().style.height="100%")}},{key:"viewLayoutFinished",value:function(){this.layout(),r(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"layoutFinished",this).call(this)}},{key:"destroy",value:function(e){r(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"destroy",this).call(this,e)}}]),i}();i.default=u},{"../ViewElement/drsCttElmt.class":7,"./baseRndrView.class":12}],16:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),r=a(e("./baseRndrView.class")),o=a(e("../ViewElement/dsElmt.class"));function a(e){return e&&e.__esModule?e:{default:e}}var s=function(e){function i(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(e=e||{}).type="dsRndrView";var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e));return t.viewContainerElement.className="dsRndrView",t.addDSElmt(),t.mount(),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,r.default),n(i,[{key:"addDSElmt",value:function(){this.elements.push(new o.default({viewContainer:this.viewContainerElement}))}},{key:"getElmt",value:function(){return this.elements[0]}},{key:"onDigitalSignageChange",value:function(e,t,i,n){switch(e.type){case 0:cmmDualScreen.DigitalSignage.onDSImage(e,t,i,n);break;case 1:cmmDualScreen.DigitalSignage.onDSVideo(e,t,i,n,!0);break;case 2:cmmDualScreen.DigitalSignage.onDSWebview(e,t,i,n)}}}]),i}();i.default=s},{"../ViewElement/dsElmt.class":8,"./baseRndrView.class":12}],17:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var k=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],n=!0,r=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(i.push(a.value),!t||i.length!==t);n=!0);}catch(e){r=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw o}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},r=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),o=n(e("../ViewElement/nativeVideoElmt")),s=e("../../rendererUtil"),a=n(e("../ViewElement/baseViewElmt.class")),u=n(e("./baseUserVideoRndrView"));function n(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function n(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(e=e||{}).type="galleryRndrView";var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e)),i=e.matrix;return t.multifyFactor=i?1:18,t.minVideoWidth=i&&i.minVideoWidth||256,t.minVideoHeight=i&&i.minVideoHeight||144,t.maxRow=i&&i.maxRow||4,t.maxCol=i&&i.maxCol||4,t.maxCount=t.maxRow*t.maxCol,t.viewContainerElement.classList.add("galleryRndrView"),t.activeUserId=null,t.curPageNum=1,t.pageTotalNum=1,t.elmtsPool=[],t.getVideoSize=t.getVideoSize.bind(t),t.initElmtsPool(),t.glCanvas.startRender(),t.mount(),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,u.default),r(n,[{key:"initElmtsPool",value:function(){for(var e=0;e<this.maxCount;e++)this.elmtsPool.push((0,s.generateEmptyVideoElmt)(this.viewContainerElement))}},{key:"pushToElmtsPool",value:function(e){this.elmtsPool.push(e)}},{key:"viewLayoutFinished",value:function(){this.initFromCurVideoUserList()}},{key:"initFromCurVideoUserList",value:function(){var e=this.screenWindow.getCurGalleryRndrViewUserList().map(function(e){return e.videoUser});this.refreshViewByVideoUserList(e)}},{key:"addVideoElmt",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;if(!(this.elements.length>=this.maxRow*this.maxCol)){var i=this.screenWindow.generateVideoElmtByVideoUser(e,this.viewContainerElement,!1);return this.elmtsPool.shift().replaceWith(i),t?this.elements.push(i):this.elements.unshift(i),i}}},{key:"removeVideoElmt",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=this.elements.filter(function(e){return(0,s.equalUserId)(e.getUserId(),t)});if(e){var n=this.elements.findIndex(function(e){return(0,s.equalUserId)(e.getUserId(),t)});-1<n&&(this.elements[n]instanceof a.default&&this.elements[n].hide(0),this.pushToElmtsPool(this.elements[n]),this.elements.splice(n,1))}else{for(var r=0;r<i.length;r++)i[r]instanceof a.default&&i[r].hide(),this.pushToElmtsPool(i[r]);this.elements=this.elements.filter(function(e){return!(0,s.equalUserId)(e.getUserId(),t)})}}},{key:"addVideoUser",value:function(e){}},{key:"removeVideoUser",value:function(e){}},{key:"addVideoUserToTail",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=void 0;return this.elements.length<this.maxCount&&(this.elements.find(function(e){return e.getUserId()===t.getUserId()})&&!e||(i=this.addVideoElmt(t))),this.turnpageCheck(),i}},{key:"onUserVideoStatusChange",value:function(e){for(var t=0;t<this.elements.length;t++){var i=this.elements[t];if((0,s.equalUserId)(i.getUserId(),e.userId)&&i&&i.videoUser){var n=this.screenWindow.generateVideoElmtByVideoUser(i.videoUser,this.viewContainerElement,!1);this.elements[t]=n,i.replaceWith(n),n.layoutFinished(this.getVideoSize(n.getContainer().offsetHeight))}}}},{key:"onUserAudioStatusChange",value:function(e){for(var t=0;t<this.elements.length;t++){var i=this.elements[t];(0,s.equalUserId)(i.getUserId(),e.userId)&&i&&i.videoUser&&i.refreshAudioStatus()}}},{key:"onActiveSpeakUser",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.activeUserId,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=Array.from(this.viewContainerElement.getElementsByClassName("current-active-speaker-gallery"));if(t||this.activeUserId!==e||!i.length){for(var n=0;n<i.length;n++)i[n].classList.remove("current-active-speaker-gallery");for(var r=0;r<this.elements.length;r++){var o=this.elements[r];(0,s.equalUserId)(o.getUserId(),e)&&o&&o.getContainer().classList.add("current-active-speaker-gallery")}this.activeUserId=e}}},{key:"onSwitchCamCplt",value:function(){for(var e=0;e<this.elements.length;e++){var t=this.elements[e];t.videoUser.isMyself&&t.applyCamStream(this.screenWindow.getSelfVideoStream(),this.screenWindow.getSelfVideoMirror())}}},{key:"syncSelfVideoMirror",value:function(){for(var e=0;e<this.elements.length;e++){var t=this.elements[e];t.videoUser.isMyself&&t.applyCamMirror(this.screenWindow.getSelfVideoMirror())}}},{key:"_determineMaxRowCol",value:function(e,t,i,n){var r=Math.floor((t+8)/(n+8));r>this.maxRow&&(r=this.maxRow);var o=Math.floor((e+8)/(i+8));return o>this.maxCol&&(o=this.maxCol),[r,o]}},{key:"_getItemWidthHeight",value:function(e,t,i,n){if(1===this.multifyFactor)return[e,t];var r=Math.floor((t-8*(i-1))/i),o=Math.floor(16*r/9);if(o*n+8*(n-1)<=e)return 0<(r=9*(o=16*Math.floor(o/16))/16)%this.multifyFactor&&(o=16*(r-=r%this.multifyFactor)/9),[o=o,r=r];var a=Math.floor((e-8*(n-1))/n),s=Math.floor(9*a/16);return 0<(s=9*(a=16*Math.floor(a/16))/16)%this.multifyFactor&&(a=16*(s-=s%this.multifyFactor)/9),[a=a,s=s]}},{key:"_determineLayout",value:function(e,t,i,n,r){if(i*n<=r)return[i,n];var o,a,s=1,u=0,l=1,c=1,d=0,h=1,f=1;for(s=1;s<=i;s++){var v=Math.ceil(r/s);if(!(n<v)){var p=this._getItemWidthHeight(e,t,s,v),m=k(p,2);u<(o=m[0])*(a=m[1])&&(d=u,h=l,f=c,u=o*a,l=s,c=v)}}var g=1.1;return 2==r&&(g=1.5),c<f&&u<d*g?[h,f]:[l,c]}},{key:"_getItemPosition",value:function(e,t,i,n,r,o,a,s){var u,l;r*o<a&&(a=r*o);var c=Math.floor(s/o),d=s-c*o,h=o;c==r-1&&(h=a-c*o);var f=8*(h-1),v=8*(r-1);return u=Math.floor((e-h*i-f)/2)+d*(i+8),u=2*Math.floor(u/2),l=Math.floor((t-r*n-v)/2)+c*(n+8),[u,l=2*Math.floor(l/2)]}},{key:"layout",value:function(){var e,t,i=this.viewContainerElement.offsetWidth,n=this.viewContainerElement.offsetHeight,r=this.elements.length;12<r&&(i-=0,n-=0);var o,a,s,u,l=this._determineMaxRowCol(i,n,this.minVideoWidth,this.minVideoHeight),c=k(l,2);e=c[0],t=c[1];var d=this._determineLayout(i,n,e,t,r),h=k(d,2);o=h[0],a=h[1];var f=this._getItemWidthHeight(i,n,o,a),v=k(f,2);s=v[0],u=v[1];for(var p=this.elements.sort(function(e,t){return e.getOderIndex()-t.getOderIndex()}),m=0,g=p.length;m<g;m++){var y,w;if(o*a<=m)break;var _=this._getItemPosition(i,n,s,u,o,a,r,m),b=k(_,2);y=b[0],w=b[1];var S=p[m].getContainer();S.style.position="absolute",S.style.left=y+"px",S.style.top=w+"px",S.style.width=s+"px",S.style.height=u+"px"}this.layoutFinished(this.getVideoSize(u))}},{key:"getVideoSize",value:function(e){var t=this.elements.filter(function(e){return e instanceof o.default}).length;return 700<e?3:270<e&&t<=4?2:180<e&&t<=9?1:0}},{key:"turnpageCheck",value:function(){this.pageTotalNum=Math.ceil(this.screenWindow.getVideoUserList().length/this.maxCount),this.curPageNum>this.pageTotalNum&&(this.curPageNum=this.pageTotalNum)}},{key:"videoElmtFillAndLayout",value:function(e){var t=void 0;t=this.curPageNum===this.pageTotalNum?this.screenWindow.getVideoUserListFromEnd(this.maxCount):this.screenWindow.getVideoUserListFromIndex((this.curPageNum-1)*this.maxCount,this.maxCount),this.refreshViewByVideoUserList(t)}},{key:"refreshViewByVideoUserList",value:function(n){for(var r=this,o=this.getVideoUserListDeltaEntries(n),a=this.elements.concat(),e=function(e){var t=a[e].getUserId(),i=o.find(function(e){return(0,s.equalUserId)(e[0],t)});if(void 0===i)r.removeVideoElmt(t);else if(i[1]<0){r.removeVideoElmt(t,!0),i[1]++}},t=0;t<a.length;t++)e(t);var i=function(e){var t=n[e].getUserId(),i=o.find(function(e){return(0,s.equalUserId)(e[0],t)});i&&0<i[1]&&(r.addVideoUserToTail(n[e],1),i[1]--)};for(t=0;t<n.length;t++)i(t);this.tagOrderIndexByVideoUserList(n),this.layout(),this.onActiveSpeakUser(this.activeUserId,1)}},{key:"tagOrderIndexByVideoUserList",value:function(n){var r=this;this.elements=this.elements.map(function(e){return e.setOrderIndex(void 0),e});for(var e=function(e){var t=n[e].getUserId(),i=r.elements.find(function(e){return(0,s.equalUserId)(e.getUserId(),t)&&void 0===e.orderIndex});i&&i.setOrderIndex(e)},t=0;t<n.length;t++)e(t)}},{key:"getVideoUserListDeltaEntries",value:function(e){for(var t={},i=0;i<e.length;i++){var n=e[i].getUserId();t[n]?t[n]++:t[n]=1}for(var r=0;r<this.elements.length;r++){var o=this.elements[r].getUserId();for(var a in t)(0,s.equalUserId)(a,o)&&t[a]--}return Object.entries(t)}},{key:"nextPage",value:function(){this.curPageNum<this.pageTotalNum&&1<this.pageTotalNum&&(this.curPageNum++,this.videoElmtFillAndLayout())}},{key:"prevPage",value:function(){1<this.curPageNum&&1<this.pageTotalNum&&(this.curPageNum--,this.videoElmtFillAndLayout())}},{key:"drawVideoFrame",value:function(e){for(var t=0;t<this.elements.length;t++){var i=this.elements[t];(0,s.equalUserId)(i.getUserId(),parseInt(e.ssrc))&&i&&i instanceof o.default&&i.drawVideoFrame(e)}}},{key:"destroy",value:function(){this.glCanvas.stopAllVideo(),this.glCanvas.stopRender(),function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(n):void 0}(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"destroy",this).call(this)}}]),n}();i.default=l},{"../../rendererUtil":31,"../ViewElement/baseViewElmt.class":5,"../ViewElement/nativeVideoElmt":10,"./baseUserVideoRndrView":13}],18:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),r=a(e("./baseRndrView.class")),o=(a(e("../ViewElement/drsCttElmt.class")),a(e("../ViewElement/camVideoElmt.class")),a(e("../ViewElement/hdmiCttElmt.class")));function a(e){return e&&e.__esModule?e:{default:e}}var s=function(e){function i(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(e=e||{}).type="HDMIRndrView";var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e));return t.viewContainerElement.classList.add("HDMIRndrView"),t.init(e.mediaStream),t.mount(),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,r.default),n(i,[{key:"init",value:function(e){this.elements.push(new o.default({viewContainer:this.viewContainerElement,mediaStream:e}))}},{key:"layout",value:function(){this.elements[0].getContainer().style.width="100%",this.elements[0].getContainer().style.height="100%"}},{key:"viewLayoutFinished",value:function(){this.layout(),function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(n):void 0}(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"layoutFinished",this).call(this)}}]),i}();i.default=s},{"../ViewElement/camVideoElmt.class":6,"../ViewElement/drsCttElmt.class":7,"../ViewElement/hdmiCttElmt.class":9,"./baseRndrView.class":12}],19:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),r=l(e("../ViewElement/avatarElmt.class.js")),o=l(e("../ViewElement/camVideoElmt.class")),a=e("../../rendererUtil"),s=l(e("../ViewElement/baseViewElmt.class")),u=l(e("./baseUserVideoRndrView"));function l(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function i(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(e=e||{}).type="myselfRndrView";var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e));return t.viewContainerElement.classList.add("myselfRndrView"),t.mount(),t.initFromVideoUserList(),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,u.default),n(i,[{key:"addVideoElmt",value:function(e){if(!(1<=this.elements.length)&&e.isMyself){var t=new r.default({viewContainer:this.viewContainerElement,videoUser:e,createDom:!0,notShowMidName:!0});return t.refreshNetworkStatus(),this.elements.push(t),t}}},{key:"removeVideoElmt",value:function(t){var e=this.elements.findIndex(function(e){return(0,a.equalUserId)(e.getUserId(),t)});-1<e&&(this.elements[e]instanceof s.default&&this.elements[e].destroy(),this.elements.splice(e,1))}},{key:"addVideoUser",value:function(e){if(e&&e.isMyself){var t=this.addVideoElmt(e);t.getContainer().style.width="100%",t.getContainer().style.height="100%",t.mount()}}},{key:"removeVideoUser",value:function(e){this.removeVideoElmt(e)}},{key:"onUserVideoStatusChange",value:function(e){if(e.isMyself&&this.elements[0]){var t=this.elements[0];if(t&&t.videoUser){var i=this.screenWindow.generateVideoElmtByVideoUser(t.videoUser,this.viewContainerElement);this.elements[0]=i,t.replaceWith(i)}}}},{key:"onUserAudioStatusChange",value:function(t){var e=this.elements.findIndex(function(e){return(0,a.equalUserId)(e.getUserId(),t.userId)}),i=this.elements[e];i&&i.videoUser&&i.refreshAudioStatus()}},{key:"onUserNetworkQualityChange",value:function(e){if(e.isMyself&&this.elements[0]){var t=this.elements[0];t&&t.videoUser&&t.refreshNetworkStatus()}}},{key:"onSwitchCamCplt",value:function(){var e=this.elements.find(function(e){return e instanceof o.default&&e.videoUser.isMyself});e&&e.applyCamStream(this.screenWindow.getSelfVideoStream(),this.screenWindow.getSelfVideoMirror())}},{key:"syncSelfVideoMirror",value:function(){var e=this.elements.find(function(e){return e instanceof o.default&&e.videoUser.isMyself});e&&e.applyCamMirror(this.screenWindow.getSelfVideoMirror())}}]),i}();i.default=c},{"../../rendererUtil":31,"../ViewElement/avatarElmt.class.js":3,"../ViewElement/baseViewElmt.class":5,"../ViewElement/camVideoElmt.class":6,"./baseUserVideoRndrView":13}],20:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),r=a(e("./baseRndrView.class")),o=a(e("../ViewElement/shareCttElmt.class"));function a(e){return e&&e.__esModule?e:{default:e}}var s=function(e){function i(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(e=e||{}).type="shareRndrView";var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e));return t.viewContainerElement.classList.add("shareRndrView"),t.init(e.shareUserId,e.drawBg),t.mount(),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,r.default),n(i,[{key:"init",value:function(e,t){this.elements.push(new o.default({glCanvas:this.glCanvas,viewContainer:this.viewContainerElement,shareUserId:e,screenWindow:this.screenWindow,drawBg:t}))}},{key:"drawGeneralShare",value:function(e){this.elements[0]&&this.elements[0].drawGeneralShare(e)}},{key:"onShareStop",value:function(){this.elements[0]&&this.elements[0].onShareStop()}},{key:"onRefreshShareUser",value:function(e,t){this.elements[0]&&this.elements[0].onRefreshShareUser(e,t)}},{key:"layout",value:function(){this.elements[0]&&(this.elements[0].getContainer().style.width="100%",this.elements[0].getContainer().style.height="100%")}},{key:"viewLayoutFinished",value:function(){this.layout(),function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(n):void 0}(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"layoutFinished",this).call(this)}},{key:"syncShareUserName",value:function(){this.elements[0]&&this.elements[0].renderShareName()}}]),i}();i.default=s},{"../ViewElement/shareCttElmt.class":11,"./baseRndrView.class":12}],21:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),r=function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(n):void 0},o=c(e("../ViewElement/camVideoElmt.class")),u=e("../../rendererUtil"),a=c(e("../ViewElement/baseViewElmt.class")),s=c(e("../ViewElement/nativeVideoElmt")),l=c(e("./baseUserVideoRndrView"));function c(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function i(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(e=e||{}).type="singleVideoRndrView";var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e));return t.viewContainerElement.classList.add("singleVideoRndrView"),t.mount(),e.userId?t.onRefreshSingleVideoUser(t.screenWindow.getVideoUserById(e.userId),e.isPinned):t.initFromVideoUserList(),t.glCanvas.startRender(),t.preparedVideoElmt=null,t.changeUserTimeout=null,t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,l.default),n(i,[{key:"_checkIsChangingTo",value:function(e){return this.preparedVideoElmt&&(0,u.equalUserId)(this.preparedVideoElmt.getUserId(),e)}},{key:"onRefreshSingleVideoUser",value:function(e,t,i){var n=this;if(e){var r=0;if(2!==i&&(r=1),e.videoIsSending&&e.videoHasCamera||(r=1),this.elements[0]||(r=1,this.elements.push((0,u.generateEmptyVideoElmt)(this.viewContainerElement))),r||!this._checkIsChangingTo(e.getUserId())){this.preparedVideoElmt&&(this.preparedVideoElmt.destroy(),this.preparedVideoElmt=null),clearTimeout(this.changeUserTimeout);var o=this.elements[0].getUserId();if((0,u.equalUserId)(o,e.getUserId()))this.elements[0].refreshIsPinned(t);else if(r){var a=this.elements[0],s=this.screenWindow.generateVideoElmtByVideoUser(e,this.viewContainerElement);this.elements[0]=s,a.replaceWith(s),s.refreshIsPinned(t),this.layout()}else this.preparedVideoElmt=this.screenWindow.generateVideoElmtByVideoUser(e,this.viewContainerElement),this.preparedVideoElmt.layoutFinished(this.getSingleVideoSize()),this.changeUserTimeout=setTimeout(function(e){n.changeToPreparedVideoUser(e)},1e3)}}}},{key:"changeToPreparedVideoUser",value:function(e){var t=this.elements[0],i=this.preparedVideoElmt;this.preparedVideoElmt=null,this.elements[0]=i,t.replaceWith(i),i.refreshAudioStatus(),i.refreshIsPinned(e),this.layout()}},{key:"removeVideoElmt",value:function(t){var e=this.elements.findIndex(function(e){return(0,u.equalUserId)(e.getUserId(),t)});-1<e&&(this.elements[e]instanceof a.default&&this.elements[e].destroy(),this.elements.splice(e,1))}},{key:"removeVideoUser",value:function(e){this.removeVideoElmt(e)}},{key:"onUserVideoStatusChange",value:function(e){if(this.elements[0]){var t=this.elements[0];if((0,u.equalUserId)(t.getUserId(),e.userId)&&t&&t.videoUser){var i=this.screenWindow.generateVideoElmtByVideoUser(t.videoUser,this.viewContainerElement);this.elements[0]=i,t.replaceWith(i),this.layout()}}}},{key:"onUserAudioStatusChange",value:function(e){if(this.elements[0]){var t=this.elements[0];(0,u.equalUserId)(t.getUserId(),e.userId)&&t&&t.videoUser&&t.refreshAudioStatus()}}},{key:"onUserNetworkQualityChange",value:function(e){if(this.elements[0]){var t=this.elements[0];(0,u.equalUserId)(t.getUserId(),e.userId)&&t&&t.videoUser&&720<this.elements[0].getContainer().offsetHeight&&t.refreshNetworkStatus()}}},{key:"onSwitchCamCplt",value:function(){var e=this.elements.find(function(e){return e instanceof o.default&&e.videoUser.isMyself});e&&e.applyCamStream(this.screenWindow.getSelfVideoStream(),this.screenWindow.getSelfVideoMirror())}},{key:"syncSelfVideoMirror",value:function(){var e=this.elements.find(function(e){return e instanceof o.default&&e.videoUser.isMyself});e&&e.applyCamMirror(this.screenWindow.getSelfVideoMirror())}},{key:"drawVideoFrame",value:function(t){var e=this.elements.find(function(e){return(0,u.equalUserId)(e.getUserId(),parseInt(t.ssrc))});e&&e instanceof s.default?e.drawVideoFrame(t):this.preparedVideoElmt&&(0,u.equalUserId)(this.preparedVideoElmt.getUserId(),parseInt(t.ssrc))&&(540<=t.stream_height||this.elements[0]&&this.elements[0].getContainer().offsetHeight<540)&&(clearTimeout(this.changeUserTimeout),this.changeToPreparedVideoUser())}},{key:"layout",value:function(){this.elements[0]&&(this.elements[0].getContainer().style.width="100%",this.elements[0].getContainer().style.height="100%",720<this.elements[0].getContainer().offsetHeight&&this.elements[0].refreshNetworkStatus(),this.layoutFinished(this.getSingleVideoSize()))}},{key:"getSingleVideoSize",value:function(){var e=this.elements[0].getContainer().offsetHeight;return 700<e?3:270<e?2:180<e?1:0}},{key:"viewLayoutFinished",value:function(){this.layout(),r(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"layoutFinished",this).call(this)}},{key:"destroy",value:function(){this.preparedVideoElmt&&this.preparedVideoElmt.destroy(),clearTimeout(this.changeUserTimeout),this.glCanvas.stopAllVideo(),this.glCanvas.stopRender(),r(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"destroy",this).call(this)}}]),i}();i.default=d},{"../../rendererUtil":31,"../ViewElement/baseViewElmt.class":5,"../ViewElement/camVideoElmt.class":6,"../ViewElement/nativeVideoElmt":10,"./baseUserVideoRndrView":13}],22:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n,r=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),o=e("./baseRndrView.class"),a=(n=o)&&n.__esModule?n:{default:n};var s=function(e){function i(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(e=e||{}).type="waitingRoomRndrView";var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e));return t.viewContainerElement.classList.add("waitingRoomRndrView"),t.init(e.info),t.mount(),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,a.default),r(i,[{key:"init",value:function(e){this.viewContainerElement.id="kiosk-waiting-room",this.targetElement=document.createElement("div"),this.targetElement.className="waiting_room_main";var t=document.createElement("div");t.className="waiting_room_notice",t.textContent=""===e.waitingTitle?"Please wait, the meeting host will let you in soon.":e.waitingTitle,this.targetElement.append(t),this.viewContainerElement.appendChild(this.targetElement)}}]),i}();i.default=s},{"./baseRndrView.class":12}],23:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),r=g(e("./View/galleryRndrView.class")),o=g(e("./View/baseRndrView.class")),a=g(e("./View/myselfRndrView.class")),s=g(e("./View/bgRndrView.class")),u=g(e("./View/dsRndrView.class")),l=g(e("./View/shareRndrView.class")),c=(e("../rendererUtil"),g(e("./videoUser.class")),g(e("./View/singleVideoRndrView.class"))),d=g(e("./View/drsRndrView.class")),h=g(e("./View/hdmiRndrView.class")),f=g(e("./View/waitingRoomRndrView.class")),v=g(e("./ViewElement/avatarElmt.class.js")),p=g(e("./ViewElement/camVideoElmt.class.js")),m=g(e("./ViewElement/nativeVideoElmt.js"));function g(e){return e&&e.__esModule?e:{default:e}}var y=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.viewList=[],this.mountDom=e.mountDom,this.bgStr="",this.selfVideoStream=null,this.selfVideoMirror=1,this.hdmiMeidaStream=null,this.activeSpeakerUserId=-1,this.videoUserListMgr=e.VideoUserListMgr,this.curGalleryRndrViewUserList=[],this.shareUserName="",this.showZoomRoomLogo=0,this.glCanvas=null,this.initGLCanvas(e),this.initResizeObserver(),!e.emptyView&&this.addBgRndrView()}return n(t,[{key:"getMountDom",value:function(){return this.mountDom}},{key:"initGLCanvas",value:function(e){this.mountDom.style.overflow="hidden",e.canvas.width=e.canvasWidth||window.innerWidth,e.canvas.height=e.canvasHeight||window.innerHeight,e.canvas.style.position="absolute",e.canvas.style.top="0",e.canvas.style.left="0",this.glCanvas=new commonModule.WebGLRender(e.canvas),this.glCanvas.stopRender()}},{key:"initResizeObserver",value:function(){this.resizeObserver=new ResizeObserver(this.viewLayout.bind(this)),this.resizeObserver.observe(this.mountDom)}},{key:"getGLCanvas",value:function(){return this.glCanvas}},{key:"initConfView",value:function(){this.clearAll(),this.addSelfRndrView()}},{key:"addView",value:function(e){e instanceof o.default&&(this.viewList.push(e),this.viewLayout())}},{key:"getViewByIndex",value:function(e){return this.viewList[e]}},{key:"removeViewByIndex",value:function(e){this.viewList.splice(e,1)}},{key:"drawVideoFrame",value:function(e){for(var t=0;t<this.viewList.length;t++)this.viewList[t].drawVideoFrame(e)}},{key:"getVideoUserList",value:function(){return this.videoUserListMgr.getVideoUserList()}},{key:"getVideoUserListFromIndex",value:function(e,t){return this.videoUserListMgr.getVideoUserListFromIndex(e,t)}},{key:"getVideoUserListFromEnd",value:function(e){return this.videoUserListMgr.getVideoUserListFromEnd(e)}},{key:"addVideoUser",value:function(e){for(var t=0;t<this.viewList.length;t++)this.viewList[t].addVideoUser(e)}},{key:"removeVideoUser",value:function(e){for(var t=0;t<this.viewList.length;t++)this.viewList[t].removeVideoUser(e)}},{key:"onUserVideoStatusChange",value:function(e){for(var t=0;t<this.viewList.length;t++)this.viewList[t].onUserVideoStatusChange(e)}},{key:"onUserAudioStatusChange",value:function(e){for(var t=0;t<this.viewList.length;t++)this.viewList[t].onUserAudioStatusChange(e)}},{key:"onUserNetworkQualityChange",value:function(e){for(var t=0;t<this.viewList.length;t++)this.viewList[t].onUserNetworkQualityChange(e)}},{key:"onUserNameUpdate",value:function(e){for(var t=0;t<this.viewList.length;t++)this.viewList[t].onUserNameUpdate(e)}},{key:"onActiveSpeakUser",value:function(e){this.activeSpeakerUserId=e;for(var t=0;t<this.viewList.length;t++)this.viewList[t].onActiveSpeakUser(e)}},{key:"viewLayout",value:function(){if(this.viewList[0]){var e=this.viewList[0].getViewContainer();e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.right="0",e.style.bottom="0",this.viewLayoutFinished()}}},{key:"viewLayoutFinished",value:function(){for(var e=0;e<this.viewList.length;e++)this.viewList[e].viewLayoutFinished()}},{key:"clearAll",value:function(){for(var e=0;e<this.viewList.length;e++)this.viewList[e].destroy();this.viewList.length=0}},{key:"clearDirectShareView",value:function(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,t=0;t<this.viewList.length;t++)this.viewList[t]instanceof d.default&&(this.viewList[t].destroy(e),this.viewList[t]=null);this.viewList=this.viewList.filter(function(e){return e})}},{key:"clearDigitalSignageView",value:function(){for(var e=0;e<this.viewList.length;e++)this.viewList[e]instanceof u.default&&(this.viewList[e].destroy(),this.viewList[e]=null);this.viewList=this.viewList.filter(function(e){return e})}},{key:"clearHDMIShareView",value:function(){for(var e=0;e<this.viewList.length;e++)this.viewList[e]instanceof h.default&&(this.viewList[e].destroy(),this.viewList[e]=null);this.viewList=this.viewList.filter(function(e){return e})}},{key:"clearShareRndrView",value:function(){for(var e=0;e<this.viewList.length;e++)this.viewList[e]instanceof l.default&&(this.viewList[e].destroy(),this.viewList[e]=null);this.viewList=this.viewList.filter(function(e){return e})}},{key:"clearWaitingRoomView",value:function(){for(var e=0;e<this.viewList.length;e++)this.viewList[e]instanceof f.default&&(this.viewList[e].destroy(),this.viewList[e]=null);this.viewList=this.viewList.filter(function(e){return e})}},{key:"reset",value:function(){this.selfVideoStream=null,this.selfVideoMirror=1,this.hdmiMeidaStream=null,this.activeSpeakerUserId=-1,this.getViewByIndex(0)instanceof s.default||(this.clearAll(),this.addBgRndrView())}},{key:"addSelfRndrView",value:function(){this.addView(new a.default({screenWindow:this}))}},{key:"addGalleryRndrView",value:function(e){this.addView(new r.default({screenWindow:this,matrix:e})),this.onActiveSpeakUser(this.activeSpeakerUserId)}},{key:"addBgRndrView",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;this.addView(new s.default({screenWindow:this,bgStr:this.bgStr,showZoomRoomLogo:this.showZoomRoomLogo,fadeIn:e}))}},{key:"addDSRndrView",value:function(){this.addView(new u.default({screenWindow:this}))}},{key:"addShareRndrView",value:function(e,t){this.addView(new l.default({screenWindow:this,shareUserId:e,drawBg:t}))}},{key:"addSingleVideoRndrView",value:function(e,t){this.addView(new c.default({screenWindow:this,userId:e,isPinned:t}))}},{key:"addDrsVideoRndrView",value:function(){this.addView(new d.default({screenWindow:this}))}},{key:"addHDMIRndrView",value:function(){this.addView(new h.default({screenWindow:this,mediaStream:this.getHDMIMeidaStream()}))}},{key:"addWaitingRoomRndrView",value:function(e){this.addView(new f.default({screenWindow:this,info:e}))}},{key:"onSyncBackgroundImage",value:function(e){this.bgStr=e;for(var t=0;t<this.viewList.length;t++)this.viewList[t]instanceof s.default&&this.viewList[t].updateBG(e)}},{key:"onSyncBackgroundBlur",value:function(e){for(var t=0;t<this.viewList.length;t++)this.viewList[t]instanceof s.default&&this.viewList[t].blurBG(e)}},{key:"getBGStr",value:function(){return this.bgStr}},{key:"onDigitalSignageChange",value:function(e,t,i,n){this.viewList.find(function(e){return e instanceof u.default})||(this.clearAll(),this.addDSRndrView());for(var r=0;r<this.viewList.length;r++)this.viewList[r]instanceof u.default&&this.viewList[r].onDigitalSignageChange(e,t,i,n)}},{key:"drawGeneralShare",value:function(e){for(var t=0;t<this.viewList.length;t++)this.viewList[t].drawGeneralShare(e)}},{key:"drawDirectShare",value:function(e){for(var t=0;t<this.viewList.length;t++)this.viewList[t].drawDirectShare(e)}},{key:"onSwitchCamCplt",value:function(){for(var e=0;e<this.viewList.length;e++)this.viewList[e].onSwitchCamCplt()}},{key:"syncSelfVideoStream",value:function(e,t){this.selfVideoStream=e,this.selfVideoMirror=t}},{key:"syncSelfVideoMirror",value:function(e){this.selfVideoMirror=e;for(var t=0;t<this.viewList.length;t++)this.viewList[t].syncSelfVideoMirror()}},{key:"syncHDMIMediaStream",value:function(e){this.hdmiMeidaStream=e}},{key:"getHDMIMeidaStream",value:function(){return this.hdmiMeidaStream}},{key:"getSelfVideoStream",value:function(){return this.selfVideoStream}},{key:"getSelfVideoMirror",value:function(){return this.selfVideoMirror}},{key:"syncShareUserName",value:function(e){this.shareUserName=e;for(var t=0;t<this.viewList.length;t++)this.viewList[t].syncShareUserName()}},{key:"syncZoomRoomLogoShowHide",value:function(e){this.showZoomRoomLogo=e}},{key:"getShareUserName",value:function(){return this.shareUserName}},{key:"getVideoUserById",value:function(e){return this.videoUserListMgr.getVideoUserById(e)}},{key:"getVideoUserIndexById",value:function(e){return this.videoUserListMgr.getVideoUserIndexById(e)}},{key:"getCurGalleryRndrViewUserList",value:function(){var i=this;return this.curGalleryRndrViewUserList.map(function(e){var t=i.getVideoUserById(e.userID);if(t)return{activeOrder:e.activeOrder,videoUser:t}}).filter(function(e){return e})}},{key:"getRenderedVideoUserList",value:function(){return this.viewList.length?this.viewList.reduce(function(e,t){return e.concat(t.getRenderedVideoUserList())},[]):[]}},{key:"onShareStop",value:function(){for(var e=0;e<this.viewList.length;e++)this.viewList[e].onShareStop()}},{key:"onRefreshSingleVideoUser",value:function(e,t,i){var n=this.getVideoUserById(e);if(n)for(var r=0;r<this.viewList.length;r++)this.viewList[r]instanceof c.default&&this.viewList[r].onRefreshSingleVideoUser(n,t,i)}},{key:"onRefreshShareUser",value:function(e,t){for(var i=0;i<this.viewList.length;i++)this.viewList[i]instanceof l.default&&this.viewList[i].onRefreshShareUser(e,t)}},{key:"onRefreshGalleryRndrViewUser",value:function(){for(var e=0;e<this.viewList.length;e++)this.viewList[e]instanceof r.default&&this.viewList[e].viewLayoutFinished()}},{key:"onViewUpdate",value:function(e){var t=this.getViewByIndex(0);switch(e.viewRenderType){case 1:t instanceof c.default?this.onRefreshSingleVideoUser(e.activeView.userID,e.activeView.isPining,e.viewSubType):(this.clearAll(),this.addSingleVideoRndrView(e.activeView.userID,e.activeView.isPining));break;case 2:t instanceof l.default?this.onRefreshShareUser(e.shareView.userID,e.shareView.bForceSub):t instanceof d.default?(this.clearDirectShareView(0),this.addShareRndrView(e.shareView.userID,0)):(this.clearAll(),this.addShareRndrView(e.shareView.userID));break;case 3:e.galleryView&&(this.curGalleryRndrViewUserList=e.galleryView,t instanceof r.default?this.onRefreshGalleryRndrViewUser():(this.clearAll(),this.addGalleryRndrView(e.matrix)));break;case 4:t instanceof s.default||(this.clearAll(),this.addBgRndrView())}}},{key:"generateVideoElmtByVideoUser",value:function(e,t,i){return i=void 0===i||i,e&&t?e.videoIsSending?e.isMyself?(this.syncSelfVideoStream(mainAppHtmlWindow.videoStream,mainAppHtmlWindow.getMirrorEffect()),new p.default({viewContainer:t,mediaStream:this.getSelfVideoStream(),mirror:this.getSelfVideoMirror(),videoUser:e,createDom:i})):new m.default({viewContainer:t,videoUser:e,createDom:i,glCanvas:this.glCanvas}):new v.default({viewContainer:t,videoUser:e,createDom:i}):null}},{key:"dispose",value:function(){this.clearAll(),this.resizeObserver.disconnect(),this.resizeObserver=null,this.selfVideoStream=null,this.selfVideoMirror=1,this.hdmiMeidaStream=null,this.activeSpeakerUserId=-1,this.videoUserListMgr=null,this.curGalleryRndrViewUserList=null,this.glCanvas=null}}]),t}();i.default=y},{"../rendererUtil":31,"./View/baseRndrView.class":12,"./View/bgRndrView.class":14,"./View/drsRndrView.class":15,"./View/dsRndrView.class":16,"./View/galleryRndrView.class":17,"./View/hdmiRndrView.class":18,"./View/myselfRndrView.class":19,"./View/shareRndrView.class":20,"./View/singleVideoRndrView.class":21,"./View/waitingRoomRndrView.class":22,"./ViewElement/avatarElmt.class.js":3,"./ViewElement/camVideoElmt.class.js":6,"./ViewElement/nativeVideoElmt.js":10,"./videoUser.class":25}],24:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.instance=null,this.domAudio=$("<audio></audio>")[0],this.loopTimeOut=null,this._clearLoopTimeOut=this._clearLoopTimeOut.bind(this),this.playSpecSound=this.playSpecSound.bind(this),this.stopSound=this.stopSound.bind(this),this.loopSpecSound=this.loopSpecSound.bind(this),this.isPlayingSound=this.isPlayingSound.bind(this)}return n(e,[{key:"_clearLoopTimeOut",value:function(){clearTimeout(this.loopTimeOut)}},{key:"playSpecSound",value:function(e,t){this._clearLoopTimeOut(),this.domAudio.src=e,this.domAudio.loop=0,this.domAudio.load(),this.domAudio.play(),this.domAudio.onended=t||null}},{key:"stopSound",value:function(){this.domAudio.load()}},{key:"loopSpecSound",value:function(e){var t=this,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:3e4;this.domAudio.src=e,this.domAudio.loop=1,this.domAudio.load(),this.domAudio.play(),this.domAudio.onended=null,this._clearLoopTimeOut(),this.loopTimeOut=setTimeout(function(){t.stopSound()},i)}},{key:"isPlayingSound",value:function(){return this.domAudio.played.length}}],[{key:"getInstance",value:function(){return this.instance||(this.instance=new e),this.instance}}]),e}();i.default=r},{}],25:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();var r=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.userId=e.userId,this.name=e.name,this.shortName=e.shortName,this.longName=e.longName,this.smallPicUrl=e.smallPicUrl,this.bigPicUrl=e.bigPicUrl,this.isMyself=e.isMyself,this.isTelephoneUser=e.isTelephoneUser,this.isH323User=e.isH323User,this.audioType=e.audioType,this.audioIsMuted=e.audioIsMuted,this.videoHasCamera=e.videoHasCamera,this.videoIsSending=e.videoIsSending,this.netQuality=e.netQuality||"good",this.picBlob=e.picBlob||null}return n(t,[{key:"getUserId",value:function(){return this.userId}},{key:"getName",value:function(){return this.name}},{key:"setName",value:function(e){this.name=e}},{key:"getNetQuality",value:function(){return this.netQuality}},{key:"setNetQuality",value:function(e){this.netQuality=e.toLowerCase()}},{key:"getIsMySelf",value:function(){return this.isMyself}},{key:"setVideoIsSending",value:function(e){this.videoIsSending=e}},{key:"setVideoHasCamera",value:function(e){this.videoHasCamera=e}},{key:"setAudioType",value:function(e){this.audioType=e}},{key:"setAudioIsMuted",value:function(e){this.audioIsMuted=e}},{key:"setPicBlob",value:function(e){this.picBlob=e}},{key:"fetchAvatar",value:function(t){var i=this;""!==this.bigPicUrl||""!==this.smallPicUrl?util.promiseAjax(this.bigPicUrl).then(function(e){i.setPicBlob(window.URL.createObjectURL(e)),t&&"function"==typeof t&&t(i.userId)}).catch(function(e){i.fetchSmallAvatar(t).bind(i)}):t&&"function"==typeof t&&t(this.userId)}},{key:"fetchSmallAvatar",value:function(t){var i=this;util.promiseAjax(this.smallPicUrl).then(function(e){i.setPicBlob(window.URL.createObjectURL(e)),t&&"function"==typeof t&&t(i.userId)}).catch(function(e){t&&"function"==typeof t&&t(i.userId)})}}]),t}();i.default=r},{}],26:[function(e,t,i){"use strict";var n=p(e("./deviceMgr")),r=p(e("./rendererMgr")),o=p(e("./class/screenWindow.class")),a=p(e("./class/videoUser.class")),s=p(e("./class/ViewElement/baseViewElmt.class")),u=p(e("./class/View/galleryRndrView.class")),l=e("./webgl/webglRender"),c=p(e("./class/View/bgRndrView.class")),d=p(e("./displaysMgr")),h=p(e("./class/sound.js")),f=e("./FloatVideo.js"),v=p(f);function p(e){return e&&e.__esModule?e:{default:e}}window.commonModule={getFS:function(){return new Promise(function(t){try{window.fs.getRoot(),t(window.fs)}catch(e){window.fs.init({type:window.PERSISTENT,bytes:5242880,requestQuota:!0}).then(function(){return t(window.fs)})}})},DeviceMgr:n.default,rendererMgr:r.default,ScreenWindow:o.default,VideoUser:a.default,VideoElement:s.default,GalleryRndrView:u.default,WebGLRender:l.WebGLRender,BgRndrView:c.default,DisplaysMgr:d.default,Sound:h.default,startRenderFloatVideo:v.default,prepareFloatVideoInAdvance:f.prepareFloatVideoInAdvance,getFloatVideoCachePostion:f.getFloatVideoCachePostion,resetCacheSizePositionToDefault:f.resetCacheSizePositionToDefault,setFloatVideoCachePosition:f.setFloatVideoCachePosition,getIsRenderingFloatVideo:f.getIsRenderingFloatVideo}},{"./FloatVideo.js":1,"./class/View/bgRndrView.class":14,"./class/View/galleryRndrView.class":17,"./class/ViewElement/baseViewElmt.class":5,"./class/screenWindow.class":23,"./class/sound.js":24,"./class/videoUser.class":25,"./deviceMgr":27,"./displaysMgr":29,"./rendererMgr":30,"./webgl/webglRender":35}],27:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),r=e("./class/Device"),o=s(e("./deviceMgrHelper.js")),a=s(e("./displaysMgr.js"));function s(e){return e&&e.__esModule?e:{default:e}}var u=function(){function i(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.HDMI_DEVICE_FILT_LABEL_LIST=["XI100DUSB-HDMI","USB Capture HDMI"],this.HDMI_AUIO_WHITE_LIST_REGEXP_MAP={"USB Capture HDMI[^\\+]":"USB Capture HDMI[^\\+]","USB Capture HDMI\\+":"USB Capture HDMI\\+.*Mic"},this.DEVICE_BLACKLIST_REGEXP_MAP={"VB342.*Speaker":"audiooutput"},this.HDMI_NO_SIGINAL_MAP={"2935:0001":1,"2935:0004":2,"2935:0006":2},this.PTZCAMERA_WHITELIST=["Logi Group Camera","PTZ Pro Camera","CAM340","Logitech MeetUp","Rally"],this.LABEL_OPTIMIZE_MAP={"USB Capture HDMI[^\\+]\\: USB Audio":"HDMI (USB Capture HDMI)","USB Capture HDMI\\+\\: USB Audio.*Mic":"HDMI (USB Capture HDMI +)","USB Capture HDMI\\+\\: USB Audio \\#1":"Mic (USB Capture HDMI +)","USB Capture HDMI\\+\\: USB Audio \\#2":"Computer (USB Capture HDMI +)"},this.instance=null,this._lastDeviceList=[],this._deviceList=[],this._chromeMicList=[],this._manualSelectMic=localStorage.manualSelectMic?new r.Device(localStorage.manualSelectMic):void 0,this._manualSelectCam=localStorage.manualSelectCam?new r.Device(localStorage.manualSelectCam):void 0,this._manualSelectSpk=localStorage.manualSelectSpk?new r.Device(localStorage.manualSelectSpk):void 0,this._defaultDeviceMap={audioinput:{},audiooutput:{}},this._isZRCConnected=0,this._zrcInfo=null,this._notifyWebNoDevice=!1,this.setZRCConnected=this.setZRCConnected.bind(this),this.checkMicSpkCamDevice=this.checkMicSpkCamDevice.bind(this),this.enumDeviceWithoutSpecHDMIDevice=this.enumDeviceWithoutSpecHDMIDevice.bind(this),this.enumSpeakerDeviceWithoutSpecHDMIDevice=this.enumSpeakerDeviceWithoutSpecHDMIDevice.bind(this),this.enumHDMIDevice=this.enumHDMIDevice.bind(this),this.filtoutHdmiAndSpkDefaultDevice=this.filtoutHdmiAndSpkDefaultDevice.bind(this),this.filtoutBlacklistDevice=this.filtoutBlacklistDevice.bind(this),this.filtinHdmiDevice=this.filtinHdmiDevice.bind(this),this._rewrapDeviceByType=this._rewrapDeviceByType.bind(this),this._refreshDeviceSettings=this._refreshDeviceSettings.bind(this),this.promiseDistinguishiSpeakerDevice=this.promiseDistinguishiSpeakerDevice.bind(this),this.getRespondingAudioIdByHDMILabel=this.getRespondingAudioIdByHDMILabel.bind(this),this.getRespondingNoSignalViaOriginalName=this.getRespondingNoSignalViaOriginalName.bind(this),this.getManualSelectionByKind=this.getManualSelectionByKind.bind(this),this.getSelectedDeviceByKind=this.getSelectedDeviceByKind.bind(this),this.startNotifyWebCountDown=this.startNotifyWebCountDown.bind(this),this.isCameraInWhiteList=this.isCameraInWhiteList.bind(this),this.isManualCamHDMI=this.isManualCamHDMI.bind(this),this._rewrapSpeakerDevice=this._rewrapSpeakerDevice.bind(this),this._optimzeDeviceLabel=this._optimzeDeviceLabel.bind(this),this._simplifyDeviceLabel=this._simplifyDeviceLabel.bind(this),this._storeChromeMicDevice=this._storeChromeMicDevice.bind(this),this._storeDefaultDevice=this._storeDefaultDevice.bind(this),this._refreshMicDeviceListLabelViaChromeMic=this._refreshMicDeviceListLabelViaChromeMic.bind(this),this._checkBluetoothSelection=this._checkBluetoothSelection.bind(this)}return n(i,[{key:"setManualSelectDeviceByKind",value:function(e,t){this._updateManualSelectionDeviceFlag(e,t),"audioinput"!==e&&"audiooutput"!==e||this._checkBluetoothSelection(),this._onPreferredConnect(e),this._naclDviceListTrottle()}},{key:"resetInMeetingUsingDevice",value:function(){this._updateInMeetingUsingDeviceFlag("audioinput",-1),this._updateInMeetingUsingDeviceFlag("videoinput",-1)}},{key:"setInMeetingUsingDeviceByKind",value:function(e,t){this._updateInMeetingUsingDeviceFlag(e,t),this._naclDviceListTrottle()}},{key:"_updateManualSelectionDeviceFlag",value:function(t,e){for(var i in this._deviceList){var n=this._deviceList[i];n.kind===t&&(n.isManualSelected=+(n.deviceId===e),n.hasOwnProperty("_isActive")&&(n.isActive=+(n.deviceId===e)))}var r=this._deviceList.find(function(e){return e.kind===t&&e.isManualSelected});switch(t){case"audioinput":this._manualSelectMic=r;break;case"videoinput":this._manualSelectCam=r;break;case"audiooutput":this._manualSelectSpk=r}}},{key:"_updateSystemDefaultDeviceFlag",value:function(e,t){for(var i in this._deviceList){var n=this._deviceList[i];n.kind===e&&(n.isSystemDefault=+(n.deviceId===t))}}},{key:"_updateInMeetingUsingDeviceFlag",value:function(e,t){for(var i in this._deviceList){var n=this._deviceList[i];n.kind===e&&(n.isInMeetingUsing=+(n.deviceId===t))}}},{key:"setManualSelectOff",value:function(e,t){var i=this.getManualSelectionByKind(e);i.deviceId&&(i.isRemoved=t)}},{key:"setCameraMirrorEffect",value:function(e){var t=this.getInMeetingUsingDeviceByKind("videoinput");t&&(t.mirrorEffect=e)}},{key:"getCameraMirrorEffect",value:function(){var e=this.getInMeetingUsingDeviceByKind("videoinput");return e?e.mirrorEffect:1}},{key:"setZRCConnected",value:function(e,t){this._isZRCConnected=e,this._zrcInfo=e?t:null}},{key:"isZRCConnected",value:function(){return this._isZRCConnected}},{key:"getZRCInfo",value:function(){return this._zrcInfo}},{key:"checkMicSpkCamDevice",value:function(){var t=this;return this.enumDeviceWithoutSpecHDMIDevice().then(function(e){return t._lastDeviceList=t._deviceList,t._deviceList=e,t.checkEachKindOfDevice(),t._naclDviceListTrottle(),e}).then(this._logDevice)}},{key:"showWarningWithoutEnum",value:function(){this.checkEachKindOfDevice(1)}},{key:"checkEachKindOfDevice",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=this._deviceList.filter(function(e){return"audioinput"===e.kind});this.checkDeviceSelectionByKind(t,"audioinput",e),o.default.getInstance().changeAudioInputIfNeed();var i=this._deviceList.filter(function(e){return"videoinput"===e.kind});this.checkDeviceSelectionByKind(i,"videoinput",e),o.default.getInstance().changeVideoInputIfNeed();var n=this._lastDeviceList.filter(function(e){return"audiooutput"===e.kind}),r=this._deviceList.filter(function(e){return"audiooutput"===e.kind});this.checkDeviceSelectionByKind(r,"audiooutput",e),n.length!==r.length&&a.default.getInstance().displayChangeHandler(1),this._checkBluetoothSelection()}},{key:"checkDeviceSelectionByKind",value:function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,n=this.getManualSelectionByKind(t),r=this._getSpecDeviceFromListByKind(e,t,n);r?(this._onPreferredConnect(t),i||this.updateDeviceListWithSelection(t,r)):void 0===r?i||this.updateDeviceListWithSelection(t):null===r&&(this._onPreferredDisconnect(t),i||this.updateDeviceListWithSelection(t))}},{key:"_onPreferredConnect",value:function(e){this.setManualSelectOff(e,0)}},{key:"_onPreferredDisconnect",value:function(e){var t=i.getInstance().getManualSelectionByKind(e);t.deviceId,t.label;this.setManualSelectOff(e,1)}},{key:"updateDeviceListWithSelection",value:function(e,t){t&&this._updateManualSelectionDeviceFlag(e,t.deviceId);var i=this.findSystemDefaultDeviceByKind(e);this._updateSystemDefaultDeviceFlag(e,i.deviceId)}},{key:"findSystemDefaultDeviceByKind",value:function(t){var i=this._getDefaultDeviceByKind(t),e=this._deviceList.find(function(e){return e.kind===t});if(!i)return e;var n=this._deviceList.find(function(e){return e.kind===t&&e.groupId===i.groupId});return n||((n=this._deviceList.find(function(e){return e.kind===t&&-1<i.label.indexOf(e.originalName)}))||e)}},{key:"getManualSelectionByKind",value:function(e){var t=void 0;switch(e){case"videoinput":t=this._manualSelectCam||{deviceId:localStorage.manualSelectCamId,label:localStorage.lastCameraDeviceLabel};break;case"audioinput":t=this._manualSelectMic||{deviceId:localStorage.manualSelectMicId,label:localStorage.lastMicrophoneDeviceLabel};break;case"audiooutput":t=this._manualSelectSpk||{deviceId:localStorage.manualSelectSpkId,label:localStorage.lastSpeakerDeviceLabel}}return t}},{key:"enumDeviceWithoutSpecHDMIDevice",value:function(){var t=this;return new Promise(function(e){navigator.mediaDevices.enumerateDevices().then(t._storeDefaultDevice).then(t.excludeVideoinputDefaultDevice).then(t._rewrapDeviceByType).then(t.filtoutBlacklistDevice).then(t._refreshDeviceSettings).then(t.promiseDistinguishiSpeakerDevice).then(e)})}},{key:"enumHDMIDevice",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return navigator.mediaDevices.enumerateDevices().then(this.filtinHdmiDevice).then(function(e){return e.map(function(e){return{deviceId:e.deviceId,kind:e.kind,groupId:e.groupId,originalName:e.label,label:t?this._optimzeDeviceLabel(e.label,e.kind):e.label}}.bind(this))}.bind(this))}},{key:"enumChromeAudioDevice",value:function(){var i=this;return new Promise(function(t,e){chrome.audio?chrome.audio.getDevices({},function(e){t(e)}.bind(i)):e("chrome audio undefined")})}},{key:"filtoutHdmiAndSpkDefaultDevice",value:function(e){return e.filter(function(t){return this.HDMI_DEVICE_FILT_LABEL_LIST.findIndex(function(e){return-1<t.label.indexOf(e)})<0&&"default"!==t.deviceId||"default"===t.deviceId&&"audiooutput"===t.kind}.bind(this))}},{key:"excludeDefaultDeviceExceptAudiooutput",value:function(e){return e.filter(function(e){return"default"!==e.deviceId||"default"===e.deviceId&&"audiooutput"===e.kind}.bind(this))}},{key:"excludeVideoinputDefaultDevice",value:function(e){return e.filter(function(e){return!("default"===e.deviceId&&"videoinput"===e.kind)}.bind(this))}},{key:"filtoutBlacklistDevice",value:function(e){return e.filter(function(t){var i=this;return Object.keys(this.DEVICE_BLACKLIST_REGEXP_MAP).findIndex(function(e){return!(!t.originalName.match(new RegExp(e))||"default"===t.deviceId||t.kind!==i.DEVICE_BLACKLIST_REGEXP_MAP[e])})<0}.bind(this))}},{key:"filtinHdmiDevice",value:function(e){return e.filter(function(t){return 0<this.HDMI_DEVICE_FILT_LABEL_LIST.findIndex(function(e){return-1<t.label.indexOf(e)})&&t.label.indexOf("Default")<0}.bind(this))}},{key:"getInMeetingUsingDeviceByKind",value:function(t){return this._deviceList.find(function(e){return e.kind===t&&1===e.isInMeetingUsing})||this._deviceList.find(function(e){return e.kind===t&&1===e.isManualSelected})||this._deviceList.find(function(e){return e.kind===t&&1===e.isSystemDefault})}},{key:"getSelectedDeviceByKind",value:function(t){return this._deviceList.find(function(e){return e.kind===t&&1===e.isManualSelected})||this._deviceList.find(function(e){return e.kind===t&&1===e.isSystemDefault})}},{key:"_checkBluetoothSelection",value:function(){var e=this.getSelectedDeviceByKind("audioinput"),t=this.getSelectedDeviceByKind("audiooutput");if(t&&e&&(e=this._getCorrespondingChromeMicDeviceByOriginalName(e.originalName)))e.deviceType,t.deviceType}},{key:"_getDefaultDeviceByKind",value:function(e){return this._defaultDeviceMap[e]}},{key:"_getSpecDeviceFromListByKind",value:function(e,t,i){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;if(!e.length)return 0;var r=i.deviceId,o=i.label,a=i.originalName;if(void 0!==r||void 0!==o||void 0!==a){var s=null;if(r&&(s=e.find(function(e){return e.deviceId===r}))&&o.indexOf(this._simplifyDeviceLabel(s.originalName,t))<0&&(s=null),!s&&a&&(s=e.find(function(e){return e.originalName===a})),"videoinput"!==t&&!s&&o&&(s=e.find(function(e){return-1<o.indexOf(this._simplifyDeviceLabel(e.originalName,t))}.bind(this))),s||(s=null),s&&n){var u=e.findIndex(function(e){return e.deviceId===s.deviceId}.bind(this));-1<u&&e.splice(u,1)}return s}}},{key:"_storeChromeMicDevice",value:function(e){return this._chromeMicList=e.filter(function(e){return"INPUT"===e.streamType}),e}},{key:"_refreshMicDeviceListLabelViaChromeMic",value:function(e){for(var t in e)if("audioinput"===e[t].kind){var i=this._getCorrespondingChromeMicDeviceByOriginalName(e[t].originalName);i&&(e[t].label=this._optimzeDeviceLabelThroughChromeAudio(i))}}},{key:"_getCorrespondingChromeMicDeviceByOriginalName",value:function(t){return this._chromeMicList.find(function(e){return e.displayName===t})}},{key:"_storeDefaultDevice",value:function(e){return this._defaultDeviceMap.audioinput=e.find(function(e){return"default"===e.deviceId&&"audioinput"===e.kind}),this._defaultDeviceMap.audiooutput=e.find(function(e){return"default"===e.deviceId&&"audiooutput"===e.kind}),e}},{key:"_rewrapSpeakerDevice",value:function(e){return e.filter(function(e){return"OUTPUT"===e.streamType}).map(function(e){var t=this._optimzeDeviceLabelThroughChromeAudio(e);return new r.ChromeSpeakerDevice({deviceId:e.id,kind:"audiooutput",label:t,originalName:e.displayName,deviceType:e.deviceType,isActive:e.isActive,level:e.level})}.bind(this))}},{key:"_logDevice",value:function(e){return e}},{key:"_rewrapDeviceByType",value:function(e){return e.map(function(e){switch(e.kind){case"audioinput":var t=this.getInMeetingUsingDeviceByKind("audioinput"),i=+(t&&t.deviceId===e.deviceId&&t.isInMeetingUsing);return new r.MicDevice({deviceId:e.deviceId,kind:e.kind,groupId:e.groupId,label:this._optimzeDeviceLabel(e.label,e.kind),originalName:e.label,isInMeetingUsing:i});case"videoinput":return i=+((t=this.getInMeetingUsingDeviceByKind("videoinput"))&&t.deviceId===e.deviceId&&t.isInMeetingUsing),new r.CameraDevice({deviceId:e.deviceId,kind:e.kind,groupId:e.groupId,label:this._optimzeDeviceLabel(e.label,e.kind),originalName:e.label,isInMeetingUsing:i,mirrorEffect:1});default:return new r.Device({deviceId:e.deviceId,kind:e.kind,groupId:e.groupId,label:this._optimzeDeviceLabel(e.label,e.kind),originalName:e.label})}}.bind(this))}},{key:"_refreshDeviceSettings",value:function(e){var t=this,i=[];return e.map(function(e){switch(e.kind){case"audioinput":return e;case"videoinput":return e.mirrorEffect=!this._getSpecDeviceFromListByKind(localStorage.mirrorEffectOffList||[],e.kind,{deviceId:e.deviceId,label:e.label,originalName:e.originalName},1),i.push(this.promisePtzSupportCheck(e)),e;default:return e}}.bind(this)),Promise.all(i).then(function(i){return e.map(function(e){for(var t=0;t<i.length;t++)if(e.deviceId===i[t].device.deviceId)return e.ptzSupport=i[t].ptzSupport,e;return e}.bind(t)),e})}},{key:"promiseDistinguishiSpeakerDevice",value:function(i){var n=this;return new Promise(function(t){chrome.audio?(i=i.filter(function(e){return"audiooutput"!==e.kind}),n.enumChromeAudioDevice().then(n._storeChromeMicDevice).then(function(e){return n._refreshMicDeviceListLabelViaChromeMic(i),e}).then(n._rewrapSpeakerDevice).then(n.filtoutBlacklistDevice).then(function(e){i=i.concat(e),t(i)})):(i=i.filter(function(e){return"audiooutput"!==e.kind||"audiooutput"===e.kind&&"default"===e.deviceId}),t(i))})}},{key:"enumSpeakerDeviceWithoutSpecHDMIDevice",value:function(i){chrome.audio&&chrome.audio.getDevices({streamTypes:["OUTPUT"]},function(e){var t=e.filter(function(t){return this.HDMI_DEVICE_FILT_LABEL_LIST.findIndex(function(e){return-1<t.displayName.indexOf(e)})<0}.bind(this));t=t.map(function(e){return{deviceId:e.id,kind:"audiooutput",label:this._optimzeDeviceLabel(e.displayName,"audiooutput"),originalName:e.displayName,deviceType:e.deviceType,isActive:e.isActive,level:e.level}}.bind(this)),"function"==typeof i&&i.call(null,t)}.bind(this))}},{key:"getRespondingAudioIdByHDMILabel",value:function(t){var e=Object.keys(this.HDMI_AUIO_WHITE_LIST_REGEXP_MAP).find(function(e){return t.match(new RegExp(e))}),i=void 0;return this.HDMI_AUIO_WHITE_LIST_REGEXP_MAP.hasOwnProperty(e)&&(i=new RegExp(this.HDMI_AUIO_WHITE_LIST_REGEXP_MAP[e])),this.enumHDMIDevice(0).then(function(e){return e.filter(function(e){return"audioinput"===e.kind})}).then(function(e){if(i){var t=e.find(function(e){return e.label.match(i)});return t?t.deviceId:void 0}})}},{key:"getRespondingNoSignalViaOriginalName",value:function(t){var e=Object.keys(this.HDMI_NO_SIGINAL_MAP).find(function(e){return t.match(new RegExp(e))});return this.HDMI_NO_SIGINAL_MAP[e]}},{key:"getActiveSpeaker",value:function(){return this._deviceList.find(function(e){return e.isActive})}},{key:"isCameraInWhiteList",value:function(t){return this.PTZCAMERA_WHITELIST.find(function(e){return t.match(new RegExp(e))})?1:0}},{key:"_optimzeDeviceLabel",value:function(e,t){if(e&&t||console.error("[DeviceMgr::_optimzeDeviceLabel]: check param label: %o type: %o",e,t),"videoinput"===t)return e=-1===e.indexOf("Logitech")&&-1!==e.indexOf("046d")?e.replace(/\(.*\)/g," (Logitech)"):e.split("(")[0];for(var i in this.LABEL_OPTIMIZE_MAP)if(e.match(new RegExp(i)))return this.LABEL_OPTIMIZE_MAP[i];return e=e.replace("0x46d","Logitech").replace(new RegExp(":.*:.*[0-9$]:*"),"")}},{key:"_optimzeDeviceLabelThroughChromeAudio",value:function(e){var t=this._optimzeDeviceLabel(e.displayName,"audiooutput"),i="";return"HDMI"===e.deviceType?i=e.deviceType:"USB"!==e.deviceType&&(i=util.titleCase(e.deviceType.split("_")[0])),""===i||-1<t.indexOf(i)?t:t+" ("+i+")"}},{key:"_simplifyDeviceLabel",value:function(e,t){if(e&&t||console.error("[DeviceMgr::_optimzeDeviceLabel]: check param label: %o type: %o",e,t),"videoinput"===t)e=e.split("(")[0];else{for(var i in this.LABEL_OPTIMIZE_MAP)if(e.match(new RegExp(i)))return this.LABEL_OPTIMIZE_MAP[i];e=e.replace("0x46d","Logitech").split(":")[0]}return e}},{key:"_naclDviceListTrottle",value:function(){return this.deviceThrottle=this.deviceThrottle||_.throttle(this._naclDeviceList.bind(this),500,{leading:!1,trailing:!0}),this.deviceThrottle()}},{key:"_naclDeviceList",value:function(){var i=this,e=this._deviceList.map(function(e){var t=i.getInMeetingUsingDeviceByKind(e.kind);return e.toInfo(+(t.deviceId===e.deviceId))});common.postMessageToNaCl({type:"conf",command:"conf.deviceInfo",deviceInfo:e,notifyWebNoDevice:this._notifyWebNoDevice})}},{key:"naclDeviceRemoved",value:function(e,t){this._notifyWebNoDevice&&(e.hasNotifyWeb=1,common.postMessageToNaCl({type:"conf",command:"conf.selectedDeviceRemoved",kind:e.kind,deviceId:e.deviceId,removed:t}))}},{key:"isManualCamHDMI",value:function(){for(var e in this.HDMI_DEVICE_FILT_LABEL_LIST)if(this._manualSelectCam&&this._manualSelectCam.label.match(new RegExp(this.HDMI_DEVICE_FILT_LABEL_LIST[e])))return!0;return!1}},{key:"startNotifyWebCountDown",value:function(){setTimeout(function(){this._notifyWebNoDevice=!0,this.checkMicSpkCamDevice(),this.initialDeviceInfo()}.bind(this),3e4)}},{key:"initialDeviceInfo",value:function(){common.postMessageToNaCl({type:"user",command:"user.initialDeviceInfo"})}},{key:"changeContraintsDeviceIdToDefault",value:function(e){var t=e.deviceId;navigator.appVersion.match("Chrome/68.0.3440.87")&&(this._getDefaultDeviceByKind("audioinput").label.match(e.originalName)&&(t="default"));return t}},{key:"promisePtzSupportCheck",value:function(i){var e=this;return new Promise(function(t){navigator.appVersion.match("CrOS")&&chrome.webcamPrivate&&chrome.webcamPrivate.get?chrome.webcamPrivate.get(i.deviceId,function(e){e?t({device:i,ptzSupport:1}):chrome.runtime.lastError&&(this.isCameraInWhiteList(i.label)?t({device:i,ptzSupport:1}):t({device:i,ptzSupport:0}))}.bind(e)):t({device:i,ptzSupport:0})})}},{key:"deviceList",get:function(){return this._deviceList}}],[{key:"getInstance",value:function(){return this.instance||(this.instance=new i),this.instance}}]),i}();i.default=u},{"./class/Device":2,"./deviceMgrHelper.js":28,"./displaysMgr.js":29}],28:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n,r=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),o=e("./deviceMgr.js"),a=(n=o)&&n.__esModule?n:{default:n};var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.instance=null}return r(e,[{key:"changeAudioInputIfNeed",value:function(){var t=a.default.getInstance()._lastDeviceList.find(function(e){return"audioinput"===e.kind&&e.isInMeetingUsing});if(t){if(!a.default.getInstance()._deviceList.find(function(e){return e.deviceId===t.deviceId})){var e=a.default.getInstance().getInMeetingUsingDeviceByKind("audioinput");e&&inmeeting.changeAudioInput(e.deviceId)}}else{if(!this.isAudioTypeVoip())return;var i=a.default.getInstance().getInMeetingUsingDeviceByKind("audioinput");i&&inmeeting.changeAudioInput(i.deviceId)}}},{key:"changeVideoInputIfNeed",value:function(){}},{key:"isAudioTypeVoip",value:function(){return myStatusObject&&myStatusObject.audioType&&"AUDIO_VOIP"===myStatusObject.audioType}}],[{key:"getInstance",value:function(){return this.instance||(this.instance=new e),this.instance}}]),e}();i.default=s},{"./deviceMgr.js":27}],29:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n,r=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),o=e("./rendererMgr"),s=(n=o)&&n.__esModule?n:{default:n};var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.instance=null,this.displayInfoList=[],this.displayOperationTimeSupport=!1,this.displayChangeHandler=this.displayChangeHandler.bind(this);this.displayThrottle=_.throttle(this.displayChangeHandler,500,{leading:!1,trailing:!0}),this.setDisplayInfo=this.setDisplayInfo.bind(this),this.onDisplaysChange=this.onDisplaysChange.bind(this),this.promiseExchangePrimaryScreen=this.promiseExchangePrimaryScreen.bind(this),this.updatePrimaryWindowDisplayInfo=this.updatePrimaryWindowDisplayInfo.bind(this),this.orientation=null,this.onOrientationChange=this.onOrientationChange.bind(this)}return r(e,[{key:"setDisplayInfo",value:function(e){var t=(this.displayInfoList=e).find(function(e){return e.isPrimary});1===e.length&&t&&t.isInternal?this.displayOperationTimeSupport=!0:this.displayOperationTimeSupport=!1}},{key:"getDisplaysList",value:function(){return this.displayInfoList}},{key:"getIsDisplayOperationTimeSupport",value:function(){return this.displayOperationTimeSupport}},{key:"promiseGetDisplayInfo",value:function(){var i=this;return new Promise(function(t){chrome.system.display.getInfo({},function(e){i.setDisplayInfo(e),t(e)})})}},{key:"addDisplayesChangeListener",value:function(){chrome.system.display.onDisplayChanged.addListener(this.displayThrottle)}},{key:"displayChangeHandler",value:function(e){this.onDisplaysChange(),backgroundWindow.isKioskSession()&&kiosk.checkWhichUI()}},{key:"onDisplaysChange",value:function(){var t=this;return this.promiseGetDisplayInfo().then(function(e){return t.updatePrimaryWindowDisplayInfo(e),t.onOrientationChange(),e})}},{key:"onOrientationChange",value:function(){var e=this.getPrimaryWindowDisplay();null===this.orientation?this.orientation=e.rotation:this.orientation!==e.rotation&&(inmeeting.reConfigureVideoTrack(),inmeeting.rePostionShareWindow(),this.orientation=e.rotation)}},{key:"exchangeWindowToDisplay",value:function(){var t=s.default.getInstance().getWindow2();if(t){var e=this.getDisplaysList().find(function(e){return e.bounds.left===mainAppChromeWindow.outerBounds.left&&e.bounds.top===mainAppChromeWindow.outerBounds.top}),i=this.getDisplaysList().find(function(e){return e.bounds.left===t.outerBounds.left&&e.bounds.top===t.outerBounds.top}),n=e.bounds.left,r=e.bounds.top,o=i.bounds.left,a=i.bounds.top;mainAppChromeWindow.hide(),mainAppChromeWindow.restore(),mainAppChromeWindow.outerBounds.top=a,mainAppChromeWindow.outerBounds.left=o,mainAppChromeWindow.fullscreen(),mainAppChromeWindow.show(),setTimeout(responsiveScale,2500),t.hide(),t.restore(),t.outerBounds.top=r,t.outerBounds.left=n,t.fullscreen(),t.show(),setTimeout(t.contentWindow.responsiveScale,2500)}}},{key:"promiseExchangePrimaryScreen",value:function(){var e=this.getDisplaysList().find(function(e){return!e.isPrimary});return this.promiseSetDisplayProperties(e.id,{isPrimary:!0}).then(this.onDisplaysChange).catch(function(e){return console.error("promiseExchangePrimaryScreen failed")})}},{key:"promiseSetDisplayProperties",value:function(i,n){return new Promise(function(e,t){chrome.system.display.setDisplayProperties(i,n,function(){chrome.runtime.lastError?(console.error("promiseSetDisplayProperties failed"),t()):setTimeout(e,300)})})}},{key:"getPrimaryWindowDisplay",value:function(){return this.getDisplaysList().find(function(e){return e})}},{key:"updatePrimaryWindowDisplayMachineInNativeInfo",value:function(e){var t=void 0;return e&&e.modes&&(t=e.modes.find(function(e){return e.isSelected})),t?(machineInfo.widthInNativePixels=t.widthInNativePixels,machineInfo.heightInNativePixels=t.heightInNativePixels):(machineInfo.widthInNativePixels=machineInfo.width,machineInfo.heightInNativePixels=machineInfo.width),e}},{key:"updatePrimaryWindowDisplayMachineInfo",value:function(e){e=e||this.getPrimaryWindowDisplay(),machineInfo.width=e.bounds.width,machineInfo.height=e.bounds.height,this.updatePrimaryWindowDisplayMachineInNativeInfo(e)}},{key:"updatePrimaryWindowDisplayInfo",value:function(){var e=this.getPrimaryWindowDisplay();this.updatePrimaryWindowDisplayMachineInfo(e),common.postMessageToNaCl({command:"displayInfo",count:this.getDisplaysList().length,width:e.bounds.width,height:e.bounds.height,touch:e.hasTouchSupport,internal:e.isInternal,dpi:e.dpiX,rotation:e.rotation,widthInNativePixels:machineInfo.widthInNativePixels,heightInNativePixels:machineInfo.heightInNativePixels})}}],[{key:"getInstance",value:function(){return this.instance||(this.instance=new e),this.instance}}]),e}();i.default=a},{"./rendererMgr":30}],30:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),r=u(e("./class/screenWindow.class.js")),a=u(e("./displaysMgr")),o=u(e("./videoUserListMgr.js")),s=e("./FloatVideo.js");function u(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.instance=null,this.window2=void 0,this.window3=void 0,this.viceWinNum=0,this.exchangeWindowTmp=0,this.communicateWithPost=0,this.shareUserName="",this.videoUserList=[],this.addMessageListener(),this.COMMAND_MAP={requestVideo:this._naclReqeustVideo,stopVideo:this.checkCanStopVideo,requestAS:this._naclRequestAS,requestStopAS:this._naclRequestStopAS},this.bgStr=null,this.checkSecondaryScreenWindowByDisplays=this.checkSecondaryScreenWindowByDisplays.bind(this)}return n(e,[{key:"isDualScreen",value:function(){return this.window2||this.window3}},{key:"getWindow2",value:function(){return this.window2}},{key:"reset",value:function(){o.default.reset(),this.communicateWithPost?this._sendMessage("reset"):this.window2&&this.window2.contentWindow.reset()}},{key:"addMessageListener",value:function(){var n=this;chrome.runtime.onMessage.addListener(function(e,t,i){n.COMMAND_MAP[e.cmd]&&"function"==typeof n.COMMAND_MAP[e.cmd]&&(n.COMMAND_MAP[e.cmd].bind(n)(e),i())})}},{key:"addScreenWindow",value:function(i,n){var r=this;if(void 0===this.window2)this.window2=null,this.viceWinNum++;else{if(void 0!==this.window3)return Promise.resolve();this.window3=null,this.viceWinNum++}return new Promise(function(t){winMgr.getChromeAppWindow_promise().then(function(e){e.create("build/index2.html",{outerBounds:i,state:"fullscreen",frame:"none",alwaysOnTop:!0,focused:!1},function(e){e.contentWindow.backgroundWindow=backgroundWindow,e.contentWindow.addEventListener("load",function(){e.contentWindow.initScreenWindow(e,window),e.outerBounds.left=i.left,e.outerBounds.top=i.top,e.outerBounds.width=i.width,e.outerBounds.height=i.height,r.syncStatusAfterCreateScreenWindow(),t()}),e.displayId=n,null===r.window2?r.window2=e:r.window3=e,r.logPrimaryScreenBounds(),winMgr.setCreateWindowLock(!1)})})})}},{key:"logPrimaryScreenBounds",value:function(){mainAppChromeWindow.outerBounds.left,mainAppChromeWindow.outerBounds.top,mainAppChromeWindow.outerBounds.width,mainAppChromeWindow.outerBounds.height}},{key:"syncStatusAfterCreateScreenWindow",value:function(){this.bgStr&&this.syncBackgroundImage(this.bgStr),this.syncSelfVideoStream(),this.syncSelfVideoMirror(),this.syncShareUserName(),this.onActiveSpeakUser(inmeeting.getActiveUser())}},{key:"checkSecondaryScreenWindowByDisplays",value:function(e){if(e.length===this.viceWinNum+1){var t=a.default.getInstance().getPrimaryWindowDisplay(),i=e.find(function(e){return e.id!==t.id});return this.window2&&i&&(this.window2.displayId=i.id,this.window2.top=i.bounds.top,this.window2.left=i.bounds.left),Promise.resolve()}if(e.length>this.viceWinNum+1){for(var n=[],r=0;r<e.length;r++)if(e[r].id!==a.default.getInstance().getPrimaryWindowDisplay().id&&(void 0===this.window2||void 0===this.window3)){var o=this.addScreenWindow(e[r].bounds,e[r].id);n.push(o)}return Promise.all(n)}return this.window2&&!e.find(function(e){return e.id!==a.default.getInstance().getPrimaryWindowDisplay().id})&&(this.window2.contentWindow.reset(),this.window2.close(),this.logPrimaryScreenBounds(),this.viceWinNum--,this.window2=void 0),this.clearDualScreenUIIfSingleMonitor(),Promise.resolve()}},{key:"clearDualScreenUIIfSingleMonitor",value:function(){kiosk.changeToBackgroundViewForDualScreen(0),cmmDualScreen.onArrangeDisplays(0),cmmDualScreen.onPinInstruction({show:0})}},{key:"closeAllWindows",value:function(){this.window2&&(this.window2.contentWindow.reset(),this.window2.close())}},{key:"getVideoUserList",value:function(){return o.default.getVideoUserList()}},{key:"syncBackgroundImage",value:function(e){this.bgStr=e,this.window2&&this.window2.contentWindow&&this.window2.contentWindow.syncBackgroundImage&&this.window2.contentWindow.syncBackgroundImage("url("+e+")")}},{key:"onSyncBackgroundBlur",value:function(e){this.window2&&this.window2.contentWindow.onSyncBackgroundBlur(e)}},{key:"syncSelfVideoStream",value:function(){(0,s.getFloatScreenWindow)()&&(0,s.getFloatScreenWindow)().syncSelfVideoStream(mainAppHtmlWindow.videoStream,getMirrorEffect()),this.window2&&this.window2.contentWindow.syncSelfVideoStream(mainAppHtmlWindow.videoStream,getMirrorEffect())}},{key:"syncSelfVideoMirror",value:function(){(0,s.getFloatScreenWindow)()&&(0,s.getFloatScreenWindow)().syncSelfVideoMirror(getMirrorEffect()),this.window2&&this.window2.contentWindow.syncSelfVideoMirror(getMirrorEffect())}},{key:"syncShareUserName",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.shareUserName;this.shareUserName=e,(0,s.getFloatScreenWindow)()&&(0,s.getFloatScreenWindow)().syncShareUserName(e),this.window2&&this.window2.contentWindow.syncShareUserName(e)}},{key:"syncZoomRoomLogoShowHide",value:function(e){}},{key:"dispatchVideoData",value:function(e){(0,s.drawFloatVideoFrame)(e),this.window2&&(e.is_direct_share?this.window2&&this.window2.contentWindow.drawDirectShare(e):e.ssrc!==g.getMeetingStatusObj().activeShareUserId?this.window2&&this.window2.contentWindow.drawVideoFrame&&this.window2.contentWindow.drawVideoFrame(e):this.window2&&this.window2.contentWindow.drawGeneralShare(e))}},{key:"initConfView",value:function(){this.communicateWithPost?this._sendMessage("initConfView"):this.window2&&this.window2.contentWindow.initConfView()}},{key:"getFirstConfView",value:function(){return g.getMeetingStatusObj().isInWaitingRoom?"WaitingRoomView":null}},{key:"onUserJoin",value:function(e){var t=o.default.addVideoUser(e);t&&this._dispatchUserJoin(t)}},{key:"onUserLeft",value:function(e){o.default.removeVideoUser(e),this._dispatchUserLeft(e)}},{key:"onUserAudioStatusChange",value:function(e){o.default.onUserAudioStatusChange(e)&&this._dispatchAudioStatusChange(e)}},{key:"onUserVideoStatusChange",value:function(e){o.default.onUserVideoStatusChange(e)&&this._dispatchVideoStatusChange(e)}},{key:"onUserNetworkQualityChange",value:function(e){o.default.onUserNetworkQualityChange(e)&&this._dispatchNetworkQualityChange(e)}},{key:"onUserNameUpdate",value:function(e){o.default.onUserNameUpdate({userId:e.id,name:e.name})&&((0,s.getFloatScreenWindow)()&&(0,s.getFloatScreenWindow)().onUserNameUpdate({userId:e.id,name:e.name}),this.window2&&this.window2.contentWindow.onUserNameUpdate({userId:e.id,name:e.name}))}},{key:"onActiveSpeakUser",value:function(e){this._dispatchActiveSpeakUser(e)}},{key:"onDigitalSignageStatus",value:function(e){this._dispatchDigitalSignageStatus(e)}},{key:"onDigitalSignageChange",value:function(e,t,i,n){this._dispatchDigitalSignageChange(e,t,i,n)}},{key:"onGeneralShareStatus",value:function(e){g.getMeetingStatusObj().isLocalShareMeeting&&(this.communicateWithPost?this._sendMessage("onLocalShareFakeDirectShareStatus",e):this.window2&&this.window2.contentWindow.onLocalShareFakeDirectShareStatus(e))}},{key:"onDirectShareDataStatus",value:function(e){var t=g.getMeetingStatusObj().isLocalShareMeeting;this.communicateWithPost?this._sendMessage("onDirectShareDataStatus",e,t):this.window2&&this.window2.contentWindow.onDirectShareDataStatus(e,t)}},{key:"onHDMIStatus",value:function(e,t){var i={mediaStream:t,changeToBgView:g.getMeetingStatusObj().isLocalShareMeeting};this.communicateWithPost?this._sendMessage("onHDMIStatus",{start:e,arg:{mediaStream:t,changeToBgView:g.getMeetingStatusObj().isLocalShareMeeting}}):this.window2&&this.window2.contentWindow.onHDMIShareStatus(e,i)}},{key:"onSwitchCameraComplete",value:function(){this._dispatchSwitchCamCplt()}},{key:"blackTV",value:function(e){this.communicateWithPost?this._sendMessage("blackTV",e):this.window2&&this.window2.contentWindow.blackTV(e)}},{key:"onRendererScreenViewUpdate",value:function(e){if(!g.getMeetingStatusObj().isLocalShareMeeting&&!g.getMeetingStatusObj().isPSTNCalloutMeeting){var t=e.mulDisplayInstUIStatus[0];if(t&&kiosk.changeToBackgroundViewForDualScreen(t.viewRenderType===g.getConstants().BG_VIEW),this.window2){var i=e.mulDisplayInstUIStatus[1];if(i){if(0===g.getMeetingStatusObj().meetingNo&&(i.viewRenderType===g.getConstants().SINGLE_VIDEO_VIEW||i.viewRenderType===g.getConstants().GALLERY_VIEW||i.viewRenderType===g.getConstants().SHARE_VIEW))return;this.window2.contentWindow.onViewUpdate(i)}}}}},{key:"onWaitingRoom",value:function(e){this.communicateWithPost?this._sendMessage("onWaitingRoom",{flag:e,waitingTitle:g.getMeetingStatusObj().waitingTitle,topic:g.getMeetingStatusObj().meetingTopic}):this.window2&&this.window2.contentWindow.onWaitingRoom(e,{waitingTitle:g.getMeetingStatusObj().waitingTitle,topic:g.getMeetingStatusObj().meetingTopic})}},{key:"onPinInstruction",value:function(e){this.window2&&(e.num=2,this.window2.contentWindow.cmmDualScreen.onPinInstruction({show:e.isShow,num:2})),cmmDualScreen.onPinInstruction({show:e.isShow,num:1})}},{key:"onArrangeDisplays",value:function(e){var t=this;if(!(a.default.getInstance().getDisplaysList().length<2))switch(e.action){case"start":cmmDualScreen.onArrangeDisplays(1,1),this.window2&&this.window2.contentWindow.cmmDualScreen.onArrangeDisplays(1),this.exchangeWindowTmp&&(this.exchangeWindow(),this.exchangeWindowTmp=0);break;case"identify":if(cmmDualScreen.onArrangeDisplays(1,1),this.window2&&this.window2.contentWindow.cmmDualScreen.onArrangeDisplays(1,2),1===e.screenPos)break;this.exchangeWindow().then(function(){t.exchangeWindowTmp=1});break;case"cancel":cmmDualScreen.onArrangeDisplays(0),this.window2&&this.window2.contentWindow.cmmDualScreen.onArrangeDisplays(0),this.exchangeWindowTmp&&(this.exchangeWindow(),this.exchangeWindowTmp=0);break;case"confirm":this.exchangeWindowTmp=0,cmmDualScreen.onArrangeDisplays(0),this.window2&&this.window2.contentWindow.cmmDualScreen.onArrangeDisplays(0)}}},{key:"showShareInstruction",value:function(e,t){this.window2&&this.window2.contentWindow.showShareInstruction(e,t)}},{key:"syncShareInstructionHDMIStatus",value:function(e){this.window2&&this.window2.contentWindow.syncShareInstructionHDMIStatus(e)}},{key:"showWaitingForHost",value:function(e,t){this.window2&&this.window2.contentWindow.showWaitingForHost(e,t)}},{key:"greyScreen",value:function(e,t){this.window2&&this.window2.contentWindow.greyScreen(e,t)}},{key:"disabledAlertOnTV",value:function(e){this.window2&&this.window2.contentWindow.disabledAlertOnTV(e)}},{key:"exchangeWindow",value:function(){var e=this;return backgroundWindow.isKioskSession()?a.default.getInstance().promiseExchangePrimaryScreen().then(function(){responsiveScale(),e.window2&&e.window2.contentWindow.responsiveScale()}):(a.default.getInstance().exchangeWindowToDisplay(),Promise.resolve())}},{key:"checkCanStopVideo",value:function(e){var t=e.displayId,i=e.userId,n=!1;if(t){if(this.window2&&t===this.window2.displayId&&(0,s.getFloatScreenWindow)()){var r=(0,s.getFloatScreenWindow)().getRenderedVideoUserList();n=r&&r.some(function(e){return e===i})}}else n=this.window2&&this.window2.contentWindow.getRenderedVideoUserList().some(function(e){return e===i});n||this._naclStopVideo(e)}},{key:"_dispatchUserJoin",value:function(e){this.communicateWithPost?this._sendMessage("addVideoUser",e):this.window2&&this.window2.contentWindow.addVideoUser(e)}},{key:"_dispatchUserLeft",value:function(e){this.communicateWithPost?this._sendMessage("removeVideoUser",e):this.window2&&this.window2.contentWindow.removeVideoUser(e)}},{key:"_dispatchNetworkQualityChange",value:function(e){this.communicateWithPost?this._sendMessage("onUserNetworkQualityChange",e):((0,s.getFloatScreenWindow)()&&(0,s.getFloatScreenWindow)().onUserNetworkQualityChange(e),this.window2&&this.window2.contentWindow.onUserNetworkQualityChange(e))}},{key:"_dispatchVideoStatusChange",value:function(e){this.communicateWithPost?this._sendMessage("onUserVideoStatusChange",e):((0,s.getFloatScreenWindow)()&&(0,s.getFloatScreenWindow)().onUserVideoStatusChange(e),this.window2&&this.window2.contentWindow.onUserVideoStatusChange(e))}},{key:"_dispatchAudioStatusChange",value:function(e){this.communicateWithPost?this._sendMessage("onUserAudioStatusChange",e):((0,s.getFloatScreenWindow)()&&(0,s.getFloatScreenWindow)().onUserAudioStatusChange(e),this.window2&&this.window2.contentWindow.onUserAudioStatusChange(e))}},{key:"_dispatchActiveSpeakUser",value:function(e){this.communicateWithPost?this._sendMessage("onActiveSpeakUser",e):this.window2&&this.window2.contentWindow.onActiveSpeakUser(e)}},{key:"_dispatchDigitalSignageStatus",value:function(e){this.communicateWithPost?this._sendMessage("onDigitalSignageStatus",e):this.window2&&this.window2.contentWindow.onDigitalSignageStatus(e)}},{key:"_dispatchDigitalSignageChange",value:function(e,t,i,n){this.communicateWithPost?this._sendMessage("onDigitalSignageChange",e,t,i,n):this.window2&&this.window2.contentWindow.onDigitalSignageChange(e,t,i,n)}},{key:"_dispatchSwitchCamCplt",value:function(){this.communicateWithPost?this._sendMessage("onSwitchCamCplt"):((0,s.getFloatScreenWindow)()&&(0,s.getFloatScreenWindow)().onSwitchCamCplt(),this.window2&&this.window2.contentWindow.onSwitchCamCplt())}},{key:"_naclReqeustVideo",value:function(e){common.postMessageToNaCl({type:"video",command:"video.requestVideo",userID:e.userId,videoSize:e.videoSize})}},{key:"_sendMessage",value:function(e,t){chrome.runtime.sendMessage({cmd:e,param:t},function(e){})}},{key:"_naclStopVideo",value:function(e){common.postMessageToNaCl({type:"video",command:"video.stopVideo",userID:e.userId,videoSize:-1})}},{key:"_naclRequestAS",value:function(e){common.postMessageToNaCl({type:"share",command:"share.requestASData",userID:e.userId||g.getMeetingStatusObj().activeShareUserId,videoSize:e.videoSize})}},{key:"_naclRequestStopAS",value:function(e){common.postMessageToNaCl({type:"share",command:"share.stopASData",userID:e.userId||g.getMeetingStatusObj().activeShareUserId})}}],[{key:"getInstance",value:function(){return this.instance||(this.instance=new e),this.instance}},{key:"getFloatVideoScreenWindow",value:function(e){var t=document.createElement("canvas");$(e.container).append(t);var i={canvas:t,left:0,top:0,canvasWidth:e.maxWidth,canvasHeight:e.maxHeight,VideoUserListMgr:o.default,mountDom:e.container,emptyView:!0};return new r.default(i)}}]),e}();i.default=l},{"./FloatVideo.js":1,"./class/screenWindow.class.js":23,"./displaysMgr":29,"./videoUserListMgr.js":32}],31:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.equalUserId=function(e,t){return e>>10==t>>10},i.getRequestVideoSize=function(e,t){if(700<e)return u;if(270<e&&t<=4)return l;if(180<e&&t<=9)return c;return d},i.generateEmptyVideoElmt=function(e){return new n.default({viewContainer:e,videoUser:new r.default({}),hide:!0})},i.generateVideoElmtByVideoUser=function(e,t,i){if(i=void 0===i||i,!e||!t)return null;return e.videoIsSending?e.isMyself?new o.default({viewContainer:t,mediaStream:getSelfVideoStream(),mirror:getSelfVideoMirror(),videoUser:e,createDom:i}):new a.default({viewContainer:t,videoUser:e,createDom:i}):new n.default({viewContainer:t,videoUser:e,createDom:i})};var n=s(e("./class/ViewElement/avatarElmt.class")),r=s(e("./class/videoUser.class")),o=s(e("./class/ViewElement/camVideoElmt.class")),a=s(e("./class/ViewElement/nativeVideoElmt"));function s(e){return e&&e.__esModule?e:{default:e}}var u=3,l=2,c=1,d=0},{"./class/ViewElement/avatarElmt.class":3,"./class/ViewElement/camVideoElmt.class":6,"./class/ViewElement/nativeVideoElmt":10,"./class/videoUser.class":25}],32:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n,r=e("./class/videoUser.class.js"),o=(n=r)&&n.__esModule?n:{default:n},a=e("./rendererUtil.js");var s=[];function u(t){return s.find(function(e){return(0,a.equalUserId)(e.getUserId(),t)})}var l={getVideoUserById:u,getVideoUserList:function(){return s},addVideoUser:function(e){if(u(e.userId))return null;var t=new o.default(e);return t.index=s.length,s.push(t),t},removeVideoUser:function(e){var t,i=(t=e,s.findIndex(function(e){return(0,a.equalUserId)(e.getUserId(),t)}));if(-1<i){s.splice(i,1);for(var n=i;n<s.length;n++)s[n].index=n}},onUserAudioStatusChange:function(e){var t=u(e.userId);return!!t&&(t.setAudioType(e.audioType),t.setAudioIsMuted(e.audioIsMuted),!0)},onUserVideoStatusChange:function(e){var t=u(e.userId);return!(!t||(t.setVideoHasCamera(e.videoHasCamera),t.videoIsSending===e.videoIsSending)||(t.setVideoIsSending(e.videoIsSending),0))},onUserNetworkQualityChange:function(e){var t=u(e.userId);return!!t&&(t.setNetQuality(e.networkQuality),!0)},onUserNameUpdate:function(e){var t=u(e.userId);return!!t&&(t.setName(e.name),!0)},reset:function(){s.length=0}};i.default=l},{"./class/videoUser.class.js":25,"./rendererUtil.js":31}],33:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();i.VideoContainer=function(){function i(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this._rect=e,this._drawBg=t,this._layer=0,this._isNeedShow=!0,this._bkColor={r:34,g:34,b:34,a:255},this._videoPicture=null,this._cursorPicture=null,this._mirrorX=!1,this._mirrorY=!1}return n(i,[{key:"setMirror",value:function(e,t){this._mirrorX=e,this._mirrorY=t,this._videoPicture&&(this._videoPicture.picInfo.mirrorX=e,this._videoPicture.picInfo.mirrorY=t)}},{key:"getIsNeedShow",value:function(){return this._isNeedShow}},{key:"startShow",value:function(){this._isNeedShow=!0}},{key:"stopShow",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this._isNeedShow=!1,e&&(this._videoPicture=null,this._cursorPicture=null)}},{key:"clear",value:function(){this._videoPicture=null,this._cursorPicture=null}},{key:"setPicture",value:function(e,t,i){var n=3<arguments.length&&void 0!==arguments[3]&&arguments[3];if(e.rotation=void 0!==e.rotation?e.rotation:0,e.mirrorX=e.mirrorX||!1,e.mirrorY=e.mirrorY||!1,e.picType=void 0!==e.picType?e.picType:0,e.layer=void 0!==e.layer?e.layer:0,e.filter=void 0!==e.filter?e.filter:0,void 0!==e.logicWidth&&0!=e.logicWidth||(e.logicWidth=e.streamWidth),void 0!==e.logicHeight&&0!=e.logicHeight||(e.logicHeight=e.streamHeight),0!=e.streamWidth&&0!=e.streamHeight&&e.data&&0!=e.data.byteLength){(0==t.width||0==t.height||t.left<0||t.top<0||t.left+t.width>e.streamWidth||t.top+t.height>e.streamHeight)&&(t.left=t.top=0,t.width=e.streamWidth,t.height=e.streamHeight);var r={picInfo:e,croppingRect:t,dstArea:i};if(n){if(this._videoPicture){var o=this._videoPicture;r.dstArea.left=Math.floor(i.left*o.dstArea.width/o.picInfo.logicWidth)+o.dstArea.left,r.dstArea.top=Math.floor(i.top*o.dstArea.height/o.picInfo.logicHeight)+o.dstArea.top,r.dstArea.width=i.width*o.dstArea.width/o.picInfo.logicWidth,r.dstArea.height=i.height*o.dstArea.height/o.picInfo.logicHeight,this._cursorPicture=r}}else r.dstArea=this.adjustForFitToWindow(e,t),this._videoPicture=r}}},{key:"getPictures",value:function(){var e=[];return this._videoPicture&&e.push(this._videoPicture),this._cursorPicture&&e.push(this._cursorPicture),e}},{key:"adjustForFitToWindow",value:function(e,t){var i=this._rect,n=i.left,r=i.top,o=i.width,a=i.height,s=90==e.rotation||270==e.rotation?t.height/t.width:t.width/t.height;return i.width/i.height<=s?(a=o/s,r+=(i.height-a)/2):(o=a*s,n+=(i.width-o)/2),{left:n,top:r,width:o,height:a}}},{key:"dstRect",get:function(){return this._rect},set:function(e){e.left==this._rect.left&&e.top==this._rect.top&&e.width==this._rect.width&&e.height==this._rect.height||(this._rect=e,this._videoPicture&&(this._videoPicture.dstArea=this.adjustForFitToWindow(this._videoPicture.picInfo,this._videoPicture.croppingRect)))}},{key:"layer",get:function(){return this._layer},set:function(e){this._layer=e}},{key:"bkColor",set:function(e){this._bkColor=e},get:function(){return this._bkColor}},{key:"drawBg",get:function(){return this._drawBg}}]),i}()},{}],34:[function(e,t,i){"use strict";function n(){}Object.defineProperty(i,"__esModule",{value:!0}),(i.WebGLMatrix=n).prototype.translate=function(e,t,i){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,r=[1,0,0,0,0,1,0,0,0,0,1,0,t,i,n,1];return this.matrixMultiply(e,r)},n.prototype.rotate=function(e){1<arguments.length&&void 0!==arguments[1]&&arguments[1],2<arguments.length&&void 0!==arguments[2]&&arguments[2];var t,i,n,r=(360-arguments[3])*Math.PI/180,o=(t=r,i=Math.cos(t),n=Math.sin(t),[i,-n,0,0,n,i,0,0,0,0,1,0,0,0,0,1]);return this.matrixMultiply(e,o)},n.prototype.scale=function(e,t,i){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,r=[t,0,0,0,0,i,0,0,0,0,n,0,0,0,0,1];return this.matrixMultiply(e,r)},n.prototype.perspective=function(e,t,i,n){var r=1/Math.tan(e/2),o=1/(i-n);return[r/t,0,0,0,0,r,0,0,0,0,(n+i)*o,-1,0,0,2*n*i*o,0]},n.prototype.normalizeProject=function(e,t){return[2/e,0,0,0,0,-2/t,0,0,0,0,1,0,-1,1,0,1]},n.prototype.matrixMultiply=function(e,t){return n=t,r=(i=e)[0],o=i[1],a=i[2],s=i[3],u=i[4],l=i[5],c=i[6],d=i[7],h=i[8],f=i[9],v=i[10],p=i[11],m=i[12],g=i[13],y=i[14],w=i[15],_=n[0],b=n[1],S=n[2],k=n[3],I=n[4],V=n[5],C=n[6],E=n[7],D=n[8],U=n[9],M=n[10],L=n[11],P=n[12],T=n[13],x=n[14],O=n[15],[_*r+b*u+S*h+k*m,_*o+b*l+S*f+k*g,_*a+b*c+S*v+k*y,_*s+b*d+S*p+k*w,I*r+V*u+C*h+E*m,I*o+V*l+C*f+E*g,I*a+V*c+C*v+E*y,I*s+V*d+C*p+E*w,D*r+U*u+M*h+L*m,D*o+U*l+M*f+L*g,D*a+U*c+M*v+L*y,D*s+U*d+M*p+L*w,P*r+T*u+x*h+O*m,P*o+T*l+x*f+O*g,P*a+T*c+x*v+O*y,P*s+T*d+x*p+O*w];var i,n,r,o,a,s,u,l,c,d,h,f,v,p,m,g,y,w,_,b,S,k,I,V,C,E,D,U,M,L,P,T,x,O},n.prototype.makeIdentity=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{}],35:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.WebGLRender=void 0;var n=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),r=e("./webglMatrix"),o=e("./webglUtil"),a=e("./webglTextureRes"),s=e("./videoContainer");var u;i.WebGLRender=function(){function i(e){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this._canvas=e,this._contextGL,this._init=!1,this._webglUtil=new o.WebGLUtil,this._matUtil=new r.WebGLMatrix,this.ROTATION_CLOCK0=0,this.ROTATION_CLOCK90=1,this.ROTATION_CLOCK180=2,this.ROTATION_CLOCK270=3,this._ShaderScriptType={Vertex:0,FragYUV:1,FragRGBA:2,FragRGBA_NO_TEX:3},this._PicType={I420:0,RGBA:1,RGBA_NO_TEX:2},this._FilterType={normal:0,blur:1,gray:2,sharpness:3},this._viewWidth=Math.min(e.width,1920),this._viewHeight=Math.min(e.height,1080),this._isRendering=!0,this._renderList=[],this._last_draw_tick=0,this._requestID=null,this._frameRate=30,this._shaderScripts=new Map,this._programMap=new Map,this._attributeBuffers={vertexPos:null,texPos:null,bkColor:null},this._matrixs={projection:null,modelView:null,uMatrix:null},this._texVertLimit=new Array(4),this._textureRGBA=null,this._textureY=null,this._textureU=null,this._textureV=null,this._canvas.addEventListener("webglcontextlost",function(e){console.error("Trigger event [webglcontextlost]."),e.preventDefault(),t.stopRender(),t.reset(),t._init=!1},!1),this._canvas.addEventListener("webglcontextrestored",function(){console.error("Trigger event [webglcontextrestored]."),t.init(),t.startRender()},!1),this.init()}return n(i,[{key:"init",value:function(){this._init||(this.initContextGL(),this._contextGL&&(this.initMatrix(),this.initBuffers(),this.initTextures(),this.initProgram(),this.update()),this._init=!0)}},{key:"unInit",value:function(){0!=this._init&&(this.stopRender(),this.reset(),this.stopAllVideo(),this._init=!1)}},{key:"updateCanvasSize",value:function(e,t){e==this._viewWidth&&t==this._viewHeight||(this._viewWidth=Math.min(e,1920),this._viewHeight=Math.min(t,1080),this.setMatrix())}},{key:"startRender",value:function(){this._isRendering||(this._isRendering=!0,this.update())}},{key:"stopRender",value:function(){this._isRendering&&(this._isRendering=!1,this.drawBack())}},{key:"stopAllVideo",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,r=this._renderList[Symbol.iterator]();!(e=(n=r.next()).done);e=!0){var o=n.value;o.stopShow(),o.clear()}}catch(e){t=!0,i=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw i}}this._renderList=[]}},{key:"reset",value:function(){var e=this._contextGL,t=!0,i=!1,n=void 0;try{for(var r,o=this._programMap.values()[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var a=r.value;e.deleteProgram(a)}}catch(e){i=!0,n=e}finally{try{!t&&o.return&&o.return()}finally{if(i)throw n}}this._programMap.clear(),e.deleteBuffer(this._attributeBuffers.vertexPos),e.deleteBuffer(this._attributeBuffers.texPos),e.deleteBuffer(this._attributeBuffers.bkColor),this._attributeBuffers.vertexPos=null,this._attributeBuffers.texPos=null,this._attributeBuffers.bkColor=null,this._textureRGBA.unInit(),this._textureY.unInit(),this._textureU.unInit(),this._textureV.unInit(),this._textureRGBA=this._textureY=this._textureU=this._textureV=null}},{key:"createVideoContainer",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,i=new s.VideoContainer(e,t);return this._renderList.push(i),i}},{key:"update",value:function(){var e=this;if(this._isRendering){var t=Date.now();if(t-this._last_draw_tick>=this._frameRate){this.drawBack();var i=this._renderList;if(i&&0<i.length){var n=i.filter(function(e){return e&&e.getIsNeedShow()}).sort(function(e,t){return e.layer-t.layer}),r=!0,o=!1,a=void 0;try{for(var s,u=n[Symbol.iterator]();!(r=(s=u.next()).done);r=!0){var l=s.value;this.renderContainer(l)}}catch(e){o=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(o)throw a}}}this._last_draw_tick=t}this._requestID=requestAnimationFrame(function(){e.update()})}else this._requestID&&cancelAnimationFrame(this._requestID)}},{key:"triggerContextLoss",value:function(){u.loseContext()}},{key:"triggerContextRestore",value:function(){u.restoreContext()}},{key:"initContextGL",value:function(){for(var e=this._canvas,t=null,i=["webgl","experimental-webgl","moz-webgl","webkit-3d"],n=0;!t&&n<i.length;){var r=i[n];try{t=e.getContext(r,{lowLatency:!0})}catch(e){t=null}t&&"function"==typeof t.getParameter||(t=null),++n}this._contextGL=t,u=t.getExtension("WEBGL_lose_context")}},{key:"initProgram",value:function(){this.initShaderScript(),this.createProgram(this._PicType.I420)}},{key:"initShaderScript",value:function(){var e=["attribute vec4 vertexPos;","attribute vec4 texturePos;","attribute vec4 a_inColor;","varying vec4 outColor;","varying vec2 textureCoord;","uniform mat4 u_mvpMatrix;","uniform mat4 u_matrix;","void main()","{","gl_Position = u_matrix * vertexPos;","textureCoord = texturePos.xy;","outColor = a_inColor;","}"].join("\n"),t=(["precision highp float;","varying highp vec2 textureCoord;","uniform sampler2D ySampler;","uniform sampler2D uSampler;","uniform sampler2D vSampler;","const mat4 YUV2RGB = mat4","(","1.1643828125, 0, 1.59602734375, -.87078515625,","1.1643828125, -.39176171875, -.81296875, .52959375,","1.1643828125, 2.017234375, 0, -1.081390625,","0, 0, 0, 1",");","void main(void) {","highp float y = texture2D(ySampler,  textureCoord).r;","highp float u = texture2D(uSampler,  textureCoord).r;","highp float v = texture2D(vSampler,  textureCoord).r;","gl_FragColor = vec4(y, u, v, 1) * YUV2RGB;","}"].join("\n"),["precision highp float;","varying highp vec2 textureCoord;","uniform sampler2D ySampler;","uniform sampler2D uSampler;","uniform sampler2D vSampler;","uniform vec2 u_textureSize;","uniform highp vec4 st_limit;","uniform float u_kernel[9];","uniform float u_kernelWeight;","uniform float u_m[20];","const mat4 YUV2RGB = mat4","(","1.1643828125, 0, 1.59602734375, -.87078515625,","1.1643828125, -.39176171875, -.81296875, .52959375,","1.1643828125, 2.017234375, 0, -1.081390625,","0, 0, 0, 1",");","void main(void) {","highp vec2 new_texcoord = max(textureCoord.xy, st_limit.xy);","new_texcoord = min(new_texcoord.xy, st_limit.zw);","vec2 onePixel = vec2(1.0, 1.0) / u_textureSize;","highp float ySum =","texture2D(ySampler, new_texcoord + onePixel * vec2(-1, -1)).r * u_kernel[0] +","texture2D(ySampler, new_texcoord + onePixel * vec2( 0, -1)).r * u_kernel[1] +","texture2D(ySampler, new_texcoord + onePixel * vec2( 1, -1)).r * u_kernel[2] +","texture2D(ySampler, new_texcoord + onePixel * vec2(-1,  0)).r * u_kernel[3] +","texture2D(ySampler, new_texcoord + onePixel * vec2( 0,  0)).r * u_kernel[4] +","texture2D(ySampler, new_texcoord + onePixel * vec2( 1,  0)).r * u_kernel[5] +","texture2D(ySampler, new_texcoord + onePixel * vec2(-1,  1)).r * u_kernel[6] +","texture2D(ySampler, new_texcoord + onePixel * vec2( 0,  1)).r * u_kernel[7] +","texture2D(ySampler, new_texcoord + onePixel * vec2( 1,  1)).r * u_kernel[8] ;","highp float uSum =","texture2D(uSampler, new_texcoord + onePixel * vec2(-1, -1)).r * u_kernel[0] +","texture2D(uSampler, new_texcoord + onePixel * vec2( 0, -1)).r * u_kernel[1] +","texture2D(uSampler, new_texcoord + onePixel * vec2( 1, -1)).r * u_kernel[2] +","texture2D(uSampler, new_texcoord + onePixel * vec2(-1,  0)).r * u_kernel[3] +","texture2D(uSampler, new_texcoord + onePixel * vec2( 0,  0)).r * u_kernel[4] +","texture2D(uSampler, new_texcoord + onePixel * vec2( 1,  0)).r * u_kernel[5] +","texture2D(uSampler, new_texcoord + onePixel * vec2(-1,  1)).r * u_kernel[6] +","texture2D(uSampler, new_texcoord + onePixel * vec2( 0,  1)).r * u_kernel[7] +","texture2D(uSampler, new_texcoord + onePixel * vec2( 1,  1)).r * u_kernel[8] ;","highp float vSum =","texture2D(vSampler, new_texcoord + onePixel * vec2(-1, -1)).r * u_kernel[0] +","texture2D(vSampler, new_texcoord + onePixel * vec2( 0, -1)).r * u_kernel[1] +","texture2D(vSampler, new_texcoord + onePixel * vec2( 1, -1)).r * u_kernel[2] +","texture2D(vSampler, new_texcoord + onePixel * vec2(-1,  0)).r * u_kernel[3] +","texture2D(vSampler, new_texcoord + onePixel * vec2( 0,  0)).r * u_kernel[4] +","texture2D(vSampler, new_texcoord + onePixel * vec2( 1,  0)).r * u_kernel[5] +","texture2D(vSampler, new_texcoord + onePixel * vec2(-1,  1)).r * u_kernel[6] +","texture2D(vSampler, new_texcoord + onePixel * vec2( 0,  1)).r * u_kernel[7] +","texture2D(vSampler, new_texcoord + onePixel * vec2( 1,  1)).r * u_kernel[8] ;","highp float y = ySum / u_kernelWeight;","highp float u = uSum / u_kernelWeight;","highp float v = vSum / u_kernelWeight;","vec4 tmp = vec4(y, u, v, 1) * YUV2RGB;","gl_FragColor.r = u_m[0] * tmp.r + u_m[1] * tmp.g + u_m[2] * tmp.b + u_m[3] * tmp.a + u_m[4];","gl_FragColor.g = u_m[5] * tmp.r + u_m[6] * tmp.g + u_m[7] * tmp.b + u_m[8] * tmp.a + u_m[9];","gl_FragColor.b = u_m[10] * tmp.r + u_m[11] * tmp.g + u_m[12] * tmp.b + u_m[13] * tmp.a + u_m[14];","gl_FragColor.a = u_m[15] * tmp.r + u_m[16] * tmp.g + u_m[17] * tmp.b + u_m[18] * tmp.a + u_m[19];","}"].join("\n")),i=["precision highp float;","varying highp vec2 textureCoord;","uniform sampler2D s_texture;","void main(void) {","gl_FragColor = texture2D(s_texture, textureCoord);","}"].join("\n"),n=["precision highp float;","varying vec4 outColor;","void main(void) {","gl_FragColor = outColor;","}"].join("\n");this._shaderScripts.set(this._ShaderScriptType.Vertex,e),this._shaderScripts.set(this._ShaderScriptType.FragYUV,t),this._shaderScripts.set(this._ShaderScriptType.FragRGBA,i),this._shaderScripts.set(this._ShaderScriptType.FragRGBA_NO_TEX,n)}},{key:"getShaderScripts",value:function(e){var t=[];switch(e){case this._PicType.I420:t.push(this._shaderScripts.get(this._ShaderScriptType.Vertex)),t.push(this._shaderScripts.get(this._ShaderScriptType.FragYUV));break;case this._PicType.RGBA:t.push(this._shaderScripts.get(this._ShaderScriptType.Vertex)),t.push(this._shaderScripts.get(this._ShaderScriptType.FragRGBA));break;case this._PicType.RGBA_NO_TEX:t.push(this._shaderScripts.get(this._ShaderScriptType.Vertex)),t.push(this._shaderScripts.get(this._ShaderScriptType.FragRGBA_NO_TEX))}return t}},{key:"initBuffers",value:function(){var e=this._contextGL;this._attributeBuffers.vertexPos=e.createBuffer(),this._attributeBuffers.texPos=e.createBuffer(),this._attributeBuffers.bkColor=e.createBuffer()}},{key:"initTextures",value:function(){this._textureRGBA=new a.WebGLTextureRes(this._contextGL),this._textureY=new a.WebGLTextureRes(this._contextGL),this._textureU=new a.WebGLTextureRes(this._contextGL),this._textureV=new a.WebGLTextureRes(this._contextGL)}},{key:"initMatrix",value:function(){this._matUtil.makeIdentity();var e=this._matUtil.normalizeProject(this._viewWidth,this._viewHeight);this._matrixs.uMatrix=e}},{key:"setMatrix",value:function(){this._matrixs.uMatrix=this._matUtil.normalizeProject(this._viewWidth,this._viewHeight)}},{key:"createProgram",value:function(e){if(this._programMap.has(e))return this._programMap.get(e);var t=this.getShaderScripts(e);if(!t||2!=t.length)return console.error("createProgram error, invalid shader source."),null;var i=this._contextGL;if(i.isContextLost())return console.error("createProgram error, context lost."),null;var n=this._webglUtil.loadShader(i,t[0],i.VERTEX_SHADER),r=this._webglUtil.loadShader(i,t[1],i.FRAGMENT_SHADER);if(!i.isShader(n)||!i.isShader(r))return console.error("createProgram error, invalid shader."),null;var o=[n,r],a=this._webglUtil.createProgram(i,o);return i.isProgram(a)?(this._programMap.set(e,a),a):(console.error("createProgram error, invalid program."),null)}},{key:"drawBack",value:function(){var e=this._contextGL;e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}},{key:"setTexture",value:function(e,t,i){var n=this._contextGL;switch(e){case this._PicType.RGBA:this._textureRGBA.setTexture(t,i,n.RGBA,n.RGBA);break;case this._PicType.I420:this._textureY.setTexture(t,i,n.LUMINANCE,n.LUMINANCE),this._textureU.setTexture(t/2,i/2,n.LUMINANCE,n.LUMINANCE),this._textureV.setTexture(t/2,i/2,n.LUMINANCE,n.LUMINANCE);break;default:console.error("setTexture error pic type:",e)}}},{key:"renderContainer",value:function(e){if(e){var t=e.getPictures();if(t&&0!=t.length){t.sort(function(e,t){return e.picInfo.layer-t.picInfo.layer});for(var i=0;i<t.length;++i){var n=t[i].picInfo,r=t[i].croppingRect,o=[e.dstRect.width,e.dstRect.height],a=o[0],s=o[1],u=[r.width,r.height],l=u[0],c=u[1];0!=i||n.data&&0!=n.data.byteLength&&a*c==s*l&&90!=n.rotation&&270!=n.rotation||this.drawBackground(e.dstRect,e.bkColor),this.renderPicture(t[i])}}else e.drawBg&&this.drawBackground(e.dstRect,e.bkColor)}}},{key:"renderPicture",value:function(e){try{this._contextGL&&!this._contextGL.isContextLost()&&this.renderPictureGL(e)}catch(e){console.error("renderPicture exception: ",e)}}},{key:"renderPictureGL",value:function(e){var t=e.picInfo;if(t.data&&0!=t.data.byteLength&&0!=t.streamWidth&&0!=t.streamHeight){var i=this._contextGL,n=this.createProgram(t.picType);if(null!=n){i.useProgram(n),i.viewport(0,0,this._viewWidth,this._viewHeight);var r=void 0;switch(t.rotation){case 90:r=this.ROTATION_CLOCK90;break;case 180:r=this.ROTATION_CLOCK180;break;case 270:r=this.ROTATION_CLOCK270;break;case 0:default:r=this.ROTATION_CLOCK0}var o=t.streamWidth,a=t.streamHeight;this.setTexture(t.picType,o,a),this._webglUtil.updateVertexArray(this,e.croppingRect.width,e.croppingRect.height,e.dstArea,r),this._webglUtil.updateTextureArray(this,o,a,e.croppingRect,r,t.mirrorX,t.mirrorY);var s={vertexPos:{buffer:this._attributeBuffers.vertexPos,numComponents:2,normalize:!1},texturePos:{buffer:this._attributeBuffers.texPos,numComponents:2,normalize:!1}};switch(this._webglUtil.setAttributes(i,n,s),t.picType){case this._PicType.RGBA:this.drawRGBA(n,o,a,t.data);break;case this._PicType.I420:this.drawI420(n,o,a,t.data,t.filter);break;default:console.error("drawPicture error pic type:",t.picType)}}}}},{key:"drawBackground",value:function(e,t){if(e&&void 0!==e){var i=this._contextGL;if(i&&!i.isContextLost()){var n=this.createProgram(this._PicType.RGBA_NO_TEX);if(null!=n){i.useProgram(n),this._webglUtil.setVertexArray(this,e.left,e.top,e.width,e.height),this._webglUtil.setBkColorArray(this,t);var r={vertexPos:{buffer:this._attributeBuffers.vertexPos,numComponents:2,normalize:!1},a_inColor:{buffer:this._attributeBuffers.bkColor,numComponents:4,normalize:!1}};this._webglUtil.setAttributes(i,n,r);var o={u_matrix:this._matrixs.uMatrix};this._webglUtil.setUniforms(i,n,o),i.drawArrays(i.TRIANGLE_STRIP,0,4)}}}}},{key:"drawRGBA",value:function(e,t,i,n){if(0!=t&&0!=i&&n&&0!=n.byteLength){var r=this._contextGL,o={u_matrix:this._matrixs.uMatrix,s_texture:this._textureRGBA.getTexture()};this._webglUtil.setUniforms(r,e,o),r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),this._textureRGBA.updateTexture(r.TEXTURE0,0,0,t,i,r.RGBA,r.UNSIGNED_BYTE,n),r.drawArrays(r.TRIANGLE_STRIP,0,4),r.disable(r.BLEND)}}},{key:"drawI420",value:function(e,t,i,n,r){if(0!=t&&0!=i&&n&&0!=n.byteLength){var o=this._contextGL,a=r||this._FilterType.normal,s=this._webglUtil.getFilterMatrix(a),u=this._webglUtil.computeWeight(s),l=this._webglUtil.getColorWeight(a),c={u_matrix:this._matrixs.uMatrix,ySampler:this._textureY.getTexture(),uSampler:this._textureU.getTexture(),vSampler:this._textureV.getTexture(),st_limit:this._texVertLimit,u_textureSize:[t,i],"u_kernel[0]":s,u_kernelWeight:u,"u_m[0]":l};this._webglUtil.setUniforms(o,e,c);var d=t*i,h=n.subarray(0,d);this._textureY.updateTexture(o.TEXTURE0,0,0,t,i,o.LUMINANCE,o.UNSIGNED_BYTE,h);var f=d/4,v=n.subarray(d,d+f);this._textureU.updateTexture(o.TEXTURE1,0,0,t/2,i/2,o.LUMINANCE,o.UNSIGNED_BYTE,v);var p=f,m=n.subarray(d+f,d+f+p);this._textureV.updateTexture(o.TEXTURE2,0,0,t/2,i/2,o.LUMINANCE,o.UNSIGNED_BYTE,m),o.drawArrays(o.TRIANGLE_STRIP,0,4)}}},{key:"isWebGL",value:function(){return!!this._contextGL}}]),i}()},{"./videoContainer":33,"./webglMatrix":34,"./webglTextureRes":36,"./webglUtil":37}],36:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();i.WebGLTextureRes=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._gl=e,this._texWidth=0,this._texHeight=0,this._texRef=null,this.init()}return n(t,[{key:"init",value:function(){this.createTexture()}},{key:"unInit",value:function(){var e=this._gl;this._texRef&&e.isTexture(this._texRef)&&(e.deleteTexture(this._texRef),this._texRef=null,this._texWidth=this._texHeight=0)}},{key:"getTexture",value:function(){return this._texRef}},{key:"createTexture",value:function(){var e=this._gl;this._texRef&&e.isTexture(this._texRef)||(this._texRef=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this._texRef),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null))}},{key:"setTexture",value:function(e,t,i,n){if(0!=e&&0!=t){var r=this._gl;(0<this._texWidth&&this._texWidth!=e||0<this._texHeight&&this._texHeight!=t)&&(r.isTexture(this._texRef)&&r.deleteTexture(this._texRef),this._texRef=r.createTexture()),this._texWidth=e,this._texHeight=t,r.bindTexture(r.TEXTURE_2D,this._texRef),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texImage2D(r.TEXTURE_2D,0,i,e,t,0,n,r.UNSIGNED_BYTE,null),r.bindTexture(r.TEXTURE_2D,null)}else console.error("setTexture invalid texWidth/texHeight.")}},{key:"updateTexture",value:function(e,t,i,n,r,o,a,s){var u=this._gl;u.activeTexture(e),u.bindTexture(u.TEXTURE_2D,this._texRef),u.texSubImage2D(u.TEXTURE_2D,0,t,i,n,r,o,a,s)}}]),t}()},{}],37:[function(e,t,i){"use strict";function n(){}Object.defineProperty(i,"__esModule",{value:!0}),(i.WebGLUtil=n).prototype.loadShader=function(e,t,i){try{var n=e.createShader(i);return e.shaderSource(n,t),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)||e.isContextLost()?n:(console.error("Shader ("+i+") failed to compile: "+e.getShaderInfoLog(n)),e.deleteShader(n),null)}catch(e){return console.error("loadShader exception: ",e),null}},n.prototype.createProgram=function(t,e){try{var i=t.createProgram();return e.forEach(function(e){t.attachShader(i,e)}),t.linkProgram(i),t.getProgramParameter(i,t.LINK_STATUS)||t.isContextLost()?i:(console.error("Program failed to link: "+t.getProgramInfoLog(i)),t.deleteProgram(i),null)}catch(e){return console.error("createProgram exception: ",e),null}},n.prototype.setAttributes=function(r,o,e){try{Object.entries(e).forEach(function(e){var t=e[0],i=e[1],n=r.getAttribLocation(o,t);r.bindBuffer(r.ARRAY_BUFFER,i.buffer),r.enableVertexAttribArray(n),r.vertexAttribPointer(n,i.numComponents,i.type||r.FLOAT,i.normalize||!1,i.stride||0,i.offset||0)})}catch(e){console.error("setAttributes exception: ",e)}},n.prototype.setUniforms=function(a,s,e){try{for(var u=new Map,t=a.getProgramParameter(s,a.ACTIVE_UNIFORMS),i=0;i<t;++i){var n=a.getActiveUniform(s,i);n&&u.set(n.name,n)}var l=0;Object.entries(e).forEach(function(e){var t=e[0],i=e[1],n=i instanceof Array&&"[0]"===t.substr(-3),r=a.getUniformLocation(s,t);if(u.has(t)){var o=u.get(t).type;!function(e,t,i,n,r){switch(t){case e.FLOAT:r?e.uniform1fv(i,n):e.uniform1f(i,n);break;case e.FLOAT_VEC2:e.uniform2fv(i,n);break;case e.FLOAT_VEC3:e.uniform3fv(i,n);break;case e.FLOAT_VEC4:e.uniform4fv(i,n);break;case e.INT:case e.BOOL:r?e.uniform1iv(i,n):e.uniform1i(i,n);break;case e.INT_VEC2:case e.BOOL_VEC2:e.uniform2iv(i,n);break;case e.INT_VEC3:case e.BOOL_VEC3:e.uniform3iv(i,n);break;case e.INT_VEC4:case e.BOOL_VEC4:e.uniform4iv(i,n);break;case e.FLOAT_MAT2:e.uniformMatrix2fv(i,!1,n);break;case e.FLOAT_MAT3:e.uniformMatrix3fv(i,!1,n);break;case e.FLOAT_MAT4:e.uniformMatrix4fv(i,!1,n);break;case e.SAMPLER_2D:e.activeTexture(e.TEXTURE0+l),e.bindTexture(e.TEXTURE_2D,n),e.uniform1i(i,l++);break;case e.SAMPLER_CUBE:e.activeTexture(e.TEXTURE_CUBE_MAP+l),e.bindTexture(e.TEXTURE_2D,n),e.uniform1i(i,l++);break;default:console.error("setUniform error type: ",t)}}(a,o,r,i,n)}})}catch(e){console.error("setUniforms exception: ",e)}},n.prototype.DoMirrorX=function(e){try{var t=e[0],i=e[1];e[0]=e[2],e[1]=e[3],e[2]=t,e[3]=i,t=e[4],i=e[5],e[4]=e[6],e[5]=e[7],e[6]=t,e[7]=i}catch(e){console.error("DoMirrorX exception:",e)}},n.prototype.DoMirrorY=function(e){try{var t=e[0],i=e[1];e[0]=e[4],e[1]=e[5],e[4]=t,e[5]=i,t=e[2],i=e[3],e[2]=e[6],e[3]=e[7],e[6]=t,e[7]=i}catch(e){console.error("DoMirrorY exception:",e)}},n.prototype.DoRotate90=function(e){try{var t=e[2],i=e[3];e[2]=e[6],e[3]=e[7],e[6]=e[4],e[7]=e[5],e[4]=e[0],e[5]=e[1],e[0]=t,e[1]=i}catch(e){console.error("DoRotate90 exception:",e)}},n.prototype.CalcTexSize=function(e){for(var t=1;t<e;)t*=2;return t},n.prototype.updateVertexArray=function(e,t,i,n,r){if(0!=t&&0!=i&&0!=n.width&&0!=n.height){var o=n.left,a=n.top,s=n.width,u=n.height;this.setVertexArray(e,o,a,s,u)}else console.error("updateVertexArray error: invalid param: picWidth=%d,picHeight=%d,dstArea=%o",t,i,n)},n.prototype.updateTextureArray=function(e,t,i,n,r,o,a){if(0!=t&&0!=i){var s=n.left/t,u=n.top/i,l=(n.left+n.width)/t,c=(n.top+n.height)/i,d=[s,u,l,u,s,c,l,c];switch(e._texVertLimit[0]=(n.left+1)/t,e._texVertLimit[1]=(n.top+1)/i,e._texVertLimit[2]=(n.left+n.width-1)/t,e._texVertLimit[3]=(n.top+n.height-1)/i,r){case e.ROTATION_CLOCK90:e._webglUtil.DoRotate90(d),e._webglUtil.DoMirrorX(d),e._webglUtil.DoMirrorY(d);break;case e.ROTATION_CLOCK180:e._webglUtil.DoMirrorX(d),e._webglUtil.DoMirrorY(d);break;case e.ROTATION_CLOCK270:e._webglUtil.DoRotate90(d);break;case e.ROTATION_CLOCK0:}o&&e._webglUtil.DoMirrorX(d),a&&e._webglUtil.DoMirrorY(d);var h=e._contextGL;h.bindBuffer(h.ARRAY_BUFFER,e._attributeBuffers.texPos),h.bufferData(h.ARRAY_BUFFER,new Float32Array(d),h.DYNAMIC_DRAW)}else console.error("updateTextureArray error: invalid picture width or height!")},n.prototype.setVertexArray=function(e,t,i,n,r){var o=e._contextGL,a=[t,i,t+n,i,t,i+r,t+n,i+r];o.bindBuffer(o.ARRAY_BUFFER,e._attributeBuffers.vertexPos),o.bufferData(o.ARRAY_BUFFER,new Float32Array(a),o.DYNAMIC_DRAW)},n.prototype.setBkColorArray=function(e,t){var i=e._contextGL,n=t.r/255,r=t.g/255,o=t.b/255,a=t.a/255,s=[n,r,o,a,n,r,o,a,n,r,o,a,n,r,o,a];i.bindBuffer(i.ARRAY_BUFFER,e._attributeBuffers.bkColor),i.bufferData(i.ARRAY_BUFFER,new Float32Array(s),i.STATIC_DRAW)},n.prototype.getFilterMatrix=function(e){var t=[0,0,0,0,1,0,0,0,0];switch(e){case 1:t=[1,2,1,2,4,2,1,2,1];break;case 2:break;case 3:t=[0,-1,0,-1,5,-1,0,-1,0]}return t},n.prototype.getColorWeight=function(e){var t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];switch(e){case 2:t=[.3,.59,.11,0,0,.3,.59,.11,0,0,.3,.59,.11,0,0,0,0,0,1,0]}return t},n.prototype.computeWeight=function(e){var t=e.reduce(function(e,t){return e+t});return t<=0?1:t}},{}]},{},[26]);