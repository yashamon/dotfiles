"use strict";var invite=function(){var l=[],s=[],r=[],e=[],c=!1,u=!1,t={};function n(){r=[],e=[],$(".window-invite .contact-label-list,.window-invite .zr-label-list").empty(),$(".window-invite .invite-contact-li").removeClass("selected")}function o(){var i=6<=r.length?32*(Math.floor(r.length/6)+1):32,t=r.length%6*103+10,n=6<=r.length?32*Math.floor(r.length/6):0;$(".window-invite .invite-contact-filter").css({"padding-left":t,"padding-top":n,height:i})}function a(){var i=6<=e.length?32*(Math.floor(e.length/6)+1):32,t=e.length%6*103+10,n=6<=e.length?32*Math.floor(e.length/6):0;$(".window-invite .invite-zr-filter").css({"padding-left":t,"padding-top":n,height:i})}function d(t){r.splice(r.findIndex(function(i){return i.id===t}),1),$(".window-invite ."+t.split("@")[0]).remove(),$('.window-invite [data-jid="'+t+'"]').removeClass("selected"),o(),0===r.length&&0===e.length&&v(0)}function w(t){e.splice(e.findIndex(function(i){return i.id===t}),1),$(".window-invite ."+t.split("@")[0]).remove(),$('.window-invite [data-jid="'+t+'"]').removeClass("selected"),a(),0===r.length&&0===e.length&&v(0)}function v(i){i?$(".window-invite .button-invite").addClass("enabled").unbind("click").click(function(){var i=r.concat(e);mainAppHtmlWindow.joinmeeting.inviteBuddyToConf(i),M(),util.deferTodo(B,500)}):$(".window-invite .button-invite").removeClass("enabled").unbind("click")}function p(i){var t=$('<span class="filter-label label label-default"></span>').addClass(i.JID.split("@")[0]).attr("data-jid",i.JID).attr("title",i.email),n=$('<i class="del" tabindex="1"></i>');return t.text(i.screenName),t.prepend(n),t}function f(i){i?$(".window-invite .button-invite").removeClass("hideMe"):$(".window-invite .button-invite").addClass("hideMe")}function h(){var i=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];i&&t?$(".window-invite .btn-invite-phone").attr("tabindex","1").removeClass("disabled").unbind("click").click(function(i){var t=$(".window-invite .countrycode-span").text(),n=$(".window-invite #invite-number").val(),e=$(".window-invite #invite-number").val();mainAppHtmlWindow.inmeeting.startCallOut(t,n,e)}):!1===t?$(".window-invite .btn-invite-phone").unbind("click").click(function(i){mainAppHtmlWindow.inmeeting.cancelInviteByPhone()}):$(".window-invite .btn-invite-phone").attr("tabindex","-1").addClass("disabled").unbind("click")}function g(i){var t=function(i){for(var t=mainAppHtmlWindow.callOutInfoObject.callOutInfoList,n=null,e=0;e<t.length;e++)if(t[e].id==i){n=t[e];break}return n}(i);null!=t&&($(".window-invite span.country-flag").removeClass().addClass("country-flag img-flags country-"+i),$(".window-invite span.countrycode-span").text(t.code),$(".window-invite .calloutlist-li").removeClass("selected"),$('.window-invite .calloutlist-li[data-name="'+i+'"]').addClass("selected"))}function i(){g(mainAppHtmlWindow.callOutInfoObject.defaultCallOutCountryCodeID),$(".window-invite .countrylist-ul").empty();for(var i=mainAppHtmlWindow.callOutInfoObject.callOutInfoList,t=[],n=0;n<i.length;n++){var e=i[n],o='<li class="calloutlist-li " tabindex="1" data-name="'+e.id+'"><span class="left"><span class="img-flags country-'+e.id+'"></span><span class="country-name">'+e.name+'</span></span><span class="text right">'+e.code+"</span></li>";t.push(o)}$(".window-invite .countrylist-ul").append(t)}function m(){var i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";1<arguments.length&&void 0!==arguments[1]&&!arguments[1]?$(".window-invite .call-status").addClass("visibility-hidden"):$(".window-invite .call-status").removeClass("visibility-hidden").text(i)}function b(){!(0<arguments.length&&void 0!==arguments[0])||arguments[0]?($(".window-invite .btn-invite-phone").text("Cancel").addClass("calling"),h(!0,!1)):($(".window-invite .btn-invite-phone").text("Invite").removeClass("calling"),h())}var C=void 0;function y(i){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"The invitation URL has been copied to Clipboard.";clearTimeout(C),C=window.setTimeout(function(){y(0)},3e3),i?($(".window-invite .footer button").addClass("hideMe"),$(".window-invite .invite-msg").text(t).removeClass("hideMe").focus()):($(".window-invite .invite-msg").addClass("hideMe"),$(".window-invite .footer button").removeClass("hideMe"))}function k(){A()?$(".window-invite .tab1").css({"border-top-right-radius":"5px","border-bottom-right-radius":"5px"}):!mainAppHtmlWindow.g.getMeetingStatusObj().isSupportCallMe&&s.length?($(".window-invite .tab3").css({"border-top-right-radius":"5px","border-bottom-right-radius":"5px"}),$(".window-invite .tab1, .window-invite .tab2").css("border-top-right-radius","").css("border-bottom-right-radius","")):mainAppHtmlWindow.g.getMeetingStatusObj().isSupportCallMe||s.length||($(".window-invite .tab1").css("border-top-right-radius","").css("border-bottom-right-radius",""),$(".window-invite .tab2").css({"border-top-right-radius":"5px","border-bottom-right-radius":"5px"}))}function A(){return!mainAppHtmlWindow.g.getLoginState()||!mainAppHtmlWindow.g.getMeetingStatusObj().isSupportZoomIM}function W(i,t){if(i){var n=L(i);$(".window-invite .contact-list").empty().append(n),n=null}if(t){var e=L(t);$(".window-invite .zr-list").empty().append(e),e=null}}function L(a){for(var d=[],i=function(t){var i=util.getBgColorIndex(a[t].screenName),n=util.getAbbrName(a[t].screenName),e=$('<span class="icon-shortName icon-bgColor'+i+'">'+util.htmlEncode(n)+"</span>"),o=$('<div class="invite-contact-li"></div>').append($('<span class="name">'+util.htmlEncode(a[t].screenName)+"</span>")).attr("data-jid",a[t].JID).attr("title",a[t].email).addClass(-1<r.findIndex(function(i){return i===a[t].JID})?"selected":"").addClass(a[t].isZoomRoom?"zr-li":"").prepend(e);d.push(o)},t=0;t<a.length;t++)i(t);return d}function I(){$(".window-invite .contact-list").undelegate(".invite-contact-li","click").delegate(".invite-contact-li","click",function(){var i=$(this).attr("data-jid");if($(this).hasClass("selected"))d(i),$(this).removeClass("selected");else{var t=x(i);!function(i){r.push(i.JID);var t=p(i);$(".window-invite .contact-label-list").append(t),o(),v(1)}(t),M("buddy"),$(this).addClass("selected")}}),$(".window-invite .zr-list").undelegate(".invite-contact-li","click").delegate(".invite-contact-li","click",function(){var i=$(this).attr("data-jid");if($(this).hasClass("selected"))w(i),$(this).removeClass("selected");else{var t=S(i);!function(i){e.push(i.JID);var t=p(i);$(".window-invite .zr-label-list").append(t),a(),v(1)}(t),M("zr"),$(this).addClass("selected")}}),$(".window-invite .contact-label-list").undelegate(".del","click").delegate(".del","click",function(){var i=$(this).parent().attr("data-jid");d(i)}),$(".window-invite .zr-label-list").undelegate(".del","click").delegate(".del","click",function(){var i=$(this).parent().attr("data-jid");w(i)}),$(".window-invite .contact-list,.window-invite .zr-list").unbind("keydown").keydown(function(i){i.key.startsWith("Arrow")&&$(this).find(".invite-contact-li").attr("tabindex",2).eq(0).focus()}),$(".window-invite .contact-list,.window-invite .zr-list").undelegate(".invite-contact-li","keydown").delegate(".invite-contact-li","keydown",function(i){switch(i.key.startsWith("Arrow")&&i.stopPropagation(),i.key){case"ArrowUp":$(this).prevAll().eq(3).focus();break;case"ArrowDown":$(this).nextAll().eq(3).focus();break;case"ArrowLeft":$(this).prev().focus();break;case"ArrowRight":$(this).next().focus();break;case"Tab":i.preventDefault(),$(this).removeAttr("tabindex"),$(this).siblings().removeAttr("tabindex"),$(".window-invite .copy-url").focus();break;case"Enter":$(this).click()}}),util.deferTodo(T,1e3)}function T(){$(".window-invite .invite-contact-filter").unbind("input propertychange keydown").bind("input propertychange",function(i){var t=$(this).val().toLowerCase();2<t.length?(c=!0,mainAppHtmlWindow.joinmeeting.searchBuddyByKey(t)):(c=!1,W(l.filter(function(i){return-1<i.screenName.toLowerCase().indexOf(t)||-1<i.email.toLowerCase().indexOf(t)})))}).keydown(function(i){"Backspace"===i.key&&0===$(this).val().length&&0<r.length&&d(r[r.length-1])}),$(".window-invite .invite-zr-filter").unbind("input propertychange keydown").bind("input propertychange",function(i){var t=$(this).val().toLowerCase();2<t.length?(u=!0,mainAppHtmlWindow.joinmeeting.searchBuddyByKey(t)):(u=!1,W(null,s.filter(function(i){return-1<i.screenName.toLowerCase().indexOf(t)||-1<i.email.toLowerCase().indexOf(t)})))}).keydown(function(i){"Backspace"===i.key&&0===$(this).val().length&&0<e.length&&w(e[e.length-1])})}function M(i){void 0===i?$(".window-invite .invite-contact-filter,.window-invite .invite-zr-filter").val(""):"buddy"===i?$(".window-invite .invite-contact-filter").val(""):"zr"===i&&$(".window-invite .invite-zr-filter").val("")}function O(i,t){var n=i.screenName.trim().toUpperCase(),e=t.screenName.trim().toUpperCase();return n<e?-1:e<n?1:void 0}function x(t){return l.find(function(i){return i.JID===t})}function S(t){return s.find(function(i){return i.JID===t})}function B(){var i=mainAppHtmlWindow.winMgr.getWinByWinId("inviteWin");i?i.close():(n(),o(),a(),M(),v(0),$(".window-invite").addClass("hideMe"))}return{showInvite:function(){var i=mainAppHtmlWindow.winMgr.getWinByWinId("inviteWin");null===i?mainAppChromeWindow.isFullscreen()||backgroundWindow.isKioskApp()?client.toggleDivWindow("window-invite"):client.createInviteWindow():i.focus()},bindEvent:function(){$(".window-invite .tabs li").off("click").click(function(){$(".window-invite .tabs li").removeClass("selected").attr("aria-checked","false"),$(this).addClass("selected").attr("aria-checked","true"),$(".window-invite .tab_container .tab-content").hide();var i=$(this).find("span").attr("data-url");return $(i).show(),f(".tab2"===i||".tab3"===i?1:0),!1}),$(".window-invite .footer").undelegate("button","click").delegate("button","click",function(){var i=$(this).attr("data-btn");switch(i){case"url":util.copyText(mainAppHtmlWindow.g.getMeetingStatusObj().inviteURL),y(1);break;case"invitation":mainAppHtmlWindow.inmeeting.getCopyInviteInfo(function(i,t){util.copyText(t),y(1,"The invitation Email has been copied to Clipboard.")})}}),$(".window-invite .invite-btn").undelegate("img","click").delegate("img","click",function(){var i=$(this).attr("data-btn");switch(i){case"gmail":mainAppHtmlWindow.inmeeting.getGmailInviteInfo(function(i,t){window.open(t),B()});break;case"yahoo":mainAppHtmlWindow.inmeeting.getYahooInviteInfo(function(i,t){window.open(t),B()})}}),mainAppHtmlWindow.g.getMeetingStatusObj().isSupportCallMe&&($(".window-invite .countrylist-ul li").unbind("keydown").keydown(function(i){"Enter"===i.key&&$(this).click()}),$(".window-invite .countrylist-ul li:last").keydown(function(i){"Tab"===i.key&&!i.shiftKey&&$(".window-invite .tab4 .input-group-btn").removeClass("open"),$(".window-invite .tab4 .toggle-country").attr("aria-expanded","false")}),$(".window-invite .countrylist-ul").undelegate("li","click").delegate("li","click",function(i){var t=$(this).attr("data-name");g(t)}),$(".window-invite .tab4 input").unbind("input propertychange").bind("input propertychange",function(i){var t=$(".window-invite #invite-invitee").val(),n=$(".window-invite #invite-number").val();t.length&&n.length?$(".window-invite .btn-invite-phone").hasClass("disabled")&&h():h(!1)}),$(".window-invite .tab4 #invite-number").unbind("keydown").bind("keydown",function(i){return"("===i.key||")"===i.key||"+"===i.key||"-"===i.key||"Tab"===i.key||"Shift"===i.key||8==i.keyCode||46==i.keyCode||35==i.keyCode||36==i.keyCode||37==i.keyCode||39==i.keyCode||144==i.keyCode||!isNaN(i.key)&&32!==i.keyCode&&void 0}))},initCallInfoList:i,updateCallStatus:function(i){switch(i){case"CALLOUT_STATUS_CALLING":m("Callling..."),b();break;case"CALLOUT_STATUS_RINGING":m("Ringing...");break;case"CALLOUT_STATUS_ACCEPTED":m("Call accepted");break;case"CALLOUT_STATUS_NOT_AVAILABLE":m("Busy"),b(!1);break;case"CALLOUT_STATUS_NO_ANSWER":m("No answer"),setTimeout(function(){m("",!1)},3e3),b(!1);break;case"CALLOUT_STATUS_JOIN_SUC":m("Phone Connected");var t=mainAppHtmlWindow.winMgr.getWinByWinId("inviteWin");setTimeout(function(){m("",!1),b(!1),$(".window-invite").addClass("hideMe"),t&&t.close()},2e3);break;case"CALLOUT_STATUS_ZOOM_START_CANCELCALL":m("Disconnecting call");break;case"CALLOUT_STATUS_ZOOM_CALL_CACELED":m("",!1),b(!1)}},verifyInviteFeatures:function(){mainAppHtmlWindow.g.getMeetingStatusObj().isSupportCallMe?i():$(".window-invite .tab4").addClass("hideMe").hide(),A()?($(".window-invite .tab2").addClass("hideMe").hide(),$(".window-invite .tab3").addClass("hideMe").hide()):(s.length?W(l,s):($(".window-invite .tab3").addClass("hideMe").hide(),W(l)),I()),k()},refreshBuddyList:function(i){var t=Object.values(i);l=t.filter(function(i){return!i.isZoomRoom}).sort(O),s=t.filter(function(i){return i.isZoomRoom}).sort(O),W(l,s),I();var n=mainAppHtmlWindow.winMgr.getWinByWinId("inviteWin");isInsideMainAppWindow()&&n&&n.contentWindow.invite.refreshBuddyList(i)},refreshZoomRoomList:function(i){if(i.roomGroupCount){var t=[];for(var n in i)if(n.startsWith("buddyGroup")){var e=i[n],o=new RegExp(/^buddy[0-9]+$/);for(var a in e)o.test(a)&&t.push(e[a])}s=t.sort(O),$(".window-invite li.tab3").removeClass("hideMe").show(),$(".window-invite li.tab2").css("border-radius","unset"),k(),W(null,s),I();var d=mainAppHtmlWindow.winMgr.getWinByWinId("inviteWin");isInsideMainAppWindow()&&d&&d.contentWindow.invite.refreshZoomRoomList(i)}},clearInviteList:n,getBuddyAndRoomList:function(){return{buddyList:l,zrList:s}},setBuddyAndRoomList:function(i,t){l=i,s=t},onSearchByText:function(i){delete i.EVENT,delete i.TYPE;var t=Object.values(i),n=t.filter(function(i){return!i.isZoomRoom}),e=function(t){var i=l.find(function(i){return i.JID===n[t].JID});i?n[t].picBlobUrl=i.picBlobUrl:l.push(n[t])};for(var o in n)e(o);l.sort(O);var a=t.filter(function(i){return i.isZoomRoom}),d=function(t){var i=s.find(function(i){return i.JID===a[t].JID});i?a[t].picBlobUrl=i.picBlobUrl:s.push(a[t])};for(var o in a)d(o);s.sort(O),"none"!==$(".window-invite .tab2.tab-content").css("display")&&c?W(n):"none"!==$(".window-invite .tab3.tab-content").css("display")&&u&&W(null,a)},setPassword:function(){var i=mainAppHtmlWindow.g.getMeetingStatusObj().rawPassword;""!==i?$(".window-invite .footer .info-password").removeClass("hideMe").show().find("span").text(i):$(".window-invite .footer .info-password").addClass("hideMe").hide()},createTooltipWindow:function(t){var i=Math.round(screen.availWidth-350-10);mainAppHtmlWindow.winMgr.createWindow("tooltipWin","build/window/tooltipWindow.html",{width:350,height:67,left:i,top:50},function(i){i.contentWindow.tooltip.initTooltipWindow(t)})},getBuddyFromBuddyList:x,getZRFromZRList:S,concatName:function(i){var t=i;if(3<t.length){var n=t.length-2;t=(t=t.slice(0,3)).join(",").replace(/,(((?!,).)*)$/," and "+n+" others")}else t=t.join(",").replace(/,(((?!,).)*)$/," and $1");return t},onContactBaseInfo:function(i){t={zrCount:i.zrCount,groupCount:i.groupCount,contactCount:i.contactCount||t.contactCount,buddyCount:i.contactCount-i.zrCount}},getContactBaseInfo:function(){return t}}}();function initInviteWindow(){$(".window-invite .meeting-id").text(mainAppHtmlWindow.common.addShortLine(mainAppHtmlWindow.g.getMeetingStatusObj().meetingNo));var i=mainAppHtmlWindow.invite.getBuddyAndRoomList(),t=i.buddyList,n=i.zrList;invite.setBuddyAndRoomList(t,n),invite.verifyInviteFeatures(),invite.clearInviteList(),invite.setPassword(),a11y(),invite.bindEvent()}