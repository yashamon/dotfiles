"use strict";var poll=function(){function o(){$("#window-poll").html(mainAppHtmlWindow.inmeeting.getPollingWindowHtml()),mainAppHtmlWindow.g.getMeetingStatusObj().meetingIsViewOnly||$('.titlebar-right span[data-name="window-poll"]').removeClass("forceHide"),initSubmitPollingWindow()}return{initPollWin:function(){o()},refreshPollingWindowUI:o,clickOnce:function(){$("body").one("click",function(){$("#window-poll .host-mode .top-1 .pollinglist").addClass("hideMe")})}}}();function initSubmitPollingWindow(){$("#window-poll .host-mode .top-1 .right").undelegate("li","click").delegate("li","click",function(o){var t=$(this).attr("data-name");"arrow"==t?($("#window-poll .host-mode .top-1 .pollinglist").removeClass("hideMe"),poll.clickOnce()):"edit"==t&&util.openTab(mainAppHtmlWindow.editPollingURL),o.stopPropagation()}),$("#window-poll .host-mode .top-1 .pollinglist").undelegate("li","click").delegate("li","click",function(o){$("#window-poll .host-mode .top-1 .pollinglist").addClass("hideMe");var t=$(this).attr("data-pollingid"),i=findPollingItemById(t);"CLOSED"==i.pollingStateStr?(switchPollingTopandBottomUI("closed",i),switchSelectedPolling(t,1)):"NOT_START"==i.pollingStateStr&&(switchPollingTopandBottomUI("init",i),switchSelectedPolling(t,0))}),$("#window-poll .host-mode .bottom .status").undelegate("span","click").delegate("span","click",function(o){var t=$("#window-poll .host-mode .top-1 .pollinglist li.selected").attr("data-pollingid"),i=$(this).attr("data-name");"launch"==i&&mainAppHtmlWindow.inmeeting.startPoll(t),"relaunch"==i?mainAppHtmlWindow.inmeeting.reopenPoll(t):"share"==i?mainAppHtmlWindow.inmeeting.sharePollResult(t):"stopshare"==i?mainAppHtmlWindow.inmeeting.stopSharePollResult(t):"end"==i&&mainAppHtmlWindow.inmeeting.closePoll(t)}),$("#window-poll .viewer-mode .answer-item input").off("click").click(function(){var o=$(this).closest("dd").attr("data-answerid"),t=$(this).closest("dl").attr("data-questionid"),i=$(this).closest("div").attr("data-pollingid"),l=0;$(this).prop("checked")&&(l=1),mainAppHtmlWindow.inmeeting.setCheckToAnswer(i,t,o,l),refreshPollingSubmitButton(i)}),$("#window-poll .viewer-mode .bottom span.submitbtn").off("click").click(function(){if($(this).hasClass("enabled")){$(this).removeClass("enabled");var o=$("#window-poll .viewer-mode .polling-item.lanched").attr("data-pollingid");mainAppHtmlWindow.inmeeting.submitPoll(o)}}),$(".window-poll .viewer-mode .bottom span.closebtn").off("click").click(function(){window.close()})}function initPollingWindowUI(){mainAppHtmlWindow.myStatusObject.isHost||mainAppHtmlWindow.myStatusObject.isCoHost?($("#window-poll .viewer-mode").addClass("hideMe"),$("#window-poll .host-mode").removeClass("hideMe"),mainAppHtmlWindow.myStatusObject.isOrgHost?mainAppHtmlWindow.inmeeting.getEditPollingURL():$("#window-poll .host-mode .top-1 li.text").addClass("forceHide")):($("#window-poll .host-mode").addClass("hideMe"),$("#window-poll .viewer-mode").removeClass("hideMe"))}function refreshPollingWindowByActionResult(o){"POLL_CMD_SUBMIT"==o.action&&0==o.ret?mainAppHtmlWindow.client.showPollingWindow(0):"POLL_CMD_START"==o.action&&o.ret}function updatePollingDocObjectStatus(){findPollingItemById(mainAppHtmlWindow.pollingStatusObject.strPID).pollingStateStr=mainAppHtmlWindow.pollingStatusObject.action}function updatePollingResult(o){for(var t=0;t<mainAppHtmlWindow.pollingDocObject.pollingCount;t++)if(o.strPID==mainAppHtmlWindow.pollingDocObject["pollingItem"+t].pollingID){mainAppHtmlWindow.pollingDocObject["pollingItem"+t]=o.pollingItem;break}}function refreshPollingTime(){if(""==mainAppHtmlWindow.elaspedPollingTimeSec)$("#window-poll .host-mode .top-1 .right span.time").text("");else{var o=Math.floor(mainAppHtmlWindow.elaspedPollingTimeSec/60),t=Math.floor(mainAppHtmlWindow.elaspedPollingTimeSec-60*o);o<10&&(o="0"+o),t<10&&(t="0"+t),$("#window-poll .host-mode .top-1 .right span.time").text(o+":"+t)}}function refreshPollingWindowByStatus(o){if(void 0!==mainAppHtmlWindow.pollingStatusObject)if(updatePollingDocObjectStatus(),mainAppHtmlWindow.myStatusObject.isHost||mainAppHtmlWindow.myStatusObject.isCoHost){$("#window-poll .host-mode .polling-item").addClass("forceHide").removeClass("lanched");var t=findPollingItemById(mainAppHtmlWindow.pollingStatusObject.strPID);"CLOSED"==mainAppHtmlWindow.pollingStatusObject.action?(switchPollingTopandBottomUI("closed",t),refreshPollingResult(t),switchSelectedPolling(mainAppHtmlWindow.pollingStatusObject.strPID,1)):"SHARE_RESULT"==mainAppHtmlWindow.pollingStatusObject.action?(switchPollingTopandBottomUI("sharing",t),refreshPollingResult(t),switchSelectedPolling(mainAppHtmlWindow.pollingStatusObject.strPID,1)):"OPEN"==mainAppHtmlWindow.pollingStatusObject.action&&(refreshPollingResult(t),switchPollingTopandBottomUI("viewing",t),switchSelectedPolling(mainAppHtmlWindow.pollingStatusObject.strPID,1)),mainAppHtmlWindow.client.showPollingWindow(1)}else $("#window-poll .viewer-mode .polling-item").addClass("forceHide").removeClass("lanched"),"CLOSED"==mainAppHtmlWindow.pollingStatusObject.action?mainAppHtmlWindow.client.showPollingWindow(0):"SHARE_RESULT"==mainAppHtmlWindow.pollingStatusObject.action?($("#window-poll .viewer-mode .polling-submit").addClass("forceHide"),$("#window-poll .viewer-mode .polling-result").removeClass("forceHide"),$("#window-poll .viewer-mode .bottom .vote-notice").addClass("forceHide"),refreshPollingResult(mainAppHtmlWindow.pollingStatusObject.pollingItem),o||mainAppHtmlWindow.client.showPollingWindow(1)):"OPEN"==mainAppHtmlWindow.pollingStatusObject.action&&($("#window-poll .viewer-mode input[type=checkbox],[type=radio]").prop("checked",!1),$("#window-poll .viewer-mode .polling-submit").removeClass("forceHide"),$("#window-poll .viewer-mode .polling-result").addClass("forceHide"),$('.polling-item[data-pollingid="'+mainAppHtmlWindow.pollingStatusObject.strPID+'"]').removeClass("forceHide").addClass("lanched"),!mainAppHtmlWindow.g.getMeetingStatusObj().meetingIsViewOnly&&mainAppHtmlWindow.g.getMeetingStatusObj().isWebinar&&(mainAppHtmlWindow.g.getMeetingStatusObj().isAllowPanelistsVote?($("#window-poll .viewer-mode .bottom .vote-notice").addClass("forceHide"),$("#window-poll .viewer-mode .bottom .submitbtn").removeClass("forceHide")):($('.titlebar-right span[data-name="window-poll"]').removeClass("forceHide"),$("#window-poll .viewer-mode .bottom .vote-notice").removeClass("forceHide"),$("#window-poll .viewer-mode .bottom .submitbtn").addClass("forceHide"))),o||mainAppHtmlWindow.client.showPollingWindow(1));else mainAppHtmlWindow.myStatusObject.isHost||mainAppHtmlWindow.myStatusObject.isCoHost?(t=mainAppHtmlWindow.pollingDocObject.pollingItem0)&&"CLOSED"==t.pollingStateStr?(switchPollingTopandBottomUI("closed",t),refreshPollingResult(t),switchSelectedPolling(t.pollingID,1)):t&&"NOT_START"==t.pollingStateStr&&(switchPollingTopandBottomUI("init",t),switchSelectedPolling(t.pollingID,0)):mainAppHtmlWindow.client.showPollingWindow(0)}function switchSelectedPolling(o,t){var i=$('#window-poll .host-mode .top .pollinglist li[data-pollingid="'+o+'"]'),l=i.find("span").text();$("#window-poll .host-mode .top .pollinglist li").removeClass("selected"),i.addClass("selected"),$("#window-poll .host-mode .top-1 .left span.editable").text(l),$("#window-poll .host-mode .polling-submit .polling-item").addClass("forceHide"),$("#window-poll .host-mode .polling-result").addClass("forceHide"),t?(refreshPollingResult(findPollingItemById(o)),$("#window-poll .host-mode .polling-result").removeClass("forceHide")):$('#window-poll .host-mode .polling-submit .polling-item[data-pollingid="'+o+'"]').removeClass("forceHide")}function switchPollingTopandBottomUI(o,t){"init"==o?($("#window-poll .host-mode .top .not-sharing").removeClass("hideMe"),$("#window-poll .host-mode .top .sharing").addClass("hideMe"),$("#window-poll .host-mode .top .editable").removeClass("forceHide"),$("#window-poll .host-mode .top .viewing").addClass("forceHide"),$("#window-poll .host-mode .top .top-2").addClass("visibility-hidden"),$("#window-poll .host-mode .top .top-2 .status").addClass("hideMe"),$("#window-poll .host-mode .top").removeClass("viewing"),$("#window-poll .host-mode .bottom div.status").addClass("hideMe"),$("#window-poll .host-mode .bottom div.status-init").removeClass("hideMe")):"viewing"==o?($("#window-poll .host-mode .top .not-sharing").removeClass("hideMe"),$("#window-poll .host-mode .top .sharing").addClass("hideMe"),$("#window-poll .host-mode .top .editable").addClass("forceHide"),$("#window-poll .host-mode .top .viewing").removeClass("forceHide"),$("#window-poll .host-mode .top .top-2").removeClass("visibility-hidden"),$("#window-poll .host-mode .top .top-2 .status").addClass("hideMe"),$("#window-poll .host-mode .top .top-2 .status-viewing").removeClass("hideMe"),$("#window-poll .host-mode .top .top-2 .status-viewing span.right").text(t.totalVotedUserCount+" voted"),$("#window-poll .host-mode .top").addClass("viewing"),$("#window-poll .host-mode .bottom div.status").addClass("hideMe"),$("#window-poll .host-mode .bottom div.status-viewing").removeClass("hideMe")):"closed"==o?($("#window-poll .host-mode .top .not-sharing").removeClass("hideMe"),$("#window-poll .host-mode .top .sharing").addClass("hideMe"),$("#window-poll .host-mode .top .editable").removeClass("forceHide"),$("#window-poll .host-mode .top .viewing").addClass("forceHide"),$("#window-poll .host-mode .top .top-2").removeClass("visibility-hidden"),$("#window-poll .host-mode .top .top-2 .status").addClass("hideMe"),$("#window-poll .host-mode .top .top-2 .status-closed span.right").text(t.totalVotedUserCount+" voted"),$("#window-poll .host-mode .top .top-2 .status-closed").removeClass("hideMe"),$("#window-poll .host-mode .top").removeClass("viewing"),$("#window-poll .host-mode .bottom div.status").addClass("hideMe"),$("#window-poll .host-mode .bottom div.status-closed").removeClass("hideMe")):"sharing"==o&&($("#window-poll .host-mode .top .sharing").removeClass("hideMe"),$("#window-poll .host-mode .top .not-sharing").addClass("hideMe"),$("#window-poll .host-mode .top .top-2").removeClass("visibility-hidden"),$("#window-poll .host-mode .top .top-2 .status").addClass("hideMe"),$("#window-poll .host-mode .top .top-2 .status-sharing").removeClass("hideMe"),$("#window-poll .host-mode .top").addClass("viewing"),$("#window-poll .host-mode .bottom div.status").addClass("hideMe"),$("#window-poll .host-mode .bottom div.status-sharing").removeClass("hideMe"))}function refreshPollingDoc(o){refreshPollingDoc4HostMode(o),refreshPollingDoc4ViewerMode(o)}function refreshPollingDoc4HostMode(o){$("#window-poll .host-mode .polling-submit").empty(),$("#window-poll .host-mode .pollinglist ul").empty();for(var t=0;t<o.pollingCount;t++){$("#window-poll .host-mode .polling-submit").append(getSubmitPollingItem(o["pollingItem"+t]));var i='<li data-pollingid="'+o["pollingItem"+t].pollingID+'"  data-pollingname="'+mainAppHtmlWindow.util.htmlEncode(o["pollingItem"+t].pollingName)+'"><i class="img-sprite"></i><span>Polling '+(t+1)+": "+mainAppHtmlWindow.util.htmlEncode(o["pollingItem"+t].pollingName)+"</span></li>";$("#window-poll .host-mode .pollinglist ul").append(i)}0<o.pollingCount&&switchSelectedPolling(o.pollingItem0.pollingID,0),$("#window-poll .host-mode .polling-submit .answer-item input").prop("disabled",!0)}function refreshPollingDoc4ViewerMode(o){$("#window-poll .viewer-mode .result-submit").empty();for(var t=0;t<o.pollingCount;t++)$("#window-poll .viewer-mode .result-submit").append(getSubmitPollingItem(o["pollingItem"+t]))}function refreshPollingResult(o){if(mainAppHtmlWindow.myStatusObject.isHost||mainAppHtmlWindow.myStatusObject.isCoHost){$("#window-poll .host-mode .polling-result").empty();for(var t=0;t<o.questionCount;t++)$("#window-poll .host-mode .polling-result").append(getSharePollingQuestionItem(o,t));$("#window-poll .host-mode .top .top-2 .status-viewing span.right").text(o.totalVotedUserCount+" voted")}else{$("#window-poll .viewer-mode .result-share").empty();for(t=0;t<o.questionCount;t++)$("#window-poll .viewer-mode .result-share").append(getSharePollingQuestionItem(o,t))}}function findPollingItemById(o){for(var t=null,i=0;i<mainAppHtmlWindow.pollingDocObject.pollingCount;i++)if(o==mainAppHtmlWindow.pollingDocObject["pollingItem"+i].pollingID){t=mainAppHtmlWindow.pollingDocObject["pollingItem"+i];break}return t}function getSharePollingQuestionItem(o,t){var i=o["questionItem"+t],l=o.totalVotedUserCount,e="multi"==i.questionType?" (Multiple Choice)":"",n='<dl class="question-item" >';n+='<dt class="question-text">'+(t+1)+". "+mainAppHtmlWindow.util.htmlEncode(i.questionText)+e+"</dt>";i.questionType;for(var s=0;s<i.answerCount;s++){var d=i["answerItem"+s],a=0,p="";(mainAppHtmlWindow.myStatusObject.isHost||mainAppHtmlWindow.myStatusObject.isOrgHost||mainAppHtmlWindow.myStatusObject.isCoHost)&&(p='<span class="count">('+d.selectedCount+")</span> "),0<l&&(a=Math.round(d.selectedCount/l*100));var m="#2CA5FF";d.isMaxSelectedCount&&"OPEN"!=o.pollingStateStr&&(m="#FF7800"),n+='<dd class="answer-item" ><div class="bar-title"><span class="bar-name">'+mainAppHtmlWindow.util.htmlEncode(d.answerText)+'</span><span class="bar-value">'+p+a+'%</span></div><div class="bar-container"><div class="bar" style="width:'+a+"%;background: "+m+'"></div></div></dd>'}return n+="</dl>"}function refreshPollingSubmitButton(o){var t=!0;$('#window-poll .viewer-mode .polling-item[data-pollingid="'+o+'"] dl.question-item').each(function(){if(0==$(this).find("input:checked").length)return t=!1}),t?$("#window-poll .viewer-mode .bottom span.submitbtn").addClass("enabled"):$("#window-poll .viewer-mode .bottom span.submitbtn").removeClass("enabled")}function getSubmitPollingItem(o){for(var t='<div class="polling-item forceHide" data-pollingid="'+o.pollingID+'">',i=0;i<o.questionCount;i++){t+=getSubmitQuestionItem(o["questionItem"+i],i)}return t+="</div>"}function getSubmitQuestionItem(o,t){var i='<dt class="question-text">'+(t+1)+". "+mainAppHtmlWindow.util.htmlEncode(o.questionText)+"</dt>",l='<dl class="question-item" data-questionid="'+o.questionID+'">';l+=i;var e="radio";"multi"==o.questionType&&(e="checkbox");for(var n=0;n<o.answerCount;n++){var s=o["answerItem"+n];l+='<dd class="answer-item" data-answerid="'+s.answerID+'"><label><input type="'+e+'" name="'+o.questionID+'"  /><span>'+mainAppHtmlWindow.util.htmlEncode(s.answerText)+"</span></label></dd>"}return l+="</dl>"}