"use strict";var meetingID=void 0,meetingPassword=void 0,meetingScreenName=void 0,meetingLoginType=void 0,meetingLoginToken=void 0,meetingUid=void 0,meetingDomain=void 0,webinarToken=void 0,meetingTrackingId=void 0,meetingEmail=void 0,meetingZak=void 0,meetingZakt=void 0,webLaunchUrlSchemeParams={},mainAppWin=void 0,normalExit=void 0,joinedMeeting=void 0,registerEmail="",registerName="",currentWebDomain="",isKioskBuild=0,isKioskSession_=!1,appMainWindowExisted=0,checkWindowTimer=void 0,defaultWidth=void 0,defaultHeight=void 0,isWeblaunched=!1,isRejoin=!1;function getIsWeblaunched(){return isWeblaunched}function setIsWeblaunched(e){isWeblaunched=e}function getDefaultWidth(){return defaultWidth}function getDefaultHeight(){return defaultHeight}function setNormalExit(){normalExit=!0,chrome.storage.local.remove("lcpString",function(){})}var isMainWindowExist=void 0,mainWindowExistTimer=void 0;function setMainWindowExist(){isMainWindowExist=!0,clearTimeout(mainWindowExistTimer),mainWindowExistTimer=setTimeout(setMainWindowNotExist,2e3)}function setMainWindowNotExist(){isMainWindowExist=!1}function setJoinedMeeting(){joinedMeeting=!0}function setWebDomain(e){chrome.storage.local.set({webDomain:e},function(){}),currentWebDomain=e}function getWebDomain(){return currentWebDomain}function setRegisterEmail(e){registerEmail=e}function getRegisterEmail(){return registerEmail}function setRegisterName(e){registerName=e}function getRegisterName(){return registerName}function getMeetingID(){return meetingID}function clearMeetingID(){meetingID=""}function getMeetingPassword(){return meetingPassword}function getMeetingScreenName(){return meetingScreenName}function getMeetingLoginType(){return meetingLoginType}function getMeetingLoginToken(){return meetingLoginToken}function getMeetingUid(){return meetingUid}function getMeetingDomain(){return meetingDomain}function getWebinarToken(){return webinarToken}function getMeetingTrackingId(){return meetingTrackingId}function getMeetingEmail(){return meetingEmail}function getMeetingZak(){return meetingZak}function getMeetingZakt(){return meetingZakt}function getWebLaunchUrlSchemeParams(){return webLaunchUrlSchemeParams}function isKioskApp(){return isKioskBuild}function isKioskSession(){return isKioskSession_}function getIsRejoin(){return isRejoin}function setIsRejoin(e){isRejoin=e}function checkWindow(){var e=!1;isMainWindowExist&&(chrome.storage.local.set({lastActiveTime:(new Date).getTime()},function(){}),e=!0),!joinedMeeting||e||normalExit||createWindow("/index.html",!0)}function startJoinProcess(e){mainAppWin.contentWindow.joinmeeting&&!mainAppWin.contentWindow.joinmeeting.ifInMeeting()&&(mainAppWin.contentWindow.joinmeeting.startCheckWindowHeartBeat(),e||mainAppWin.contentWindow.joinmeeting.setJoinParameters(meetingID,meetingPassword,meetingScreenName,meetingLoginType,meetingLoginToken,meetingUid,meetingDomain,webinarToken,meetingTrackingId,meetingEmail,meetingZak,meetingZakt,webLaunchUrlSchemeParams,e),mainAppWin.contentWindow.joinmeeting.joinBtnBindEventListener(),mainAppWin.contentWindow.joinmeeting.bindForm(),mainAppWin.contentWindow.common.registTimer(checkWindowTimer))}function createWindow(e,i){setIsRejoin(i),joinedMeeting=normalExit=!1;var t=void 0,o=void 0,r=void 0,n=void 0,a=void 0;o=screen.availHeight-60,r=o-158,r=9*Math.floor(r/9),(t=16*r/9)>screen.availWidth&&(t=screen.availWidth,o=(r=9*t/16)+158),t<(n=982)&&(t=n);var s=Math.floor(9*n/16);o<(a=s+120+30+4+4)&&(o=a),n=260,a=282;var c="normal";isKioskApp()?(t=screen.availWidth,o=screen.availHeight,c="fullscreen"):(defaultWidth=t,defaultHeight=o),appMainWindowExisted=0;var m=chrome.app.window.getAll(),d=void 0;for(d in m)if(""===m[d].id){appMainWindowExisted=1;break}chrome.app.window.create(e,{id:"",innerBounds:{width:t,height:o,minWidth:n,minHeight:a},resizable:!0,frame:"none",state:c},function(e){if(isKioskApp()&&(e.contentWindow.onkeydown=e.contentWindow.onkeyup=function(e){27===e.keyCode&&e.preventDefault()}),e.onClosed.addListener(function(){onAppClose()}),mainAppWin=e,isKioskApp()||(checkWindowTimer&&clearInterval(checkWindowTimer),checkWindowTimer=setInterval(checkWindow,2e3)),e.innerBounds.height!=o&&(r=e.innerBounds.height-158,r=9*Math.floor(r/9),t=16*r/9,e.resizeTo(t,e.innerBounds.height)),e.contentWindow.backgroundWindow=window,(e.contentWindow.mainWindow=e).contentWindow.addEventListener("load",function(){startJoinProcess(i),e.contentWindow.getAppVersion()}),1==appMainWindowExisted)try{startJoinProcess(i)}catch(e){}var n=void 0;try{n=chrome.app.window.get("webviewWin")}catch(e){}n&&n.close()})}function onLaunched(e){e.isKioskSession&&(isKioskSession_=!0),webinarToken=meetingDomain=meetingUid=meetingScreenName=meetingPassword=meetingID="",createWindow("/index.html",!(meetingLoginType=-1)),chrome.storage.local.get("lastActiveTime",function(e){e.lastActiveTime&&(6e4<(new Date).getTime()-e.lastActiveTime&&(backgroundLog("clear lcp to avoid failover recovery due to timeout"),chrome.storage.local.remove("lcpString")))})}function parseUrlParams(n){var i={};try{i=n.split("?")[1].split("&").reduce(function(e,n){var i=n.split("=");return e[i[0]]=decodeURIComponent(i[1]),e},{})}catch(e){i={},console.error("parse url error",n,e)}return i}function onAppClose(){isWeblaunched=!1,isKioskApp()&&chrome.storage.local.set({screenName:"Chrome OS User"},function(e){}),chrome.power&&chrome.power.releaseKeepAwake&&chrome.power.releaseKeepAwake(),chrome.storage.local.get("keepLogin",function(e){e.keepLogin||chrome.storage.local.remove("userToken")})}chrome.app.runtime.onLaunched.addListener(onLaunched),chrome.runtime.onMessageExternal.addListener(function(e,n,i){if("webssologin"===e.action)mainAppWin&&mainAppWin.contentWindow.joinmeeting&&!e.status&&mainAppWin.contentWindow.parseZoomusProtocolForSSO2(e.token);else if("googlelogin"===e.action)mainAppWin&&mainAppWin.contentWindow.joinmeeting&&!e.errorno&&e.launch_url&&mainAppWin.contentWindow.parseZoomusProtocol(e.launch_url);else if("facebooklogin"===e.action)mainAppWin&&mainAppWin.contentWindow.joinmeeting&&!e.errorno&&e.launch_url&&mainAppWin.contentWindow.parseZoomusProtocolForFB(e.launch_url);else{setIsWeblaunched(!0);var t=n.url.split("/");meetingDomain=t[2],webLaunchUrlSchemeParams=parseUrlParams(e.urlscheme),meetingID=e.meetingid,meetingPassword=e.password,meetingScreenName=e.username,meetingLoginType=parseInt(e.stype,10),meetingLoginToken=e.token,meetingUid=e.uid,webinarToken=e.wtk,meetingTrackingId=e.tid,meetingEmail=e.email,meetingZak=e.zak,meetingZakt=e.zakt}createWindow("/index.html",!1),i("success")});