"use strict";var silentCrashTimer,naclHangupTimer,appObject={},_jsCrash=[];function getAppVersion(){var e=chrome.runtime.getManifest();appObject.version=e.version_name}appObject.version="Unknown";try{getAppVersion()}catch(e){}function handleErr(e,n,o,r,a){return!1}function findAddress(e,n){if(n.length<1)return"MAP Unavailable";if(e<n[0].offs)return"Invalid Address";for(var o=0,r="",a=1;a<n.length;a++)if(e<n[a].offs){for(o=e-n[a-1].offs,(r=n[a-1].file)?40<r.length&&(r=r.substr(r.length-40)):r="Unknown";r.length<40;)r=" "+r;return r+" "+n[a-1].name+" + 0x"+o.toString(16)}return r+" "+n[n.length-1].name+" + 0x"+o.toString(16)}function buildTextMap(e){for(var n=e.split("\n"),o=[],r=!1,a="",t=0;t<n.length;t++){var s,i=n[t];if(0!==i.lastIndexOf(" .text",0)){if(r){if(1==(s=i.trim().split(/\s{4,}/)).length){r=!1,t++;continue}var l=parseInt(s[0],16);if(0==l){r=!1;continue}var c={offs:l,name:s[1],file:a};o.push(c)}}else r=!0,a=(s=i.trim().split(/\s+/))[3]}return o.sort(function(e,n){return e.offs-n.offs}),o}var needCloseAllWindow=!0;function disableCrashCloseAllWindow(){needCloseAllWindow=!1}function basicCrashInfo(){var e;return e="Version: "+appObject.version+"\n",e+="UA: "+navigator.userAgent+"\n",userStatus&&(e+="Name: "+userStatus.userName+"\n",e+="ID: "+userStatus.userID+"\n"),e}function handlePossibleSilentCrash(){clearTimeout(naclHangupTimer),clearTimeout(silentCrashTimer),silentCrashTimer=setTimeout(function(){var e="NaCl silently crashed.\n"+basicCrashInfo();console.error(e),backgroundWindow&&backgroundWindow.console.error(e),saveToLocal("lastCrash",e),$("#crashlog").text(e),$("#crash_logger").removeClass("hideMe").css("z-index",10),setTimeout(function(){needCloseAllWindow&&closeAllWindow()},2e3)},6e3)}function handleNaClHangup(){var e="NaCl hangup.\n"+basicCrashInfo();console.error(e),backgroundWindow&&backgroundWindow.console.error(e),saveToLocal("lastCrash",e),$("#crashlog").text(e),$("#crash_logger").removeClass("hideMe").css("z-index",10),setTimeout(function(){needCloseAllWindow&&closeAllWindow()},2e3)}function handleNaClHeartBeatSignal(){clearTimeout(naclHangupTimer),clearTimeout(silentCrashTimer),naclHangupTimer=setTimeout(handleNaClHangup,15e3)}function logCrashAndCloseAllWindow(e){silentCrashTimer&&clearTimeout(silentCrashTimer),console.error(e),backgroundWindow&&backgroundWindow.console.error(e),saveToLocal("lastCrash",e),$("#crashlog").text(e),$("#crash_logger").removeClass("hideMe").css("z-index",10),setTimeout(function(){needCloseAllWindow&&closeAllWindow()},5e3)}function updateStack(e,n,o){n=buildTextMap(n);for(var r="NaCl crashed.\n"+basicCrashInfo()+"\n",a=0;a<e.frames.length;a++){var t=e.frames[a].prog_ctr;if(0!=t){var s=findAddress(t,n),i=("0000000"+t.toString(16)).substr(-8).toUpperCase();r+="["+a.toString(10)+"][0x"+i+"] "+s+"\n"}}o?console.error(r):logCrashAndCloseAllWindow(r)}function fetchMap(e,n,o){var r=new XMLHttpRequest;r.open("GET",e,!0),r.onload=function(){updateStack(n,this.responseText,o)},r.onerror=function(){var e="NaCl crashed.\n"+basicCrashInfo()+"\n";logCrashAndCloseAllWindow(e+=JSON.stringify(n))},r.traceinfo=n,r.send()}function handleCrashMessage(e){var n=JSON.parse(e);fetchMap("/clang-newlib/Release/zoom_"+n.arch+".map",n,!1)}function parseCrashMessage(e){fetchMap("/clang-newlib/Release/zoom_"+e.arch+".map",e,!0)}function uploadCrashLog(e){}function activeCrash(){common.postMessageToNaCl({command:"zoomDebug",action:"activeCrash"})}function activeHangup(){common.postMessageToNaCl({command:"zoomDebug",action:"activeHangup"})}window.onerror=function(e,n,o,r,a){console.error(e),console.error(a.stack)},$.Event.prototype.stopPropagation=function(){if("keydown"!==this.type&&"keyup"!==this.type||27!==this.keyCode){this.isPropagationStopped=function(){return!0};var e=this.originalEvent;e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)}},$.fn.removeStyle=function(e){var o=new RegExp(e+"[^;]+;?","g");return this.each(function(){$(this).attr("style",function(e,n){if(n)return n.replace(o,"")})})},$.fn.focusIn=function(){return this},$.fn.focusOut=function(){return this};