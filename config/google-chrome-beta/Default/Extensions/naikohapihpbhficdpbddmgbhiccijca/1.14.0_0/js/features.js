(function(){var c,b=[null,1,1.333333,1.777778,1.666666,2.21,2.35,2.39,1.25],a=["Default","1:1","4:3","16:9","16:10","2.21:1","2.35:1","2.39:1","5:4"];mejs.Utility.storage.get("aspectRatio",0,function(d){c=d});MediaElementPlayer.prototype.resizeVideo=function(){var e,d=window.innerHeight,f=window.innerWidth;if(c===0){e=this.media.videoWidth/this.media.videoHeight}else{e=b[c]}if(d*e<=f){this.media.style.width=(e*100)+"vh";this.media.style.height="100vh"}else{this.media.style.width="100vw";this.media.style.height=(100/e)+"vw"}};MediaElementPlayer.prototype.setAspectRatio=function(d){chrome.contextMenus.update(c+"a",{checked:false});c=parseInt(d);this.resizeVideo();this.notify("Aspect Ratio: "+a[c]);chrome.contextMenus.update(c+"a",{checked:true});mejs.Utility.storage.set("aspectRatio",c)};MediaElementPlayer.prototype.cycleAspectRatio=function(){this.setAspectRatio((c+1)%b.length)}})();(function(){MediaElementPlayer.prototype.autosrt=function(){if(!packaged_app){return}var b=this,a;b.media.addEventListener("loadeddata",function(){if(!a||!b.playlist[b.playIndex].fileEntry){return}chrome.fileSystem.getDisplayPath(b.playlist[b.playIndex].fileEntry,function(d){var c=d.slice(a.path.length+1).split(".").slice(0,-1).join(".")+".srt";a.entry.getFile(c,{},function(e){e.file(function(f){b.filterFiles([f])})},function(){})})});$("<li/>").append($('<label style="width:210px;float:left;">Enable auto-srt</label>')).append($('<button id="allowedAutoSrtButton" style="width:140px">Select Folder</button>')).appendTo($("#settings_list"));$("#allowedAutoSrtButton").on("click",function(c){c.stopPropagation();chrome.fileSystem.chooseEntry({type:"openDirectory"},function(d){if(chrome.runtime.lastError){return}chrome.fileSystem.getDisplayPath(d,function(e){$("#allowedAutoSrtButton").text("..."+e.slice(-15));a={path:e,entry:d};mejs.Utility.storage.set("autoSrtRetainId",chrome.fileSystem.retainEntry(d))})})});mejs.Utility.storage.get("autoSrtRetainId",null,function(c){if(c===null){return}chrome.fileSystem.restoreEntry(c,function(d){if(chrome.runtime.lastError){return}chrome.fileSystem.getDisplayPath(d,function(e){$("#allowedAutoSrtButton").text("..."+e.slice(-15));a={path:e,entry:d}})})})}})();(function(){MediaElementPlayer.prototype.subdelay=function(){var b=this,c=b.captionsButton.find(".mejs-captions-selector");b.capDelayInput=$('<input type="number" step="0.1"></input>').on("input",function(d){b.capDelayValue=parseFloat(d.target.value)||0;b.notify("Captions Delay: "+(b.capDelayValue*1000).toFixed()+"ms")});b.capDelayInput.attr({value:0});b.capDelayValue=0;b.decCaptionDelay=function(){b.capDelayValue-=0.1;b.capDelayInput.attr({value:b.capDelayValue.toFixed(1)});b.notify("Captions Delay: "+(b.capDelayValue*1000).toFixed()+"ms")};b.incCaptionDelay=function(){b.capDelayValue+=0.1;b.capDelayInput.attr({value:b.capDelayValue.toFixed(1)});b.notify("Captions Delay: "+(b.capDelayValue*1000).toFixed()+"ms")};var a=$('<li class="mejs-captionsize"></li>').append($("<label>Caption delay</label>")).append(b.capDelayInput);c.find("ul").append(a);b.media.addEventListener("loadeddata",function(){b.capDelayInput.attr({value:0});b.capDelayValue=0})}})();(function(){MediaElementPlayer.prototype.subsize=function(){var b=this,c=b.captionsButton.find(".mejs-captions-selector");function a(){$(".mejs-captions-layer").css({"line-height":b.capSizeValue+"px","font-size":b.capSizeValue+"px"})}b.capSizeInput=$('<input type="number" min="10" max="50" step="2"></input>').on("input",function(d){b.capSizeValue=parseInt(d.target.value)||0;mejs.Utility.storage.set("default_sub_size",b.capSizeValue);a()});b.decCaptionSize=function(){b.capSizeValue=Math.min(b.capSizeValue-2,50);mejs.Utility.storage.set("default_sub_size",b.capSizeValue);b.capSizeInput.attr({value:b.capSizeValue.toFixed()});a()};b.incCaptionSize=function(){b.capSizeValue=Math.max(b.capSizeValue+2,10);mejs.Utility.storage.set("default_sub_size",b.capSizeValue);b.capSizeInput.attr({value:b.capSizeValue.toFixed()});a()};$('<li class="mejs-captionsize"></li>').append($("<label>Caption size</label>")).append(b.capSizeInput).appendTo(c.find("ul"));mejs.Utility.storage.get("default_sub_size",22,function(d){b.capSizeInput.attr({value:Number(d).toFixed()});b.capSizeValue=d;a()})}})();(function(){MediaElementPlayer.prototype.contextmenu=function(){if(!packaged_app){return}var a=this;chrome.contextMenus.onClicked.addListener(function(b){if(b.parentMenuItemId&&b.parentMenuItemId.startsWith("set")){a[b.parentMenuItemId](b.menuItemId)}else{a[b.menuItemId]()}})}})();(function(){MediaElementPlayer.prototype.drop=function(){var a=this;$(document).on("dragover dragleave",function(b){b.preventDefault();b.stopPropagation()},false).on("drop",function(b){b.preventDefault();b.stopPropagation();a.filterFiles(b.dataTransfer.files,false)},false)}})();(function(){var a=mejs.i18n.t("Fullscreen");MediaElementPlayer.prototype.fullscreen=function(){var b=this,c=$('<div class="mejs-button mejs-fullscreen-button"><button type="button" title="'+a+'" aria-label="'+a+'"></button></div>').on("click",function(){b.toggleFullscreen()}).appendTo(b.rightControls);$(document).on("webkitfullscreenchange",function(){c.toggleClass("mejs-unfullscreen-button")},false)};MediaElementPlayer.prototype.toggleFullscreen=function(){document.webkitIsFullScreen?document.webkitCancelFullScreen():this.container.get().webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}})();(function(){MediaElementPlayer.prototype.help=function(){var a=this;a.openHelp=function(){chrome.app.window.create("wiki.html",{id:"wiki",outerBounds:{width:1040,height:600}})};$('<div class="mejs-button mejs-help-button mejs-help"><button type="button" title="'+mejs.i18n.t("Help...")+'" aria-label="'+mejs.i18n.t("Help...")+'"></button></div>').appendTo(a.rightControls).on("click",function(b){b.preventDefault();a.openHelp()})}})();(function(){MediaElementPlayer.prototype.info=function(){var a=this,c='<div class="mejs-window" style="width:650px;"><img src="icon.png" style="width:80px;height:auto;"/><h2>Subtitle Videoplayer v1.14.0</h2>Please visit our project <a href="https://github.com/guancio/ChromeOsSubtitle">home page</a>.This software is possible thanks to several open source projects:<ul><li>The main media player component is a fork of <a id="link_mediaelement" href="http://mediaelementjs.com/">MediaelEment.js</a>, developed by John Dyer</li><li>Zip files are opened using <a href="http://gildas-lormeau.github.io/zip.js/" target="_blank">zip.js</a></li><li>Subtitles service is powered by <a href="http://www.OpenSubtitles.org" target="_blank">www.OpenSubtitles.org</a>. More uploaded subs means more subs available. Please upload <a href="http://www.opensubtitles.org/upload" target="_blank">here</a> your subs.<br/><a href="http://www.OpenSubtitles.org" target="_blank"><img src="opensubtitle.gif"/></a></li></ul><br>[Click the box to close the info page]</div>',b=$(c).appendTo(a.container).on("click",function(d){d.preventDefault();d.stopPropagation();a.toggleInfo()});b.find("a").on("click",function(d){window.open(this.href,"_blank");d.stopPropagation()});a.toggleInfo=function(){b.css("visibility")==="visible"?b.hide():b.show()};$('<div class="mejs-button mejs-info-button mejs-info"><button type="button" title="'+mejs.i18n.t("About...")+'" aria-label="'+mejs.i18n.t("About...")+'"></button></div>').appendTo(a.rightControls).on("click",function(d){d.preventDefault();a.toggleInfo()})}})();(function(){var a=null;MediaElementPlayer.prototype.notification=function(){this.notification=$('<div class="mejs-notification"></div>').hide().appendTo(this.container)};MediaElementPlayer.prototype.notify=function(c,b){this.notification.text(c).show();this.startNotificationTimer(b)};MediaElementPlayer.prototype.startNotificationTimer=function(c){var b=this;if(a!==null){clearTimeout(a)}a=setTimeout(function(){a=null;b.notification.hide()},c||1000)}})();(function(){MediaElementPlayer.prototype.opensubtitle_uploader=function(){var k=this;var j=0.001;function i(){k.opensubtitleService.service.SearchMoviesOnIMDB({params:[k.opensubtitleService.token,k.openedFile.name],onException:function(m){console.log("SearchIMDB Failed");console.log(m)},onComplete:function(m){console.log(m)}})}function h(q,p,r,m,n,s,o){k.opensubtitleService.service.UploadSubtitles({params:[k.opensubtitleService.token,{baseinfo:{idmovieimdb:q},cd1:{subhash:p,subfilename:r,moviehash:m,moviebytesize:n,moviefilename:s,subcontent:o}}],onException:function(t){console.log(t);console.log("Upload failed")},onComplete:function(t){console.log(t);console.log("Upload Succes")}})}function a(o,q,n){var p=new zip.BlobReader(k.selectedTrack.file);var m=new zip.BlobWriter("application/gzip");function s(r){}zip.createGZipWriter(m,function(r){r.gzip(p,function(u){var t=new FileReader();t.onload=function(w){console.log(u);console.log(w.target.result);h(q,o,k.selectedTrack.file.name,n,0,"",w.target.result.split(",")[1]);var v=document.createElement("a");v.download="aaa.gz";v.innerHTML="Download File";v.href=window.webkitURL.createObjectURL(new Blob([w.target.result.split(",")[1]]));document.body.appendChild(v);v.click()};t.readAsDataURL(u)},s,s,s)})}function d(m,n){k.opensubtitleService.service.CheckMovieHash({params:[k.opensubtitleService.token,[n]],onException:function(o){console.log("CheckMovieHash Failed");console.log(o)},onComplete:function(p){var o=null;if(!p.result.data||p.result.data[n].length==0){console.log("IMDB search not implemented");return}o=p.result.data[n].MovieImdbID;a(m,o,n)}})}function g(m,n){k.opensubtitleService.service.TryUploadSubtitles({params:[k.opensubtitleService.token,{cd1:{subhash:m,subfilename:k.selectedTrack.file.name,moviehash:n,moviebytesize:k.openedFile.size,moviefilename:k.openedFile.name}}],onException:function(o){console.log("TryUpload Failed");console.log(o)},onComplete:function(o){console.log("tried");console.log(o);if(o.result.alreadyindb==1){console.log("Already in DB");return}console.log("Not in DB");d(m,n)}})}function b(n){var m=new FileReader();m.onloadend=function(o){var p=o.target.result;console.log(md5(p));g(md5(p),n)};m.readAsText(k.selectedTrack.file)}function c(){OpenSubtitlesHash(k.openedFile,function(m){b(m)})}function l(){k.opensubtitleService.uploader.uploadAttempts=1;k.resetOpenSubUploader();k.opensubtitleService.service.LogIn({params:[k.opensubtitleService.uploader.username,k.opensubtitleService.uploader.pwd,"","ChromeSubtitleVideoplayer"],onException:function(m){console.log(m);console.log("Authentiation failed")},onComplete:function(m){console.log(m);k.opensubtitleService.token=m.result.token;console.log("logged");c()}})}k.resetOpenSubUploader=function(){var n=Math.ceil(k.media.duration?k.media.duration:1);var o=new Array(n+1);for(var m=0;m<=n;m++){o[m]=false}k.opensubtitleService.uploader.watched=o;k.opensubtitleService.uploader.lastSec=0;k.opensubtitleService.uploader.lastCheck=0};k.opensubtitleService.uploader={watched:[],lastSec:0,lastCheck:0,username:"",pwd:"",autoUpload:true,uploadAttempts:0};k.resetOpenSubUploader();k.media.addEventListener("loadeddata",function(){k.resetOpenSubUploader();k.opensubtitleService.uploader.uploadAttempts=0});$(document).bind("subtitleChanged",function(){k.resetOpenSubUploader();k.opensubtitleService.uploader.uploadAttempts=0});k.media.addEventListener("timeupdate",function(r){if(k.opensubtitleService.uploader.uploadAttempts>0){return}var q=k.opensubtitleService.uploader;var o=Math.floor(k.media.currentTime);var m=q.lastSec;q.lastSec=o;if(k.selectedTrack==null){return}if(k.selectedTrack.srclang!="fromfile"){return}if(k.capDelayValue!=0){k.resetOpenSubUploader();return}if(Math.abs(o-m)<5){q.watched[o]=true}if(Math.abs(o-q.lastCheck)>=5){var p=0;for(var n=0;n<Math.ceil(k.media.duration);n++){if(q.watched[n]){p+=1}}console.log(o);console.log(p);q.lastCheck=o;console.log(p/Math.ceil(k.media.duration)*100);if(p/k.media.duration>j){console.log("To upload");l()}}},false);var f=$("#settings_list")[0];$("<li/>").appendTo(f).append($('<label style="width:250px; float:left;">Automatic opensubtitle.org upload</label>')).append($('<input type="checkbox" id="autoOpenSubtitleUpload" checked="true" name="autoOpenSubtitleUpload" value="yes"/>'));var e=$("#autoOpenSubtitleUpload")[0];$("<li/>").appendTo(f).append($('<label style="width:250px; float:left;">Opensubtitle username</label>')).append($('<input id="usernameOpenSubtitle" style="width:100px;background-color: transparent; color: white;"/>'));$("#usernameOpenSubtitle").keydown(function(m){m.stopPropagation();return true});$("<li/>").appendTo(f).append($('<label style="width:250px; float:left;">Opensubtitle password</label>')).append($('<input id="pwdOpenSubtitle" type="password" style="width:100px;background-color: transparent; color: white;"/>'));$("#pwdOpenSubtitle").keydown(function(m){m.stopPropagation();return true});if(localStorage.getItem("opensubtitle_username")){k.opensubtitleService.uploader.username=localStorage.getItem("opensubtitle_username");$("#usernameOpenSubtitle")[0].value=k.opensubtitleService.uploader.username}if(localStorage.getItem("opensubtitle_pwd")){k.opensubtitleService.uploader.pwd=localStorage.getItem("opensubtitle_pwd");$("#pwdOpenSubtitle")[0].value=k.opensubtitleService.uploader.pwd}$(document).bind("settingsClosed",function(){k.opensubtitleService.uploader.username=$("#usernameOpenSubtitle")[0].value;localStorage.setItem("opensubtitle_username",k.opensubtitleService.uploader.username);k.opensubtitleService.uploader.pwd=$("#pwdOpenSubtitle")[0].value;localStorage.setItem("opensubtitle_pwd",k.opensubtitleService.uploader.pwd)})}})();(function(){var b="https://api.opensubtitles.org/xml-rpc",c=[["alb","Albanian"],["ara","Arabic"],["baq","Basque"],["pob","Brazilian"],["bul","Bulgarian"],["cat","Catalan"],["chi","Chinese"],["cze","Czech"],["dan","Danish"],["dut","Dutch"],["eng","English"],["est","Estonian"],["fin","Finnish"],["fre","French"],["geo","Georgian"],["ger","German"],["glg","Galician"],["ell","Greek"],["heb","Hebrew"],["hin","Hindi"],["hrv","Croatian"],["hun","Hungarian"],["ice","Icelandic"],["ind","Indonesian"],["ita","Italian"],["jpn","Japanese"],["khm","Khmer"],["kor","Korean"],["mac","Macedonian"],["may","Malay"],["nor","Norwegian"],["oci","Occitan"],["per","Persian"],["pol","Polish"],["por","Portuguese"],["rum","Romanian"],["rus","Russian"],["scc","Serbian"],["sin","Sinhalese"],["slo","Slovak"],["slv","Slovenian"],["spa","Spanish"],["swe","Swedish"],["tgl","Tagalog"],["tha","Thai"],["tur","Turkish"],["ukr","Ukrainian"],["vie","Vietnamese"]],a={};MediaElementPlayer.prototype.opensubtitle=function(){var f=this,j,d=new rpc.ServiceProxy(b,{sanitize:false,protocol:"XML-RPC",asynchronous:true,methods:["ServerInfo","LogIn","SearchSubtitles","DownloadSubtitles"]});f.opensubtitleService={token:null,service:d};var e=$("#li_encoding");$("<li>").append($('<div id="opensubtitle_button" class="mejs-button  mejs-openload" > <button type="button" title="'+mejs.i18n.t("Download subtitles from OpenSubtitles.org")+'" aria-label="'+mejs.i18n.t("Download subtitles from OpenSubtitles.org")+'"></button></div>')).append($('<select id="select_opensubtitle_lang" style="padding: 0px 0px 0px 0px;text-overflow:ellipsis;width: 150px;height:18px;overflow: hidden;white-space: nowrap;left:40px;position:absolute"/>')).appendTo(e).insertBefore(e.find("label"));var g=$("#select_opensubtitle_lang");mejs.Utility.storage.get("default_opensubtitle_lang","eng",function(l){c.forEach(function(m){$('<option value="'+m[0]+'"'+(m[0]===l?"selected":"")+">"+m[1]+"</option>").appendTo(g)});j=l});g.on("change",function(l){mejs.Utility.storage.set("default_opensubtitle_lang",l.target.value);j=l.target.value});function i(n,m){var l=[];f.notify("Unzipping subtitles...",5000);mejs.Utility.waterfall(n.result.data,function(q,o,p){mejs.Utility.gunzip(q.data,function(r){l.push(new File([r],m[o].SubFileName));p();if(o===n.result.data.length-1){f.filterFiles(l)}})})}function h(l){d.DownloadSubtitles({params:[f.opensubtitleService.token,l.map(function(m){return m.IDSubtitleFile})],onException:function(m){f.notify("Subtitle download failed.")},onComplete:function(m){if(a[j]===undefined){a[j]=[f.playlist[f.playIndex].name]}else{a[j].push(f.playlist[f.playIndex].name)}i(m,l)}})}function k(l){d.SearchSubtitles({params:[f.opensubtitleService.token,[{query:f.playlist[f.playIndex].name,sublanguageid:j},{moviehash:l,moviebytesize:f.playlist[f.playIndex].size,sublanguageid:j}],{limit:8}],onException:function(m){f.notify("Subtitle search failed. Please try later.",2000)},onComplete:function(m){h(m.result.data)}})}f.openSubtitleLogIn=function(){if(!f.getSrc()){f.notify("Please load media.",2000);return}if(a[j]&&a[j].indexOf(f.playlist[f.playIndex].name)!==-1){f.notify("Already downloaded subtitles for the loaded media.",3000);return}$(document).trigger("opensubtitlesDownload");f.notify("Searching for subtitles...",5000);if(f.opensubtitleService.token!==null){subtitleHash(f.playlist[f.playIndex],function(l){k(l)})}else{d.LogIn({params:["","","","ChromeSubtitleVideoplayer"],onException:function(l){f.notify("Opensubtitles.org authentication failed!",2000)},onComplete:function(l){f.opensubtitleService.token=l.result.token;subtitleHash(f.playlist[f.playIndex],function(m){k(m)})}})}};$("#opensubtitle_button").on("click",function(l){f.openSubtitleLogIn()})}})();(function(){var b=["Normal","Repeat","Shuffle"],a=0;mejs.Utility.storage.get("playType",0,function(c){a=c});MediaElementPlayer.prototype.playlist=function(){this.playlist=[];this.playIndex=null};MediaElementPlayer.prototype.next=function(d){var c=this.playIndex;if(this.playIndex===null){return}if(a===0){if((d&&(this.playIndex===0))||this.playIndex===this.playlist.length-1){return}this.playIndex=this.playIndex+(d?-1:1)}else{if(a===1){this.playIndex=(this.playlist.length+this.playIndex+(d?-1:1))%this.playlist.length}else{this.playIndex=Math.floor(Math.random()*this.playlist.length)}}chrome.contextMenus.update(c+"m",{checked:false});chrome.contextMenus.update(this.playIndex+"m",{checked:true});this.setSrc()};MediaElementPlayer.prototype.previous=function(){this.next(true)};MediaElementPlayer.prototype.setPlayType=function(c){chrome.contextMenus.update(a+"p",{checked:false});a=parseInt(c);chrome.contextMenus.update(a+"p",{checked:true});mejs.Utility.storage.set("playType",a);this.notify("Playlist Navigation: "+b[a])};MediaElementPlayer.prototype.cyclePlayType=function(){this.setPlayType((a+1)%3)}})();(function(){var a=mejs.i18n.t("Play/Pause");MediaElementPlayer.prototype.playpause=function(){var b=this;$('<div class="mejs-button mejs-playpause-button mejs-play" ><button type="button" title="'+a+'" aria-label="'+a+'"></button></div>').on("click",function(c){c.preventDefault();b.isPaused()?b.play():b.pause()}).appendTo(b.leftControls)}})();(function(){MediaElementPlayer.prototype.progress=function(){var c=this;c.rail=$('<div class="mejs-time-rail skip"><progress id="railBar" min="0" max="1"></progress><span class="mejs-time-float"><span class="mejs-time-float-current">00:00</span><span class="mejs-time-float-corner"></span></span></div>').appendTo(c.middleControls);c.railBar=c.rail.find("#railBar");var b=c.rail.find(".mejs-time-float"),a=b.find(".mejs-time-float-current"),d=function(j,g){var f=j.pageX,k=c.railBar.offset(),h=c.railBar.outerWidth(),i=0,l=0;if(c.getSrc()){l=f-k.left;i=(l/h)*c.getDuration();if(g&&i!==c.getCurrentTime()){c.setCurrentTime(i)}b.css({left:l+39+"px"});a.html(mejs.Utility.secondsToTimeCode(i));c.paintThumbnail(i)}};c.railBar.on("mousemove",function(f){d(f,false)}).on("mousedown",function(f){if(f.which===1){d(f,true)}})};MediaElementPlayer.prototype.setCurrentRail=function(){if(this.getSrc()){this.railBar.attr({value:this.getCurrentTime()/this.getDuration()})}}})();(function(){MediaElementPlayer.prototype.settings=function(){var b=this;var a=$('<div class="mejs-window" style="width: 356px;"><h2>Settings</h2><div><ul id="settings_list" style="list-style-type: none !important;padding-left:0px"></ul></div>[Click the box to close the settings]</div>').appendTo(b.container).on("keydown",function(c){c.stopPropagation();return true}).on("click",function(c){c.preventDefault();c.stopPropagation();b.toggleSettings();return false});b.toggleSettings=function(){a.css("visibility")==="visible"?a.hide():a.show();$(document).trigger("settingsClosed")};$('<div class="mejs-button mejs-settings-button mejs-settings" ><button type="button" title="'+mejs.i18n.t("Settings...")+'" aria-label="'+mejs.i18n.t("Settings...")+'"></button></div>').appendTo(b.rightControls).on("click",function(c){c.preventDefault();b.toggleSettings()})}})();(function(){MediaElementPlayer.prototype.shortcuts=function(){var a=this;window.addEventListener("keydown",function(h){for(var g=0,b=a.options.keyActions.length;g<b;g++){var f=a.options.keyActions[g];for(var c=0,d=f.keys.length;c<d;c++){if(h.keyCode===f.keys[c]){h.preventDefault();f.action(a,h.keyCode,{shift:h.shiftKey,alt:h.altKey,ctrl:h.ctrlKey});return false}}}return true})}})();(function(){MediaElementPlayer.prototype.source=function(){var a=this;$('<div class="mejs-button mejs-source-button mejs-source"><button type="button" title="'+mejs.i18n.t("Open video...")+'" aria-label="'+mejs.i18n.t("Open video...")+'"></button></div>').appendTo(a.leftControls).on("click",function(b){b.preventDefault();a.openFileForm()});a.openFileForm=function(){if(a.getDuration()&&!a.isPaused()){a.pause()}chrome.fileSystem.chooseEntry({type:"openFile",acceptsMultiple:true,acceptsAllTypes:false,accepts:[{extensions:a.options.mediaExts}]},function(b){var c=[];if(chrome.runtime.lastError){return}mejs.Utility.waterfall(b,function(f,d,e){f.file(function(g){g.fileEntry=f;c.push(g);if(d===b.length-1){a.filterFiles(c,true)}e()})})})}}})();(function(){MediaElementPlayer.prototype.stats=function(){var b=this,a=null,d=null;var c=function(g){if(packaged_app){d.sendAppView("MainView")}else{ga("send","pageview")}};var f=function(g,i,h){if(packaged_app){d.sendEvent(g,i,h)}else{ga("send","event",g,i,h)}};if(packaged_app){a=analytics.getService("ice_cream_app");d=a.getTracker("UA-46086399-2")}else{(function(k,l,q,p,n,j,h){k.GoogleAnalyticsObject=n;k[n]=k[n]||function(){(k[n].q=k[n].q||[]).push(arguments)};k[n].l=1*new Date();j=l.createElement(q),h=l.getElementsByTagName(q)[0];j.async=1;j.src=p;h.parentNode.insertBefore(j,h)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga");ga("create","UA-46086399-1","auto");ga("send","pageview")}setInterval(function(){c("MainView")},60000);b.media.addEventListener("loadeddata",function(){f("video","loaded",b.playlist[b.playIndex].name)});b.media.addEventListener("playing",function(){f("video","playing")});b.media.addEventListener("paused",function(){f("video","paused")});$(document).on("subtitleEncodingChanged",function(g){f("subtitle","changeEncoding",g.detail)});$(document).on("subtitleFileOpened",function(g){f("subtitle","openSrtFile",g.detail)});$(document).on("opensubtitlesDownload",function(){f("opensubtitles","download")});$("<li/>").append($('<label style="width:250px; float:left;">Disable analytics</label>')).append($('<input type="checkbox" id="disableAnalytics"/>')).appendTo($("#settings_list"));var e=$("#disableAnalytics").on("click",function(g){g.stopPropagation()});mejs.Utility.storage.get("disableAnalytics",false,function(g){e.attr({checked:g})});$(document).on("settingsClosed",function(){var g=e.attr("checked");f("setting","disableAnalytics",g);mejs.Utility.storage.set("disableAnalytics",g,function(){a.getConfig().addCallback(function(h){h.setTrackingPermitted(!g)})})})}})();(function(){MediaElementPlayer.prototype.stopButton=function(){var a=this;$('<div class="mejs-button mejs-stop-button mejs-stop"><button type="button" title="Stop" aria-label="Stop"></button></div>').on("click",function(){if(a.getCurrentTime()>0){a.stop()}}).appendTo(a.leftControls)}})();(function(){var a=$("<video>"),c=$("<canvas>"),b=c.get().getContext("2d");MediaElementPlayer.prototype.thumbnail=function(){var d=this.rail.find(".mejs-time-float");c.attr({width:121,height:96}).appendTo(d).insertBefore(d.find(".mejs-time-float-current"));a.on("seeked",function(){b.drawImage(a.get(0),0,0,c.attr("width"),c.attr("height"))})};MediaElementPlayer.prototype.setThumbnailSrc=function(d){b.clearRect(0,0,c.attr("width"),c.attr("height"));a.attr({src:d})};MediaElementPlayer.prototype.paintThumbnail=mejs.Utility.deBounce(function(d){a.attr({currentTime:d})},100)})();(function(){var a=false;MediaElementPlayer.prototype.current=function(){var b=this;b.rightControls.append($('<div class="mejs-time skip"><span class="mejs-currenttime">00:00</span></div>'));b.time=b.rightControls.find(".mejs-time");b.currenttime=b.time.find(".mejs-currenttime");b.currenttime.on("click",function(){if(b.getDuration()){a=!a;b.updateCurrent()}})};MediaElementPlayer.prototype.duration=function(){this.time.append($("<span>/</span>"));this.time.append($('<span class="mejs-duration">00:00</span>'));this.durationD=this.time.find(".mejs-duration")};MediaElementPlayer.prototype.updateCurrent=function(){if(a){this.currenttime.html("-"+mejs.Utility.secondsToTimeCode(this.getDuration()-this.getCurrentTime()))}else{this.currenttime.html(mejs.Utility.secondsToTimeCode(this.getCurrentTime()))}};MediaElementPlayer.prototype.updateDuration=function(){if(this.getDuration()){this.durationD.html(mejs.Utility.secondsToTimeCode(this.getDuration()))}}})();zip.workerScriptsPath="lib/zipjs/WebContent/";zip.useWebWorkers=packaged_app;(function(){$.extend(mejs.MepDefaults,{tracksText:mejs.i18n.t("Captions/Subtitles")});var b=function(){this.player.displaySubtitles()};var c=["utf-8","ibm866","iso-8859-2","iso-8859-3","iso-8859-4","iso-8859-5","iso-8859-6","iso-8859-7","iso-8859-8","iso-8859-10","iso-8859-13 ","iso-8859-14","iso-8859-15","iso-8859-16","koi8-r","koi8-u","windows-874","windows-1250","windows-1251","windows-1252","windows-1253","windows-1254","windows-1255","windows-1256","windows-1257","windows-1258","gbk","gb18030","euc-jp","iso-2022-jp","shift_jis","euc-kr"],a=["UTF-8","ibm866 Cyrillic","iso-8859-2 Latin-2","iso-8859-3 Latin-3","iso-8859-4 Latin-4","iso-8859-5 Cyrillic","iso-8859-6 Arabic","iso-8859-7 Greek","iso-8859-8 Hebrew","iso-8859-10 Latin-6","iso-8859-13 ","iso-8859-14","iso-8859-15","iso-8859-16","koi8-r","koi8-u","windows-874","windows-1250","windows-1251","windows-1252 US-ascii","windows-1253","windows-1254 Latin-5","windows-1255","windows-1256 Arabic","windows-1257","windows-1258","gbk Chinese","gb18030","euc-jp","iso-2022-jp","shift_jis","euc-kr"];MediaElementPlayer.prototype.tracks=function(){var g,f=this,e="";f.subIndex=-1;f.subtitles=[];f.captions=$('<div class="mejs-captions-layer mejs-layer"><div class="mejs-captions-position mejs-captions-position-hover"><span class="mejs-captions-text"></span></div></div>').appendTo(f.layers).hide();f.captionsText=f.captions.find(".mejs-captions-text");var d='<li id="li_encoding"><label style="width:55px;float: left;padding: 4px 0px 0px 5px;">Encoding</label><select style="width:115px" id="encoding-selector">';for(g=0;g<c.length;g++){d+='<option value="'+g+'">'+a[g]+"</option>"}d+="</select></il>";f.captionsButton=$('<div class="mejs-button mejs-captions-button mejs-captions-enabled"><button type="button" title="'+f.options.tracksText+'" aria-label="'+f.options.tracksText+'"></button><div class="mejs-captions-selector skip"><ul><li><div class="mejs-button  mejs-captionload" ><button type="button" title="'+mejs.i18n.t("Load subtitle...")+'" aria-label="'+mejs.i18n.t("Load subtitle...")+'"></button></div><select id="select_sub" style="padding: 0px 0px 0px 0px;text-overflow: ellipsis;width:150px;height: 18px;overflow: hidden;white-space: nowrap;left:40px;position:absolute;"><option value="-1">None</option></select></li>'+d+"</ul></div></div>").appendTo(f.rightControls);f.captionEncodingSelect=$(document).find("#encoding-selector").on("change",function(h){mejs.Utility.storage.get("default_encoding",6,function(i){chrome.contextMenus.update(i+"e",{checked:false});$(document).trigger("subtitleEncodingChanged",h.target.value);f.setEncoding(h.target.value);chrome.contextMenus.update(h.target.value+"e",{checked:true})})});mejs.Utility.storage.get("default_encoding",6,function(h){f.captionEncodingSelect.attr({value:h})});f.subSelect=$(document).find("#select_sub").on("change",function(h){chrome.contextMenus.update(f.subIndex+"s",{checked:false});f.setSubtitle(h.target.value);chrome.contextMenus.update(f.subIndex+"s",{checked:true})});f.captionsButton.find(".mejs-captionload").find("button").on("click",function(h){h.preventDefault();chrome.fileSystem.chooseEntry({type:"openFile",acceptsMultiple:true,acceptsAllTypes:false,accepts:[{extensions:f.options.subExts}]},function(i){if(chrome.runtime.lastError){return}var j=[];mejs.Utility.waterfall(i,function(m,k,l){m.file(function(n){j.push(n);if(k===i.length-1){f.filterFiles(j)}l()})})})});f.capDelayValue=0};MediaElementPlayer.prototype.setEncoding=function(d){mejs.Utility.storage.set("default_encoding",parseInt(d));this.captionEncodingSelect.attr({value:parseInt(d)});for(var e=0;e<this.subtitles.length;e++){this.subtitles[e].entries=null}};MediaElementPlayer.prototype.setSubtitle=function(d){this.subIndex=parseInt(d);this.captions.hide();this.subSelect.attr({value:this.subIndex});this.media.removeEventListener("timeupdate",b);if(this.subIndex!==-1){if(this.subtitles[this.subIndex].entries===[]){this.notify("The given Subtitle file is corrupted!",3000)}else{this.media.addEventListener("timeupdate",b);this.notify(this.subtitles[this.subIndex].file.name+" loaded.",3000)}}};MediaElementPlayer.prototype.parseSubtitles=function(){var e=this,f=e.subtitles[e.subIndex],d=new FileReader();f.entries=[];d.onloadend=function(g){var h=g.target.result;if((/<tt\s+xml/ig).exec(h)){f.entries=mejs.Utility.dfxp(h)}else{if(/\[Script Info\]/.exec(h)){f.entries=mejs.Utility.ass(h)}else{f.entries=mejs.Utility.webvvt(h)}}};d.onerror=function(){e.notify("The given Subtitle file is corrupted!",2000)};mejs.Utility.storage.get("default_encoding",e.captionEncodingSelect.attr("value"),function(g){d.readAsText(f.file,c[g])})};MediaElementPlayer.prototype.displaySubtitles=function(){var g,f,e,d=this.subtitles[this.subIndex].entries;if(d===null){return this.parseSubtitles()}f=this;e=f.getCurrentTime()-f.capDelayValue;for(g=0;g<d.times.length;g++){if(e>=d.times[g].start){if(e<=d.times[g].stop){f.captionsText.html(d.text[g]);f.captions.show();return}}else{break}}f.captions.hide()}})();(function(){$.extend(mejs.MepDefaults,{muteText:mejs.i18n.t("Mute Toggle"),maximumVolume:2});MediaElementPlayer.prototype.volume=function(){var f=new window.AudioContext(),d=f.createMediaElementSource(this.media);this.gainNode=f.createGain();this.delayNode=f.createDelay(2);d.connect(this.delayNode);this.delayNode.connect(this.gainNode);this.gainNode.connect(f.destination);var b=this,c=$('<div class="mejs-button mejs-volume-button mejs-mute"><button type="button" title="'+b.options.muteText+'" aria-label="'+b.options.muteText+'"></button><progress id="volumeBar" value="'+b.options.startVolume+'" max="'+b.options.maximumVolume+'"></progress></div>').appendTo(b.rightControls),a=b.container.find("#volumeBar"),e=function(k){var i=null,g=a.offset();var h=a.outerWidth(),j=k.pageY-g.top;i=(h-j)/h;if(g.top==0||g.left==0){return}b.setVolume(Math.max(0,Math.min(i*2,b.options.maximumVolume)))};a.on("mousedown",function(g){e(g);a.on("mousemove",e)}).on("mouseup mouseleave",function(){a.off("mousemove",e)});c.find("button").on("click",function(){b.setMuted(!b.isMuted())});b.media.addEventListener("volumechange",function(g){if(b.isMuted()){a.attr({value:0});c.addClass("mejs-unmute")}else{a.attr({value:b.getVolume()});c.removeClass("mejs-unmute")}},false);b.setVolume(b.options.startVolume)}})();