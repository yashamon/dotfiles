"use strict";__filename="background/normalize_urls.js",define(["require","exports","./store","./utils"],function(e,r,t,n){var i,a,s,u,o,l,f,c;Object.defineProperty(r,"__esModule",{value:true}),r.pe=r.we=r.be=r.he=r.ge=r.Ee=r._e=r.$e=r.ze=r.xe=r.Se=r.Ie=void 0,r.Ie=/^([^:]+(:[^:]+)?@)?([^:]+|\[[^\]]+])(:\d{2,5})?$/,r.Se=/^(?:ext|web)\+[a-z]+:/,r.xe=/^"[^"]*"$|^'[^']*'$|^\u201c[^\u201d]*\u201d$/,r.ze=/\$([sS])(?:\{([^}]*)})?/g,r.$e=/\$([+-]?\d+)/g,i=["blank","newtab","options","show"],s={__proto__:null,about:"",changelog:"/RELEASE-NOTES.md",help:"/wiki",home:"",license:"/LICENSE.txt",option:a="options.html",permissions:"/PRIVACY-POLICY.md#permissions-required",policy:"/PRIVACY-POLICY.md",popup:a,preference:a,preferences:a,privacy:"/PRIVACY-POLICY.md#privacy-policy",profile:a,profiles:a,readme:"#readme",release:"/RELEASE-NOTES.md",releases:"/RELEASE-NOTES.md","release-notes":"/RELEASE-NOTES.md",setting:a,settings:a,wiki:"/wiki"},r._e=0,r.Ee=function(e,i,a){var s,f,m,p,d,v,w,b,h;return e=e.trim(),r._e=0,n.Pt(e)?(e=e.replace(/\xa0/g," "),n.$t(),e):(s=-1,f=0,m=false,b='"'===(v=e.replace(/[\n\r]+[\t \xa0]*/g,"").replace(/\xa0/g," "))[0]&&v.endsWith('"'),h=v,e=v=b?v.slice(1,-1):v,/^[A-Za-z]:(?:[\\/][^:*?"<>|]*)?$|^\/(?:Users|home|root)\/[^:*?"<>|]+$/.test(e)?(":"===e[1]&&(e=e[0].toUpperCase()+":/"+e.slice(3).replace(/\\/g,"/")),n.$t(),"file://"+c("/"===e[0]?e:"/"+e)):e.startsWith("\\\\")&&e.length>3?((e=e.slice(2).replace(/\\/g,"/")).lastIndexOf("/")<=0&&(e+="/"),n.$t(),"file://"+c(e)):((p=(e=v.toLowerCase()).indexOf(" ")+1||e.indexOf("\t")+1)>1&&(e=e.slice(0,p-1)),0===(p=e.indexOf(":"))?s=4:-1!==p&&n.Dt.test(e)?e.startsWith("vimium:")?(s=3,a|=0,e=v.slice(9),a<-1||!e?v="vimium://"+e:-1===a||b||!(v=t.S(e,a))?v=r.he(e,false,a):"string"!=typeof v&&(s=5)):r.Se.test(e)?s=0:(-1===(d=e.indexOf("/",p+3))?e.length<v.length:e.charCodeAt(d+1)<33)?s=4:/[^a-z]/.test(e.slice(0,p))?s=(p=e.charCodeAt(p+3))>32&&47!==p?0:4:e.startsWith("file:")?s=0:e.startsWith("chrome:")?s=e.length<v.length&&e.includes("/")?4:0:t.zn&&e.startsWith("read:")?s=!/^read:\/\/([a-z]+)_([.\da-z\-]+)(?:_(\d+))?\/\?url=\1%3a%2f%2f\2(%3a\3)?(%2f|$)/.test(e)||e.length<v.length?4:0:e=e.slice(p+3,d>=0?d:void 0):(-1!==p&&e.lastIndexOf("/",p)<0&&(s=l(v.toLowerCase(),p,e.length%v.length)),f=2,d=v.length,-1===s&&e.startsWith("//")&&(e=e.slice(2),f=1,d-=2),-1!==s?"about:blank/"===e&&(v="about:blank"):(p=e.indexOf("/"))<=0?(0===p||e.length<d)&&(s=4):e.length>=d||e.charCodeAt(p+1)>32?(m=e.length>p+1,e=e.slice(0,p)):s=4),-1===s&&e.lastIndexOf("%")>=0&&(e=n.jt(e)).includes("/")&&(s=4),-1===s&&e.startsWith(".")&&(e=e.slice(1)),-1!==s||((w=r.Ie.exec(e))?(e=w[3]).endsWith("]")?s=n.zt(e,6)?f:4:"localhost"===e||e.endsWith(".localhost")||n.zt(e,4)||w[4]&&m?s=f:(p=e.lastIndexOf("."))<0||0===(s=n.Ut(e.slice(p+1)))?(p<0&&"__proto__"===e&&(e="."+e),d=e.length-p-1,s=2!==f&&(p<0||(0!==f?d>=3&&d<=5:d>=2&&d<=14)&&!/[^a-z]/.test(e.slice(p+1)))||u(e,w[4])>0?f:4):s=/[^.\da-z\-]|xn--|^-/.test(e)?e.startsWith("xn--")||e.includes(".xn--")||(e.length===p+3||1!==s?!f:u(e,w[4]))?f:4:2!==f||m?f:e.endsWith(".so")&&e.startsWith("lib")&&e.indexOf(".")===e.length-3?4:w[2]||w[4]||!w[1]||/^ftps?(\b|_)/.test(e)?2:e.startsWith("mail")||e.indexOf(".mail")>0||(d=e.indexOf("."))===p?4:e.indexOf(".",++d)!==p?2:e.length===p+3&&1===s&&n.Ut(e.slice(d,p),true)?4:2:(s=4,e.length===v.length&&n.zt(e="["+e+"]",6)&&(v=e,s=2))),n.$t(),r._e=s,0===s?/^extension:\/\//i.test(v)?"chrome-"+v:v:4===s?r.be(h.split(n.Mt),i||"~",a):s<=2?2===s&&o(v,e)||(2===u(e,w&&w[4])?"https:":"http:")+(2===s?"//":"")+v:v))},u=function(e,r){var n=r&&t.hn.$n.get(e+r)||t.hn.$n.get(e);return n?n.ye?2:1:0},o=function(e,r){if(/^(?!www\.)[a-z\d-]+\.([a-z]{3}(\.[a-z]{2})?|[a-z]{2})\/?$/i.test(e)&&!u(r)){var n=t.hn.$n.get("www."+r);if(n)return(n.ye?"https":"http")+"://www."+e.toLowerCase().replace("/","")+"/"}return""},l=function(e,t,i){var a="/"===e.substr(t+1,1);switch(e.slice(0,t)){case"about":return a?4:i>0||e.includes("@",t)?-1:0;case"blob":case"view-source":return(e=e.slice(t+1)).startsWith("blob:")||e.startsWith("view-source:")?4:(r.Ee(e,null,-2),r._e<=2?0:4);case"data":return a?4:(t=e.indexOf(",",t))<0||i>0&&i<t?-1:0;case"file":return 0;case"filesystem":return e=e.slice(t+1),n.Dt.test(e)?(r.Ee(e,null,-2),0===r._e&&/[^/]\/(?:persistent|temporary)(?:\/|$)/.test(e)?0:4):4;case"magnet":return"?"!==e[t+1]?-1:0;case"mailto":return a?4:(t=e.indexOf("/",t))>0&&e.lastIndexOf("?",t)<0?-1:0;case"tel":return/\d/.test(e)?0:4;default:return r.Se.test(e)?0:a?4:-1}},r.ge=function(e){var r=e.startsWith("filesystem:")?11:e.startsWith("view-source:")?12:0;return r?e.slice(r):e},r.he=function(e,r,n){var a,u,o="",l="",f=e.trim();if(!f)return r?"":location.origin+"/pages/";if((a=f.indexOf(" ")+1)&&(l=f.slice(a).trim(),f=f.slice(0,a-1)),(a=f.search(/[\/#?]/)+1)&&(o=f.slice(a-1).trim(),f=f.slice(0,a-1)),"display"===f&&(f="show"),!/\.\w+$/.test(f))if(f=f.toLowerCase(),null!=(u=s[f]))("release"===f||"releases"===f)&&(u+="#"+t.u.ft.replace(/\D/g,"")),u=f=u&&"/"!==u[0]&&"#"!==u[0]?u:t.u.pt+(u.includes(".")?"/blob/master"+u:u);else{if("newtab"===f)return t.An.newTabUrl_f;if("/"===f[0]||i.indexOf(f)>=0)f+=".html";else{if(1===n||-1===n)return"vimium://"+e.trim();f="show.html#!url vimium://"+f}}return r||u&&u.includes("://")||(f=location.origin+("/"===f[0]?"":"/pages/")+f),o&&(f+=o),f+(l&&(f.includes("#")?" ":"#!")+l)},r.be=function(e,n,i){var a,s=t.An.searchEngineMap.get(n||e[0]);return s?(n||(n=e.shift()),a=r.we(e,s.Ae,s.B)):a=e.join(" "),"~"!==n?r.Ee(a,null,i):(r._e=4,a)},r.we=function(e,t,i,a){var s,u=0;return t=0===e.length&&i?i:t.replace(r.ze,function(i,o,l,f){var c;return"S"===o?(c=e,o=" "):(c=s||(s=e.map(n.k)),o=n.Pt(t)?"%20":"+"),0===c.length?"":(l=l&&l.includes("$")?l.replace(r.$e,function(e,r){var t=parseInt(r,10);if(!t)return c.join(o);if(t<0)t+=c.length+1;else if("+"===r[0])return c.slice(t-1).join(o);return c[t-1]||""}):c.join(null!=l?l:o),null!=a&&(a.push(f+=u,f+l.length),u+=l.length-i.length),l)}),n.$t(),null==a?t:{Ae:t,Ce:a}},f=function(e){var t,n,i=e.indexOf(":"),a=i;if(i<=0)return e;if(r.Se.test(e.slice(0,i+1).toLowerCase()))return e.slice(0,i).toLowerCase()+e.slice(i);if("://"===e.substr(i,3))if((i=e.indexOf("/",i+3))<0)i=a,a=-1;else if(7===i&&"file"===e.slice(0,4).toLowerCase())return"file:///"+((i=":"===e.charAt(9)?3:"%3a"===e.substr(9,3).toLowerCase()?5:0)?e[8].toUpperCase()+":/":"")+e.slice(i+8);return n=(t=e.slice(0,i)).toLowerCase(),-1===a&&/^(file|ftp|https?|rt[ms]p|wss?)$/.test(t)&&(e+="/"),t!==n?n+e.slice(i):e},r.pe=f,c=function(e){var r,t;return/[%?#&\s]/.test(e)?(r="",e.indexOf("#")&&((t=/\.[A-Za-z\d]{1,4}(\?[^#]*)?#/.exec(e))?r=(r=e.slice(t.index+t[0].length-1)).includes("=")||!r.includes("/")||r.includes(":~:")?t[1]?t[1]+r:r:"":(t=/#(\w+=|:~:)/.exec(e))&&(r=e.slice(t.index)),r&&(e=e.slice(0,-r.length))),e.replace(/[%?#&\s]/g,encodeURIComponent)+r.replace(/\s/g,encodeURIComponent)):e}});