"use strict";__filename="background/main.js",define(["require","exports","./store","./utils","./browser","./normalize_urls","./parse_urls","./settings","./ports","./exclusions","./ui_css","./key_mappings","./run_commands","./open_urls","./tools","./eval_urls","./all_commands","./request_handlers"],function(n,t,e,r,o,i,u,s,a,c,l,_,f,m,d){var p;Object.defineProperty(t,"__esModule",{value:true}),r=__importStar(r),s=__importStar(s),c=__importStar(c),p=function(n){var t,r=e.Pn.get(e.Cn);"quickNext"===n&&(n="nextTab"),(t=_.aa)&&t.get(n)?null==r||4&r.fr||e.Cn<0?f.executeShortcut(n,r):o.tabsGet(e.Cn,function(t){return f.executeShortcut(n,t&&"complete"===t.status?e.Pn.get(t.id):null),o.ae()}):t&&null!==t.get(n)&&(t.set(n,null),console.log("Shortcut %o has not been configured.",n))},gA={_o:s,qn:e.qn,yn:e.yn,An:e.An,su:m.su,C:function(){return e.C&&e.C()},po:function(){return{mn:e.mn,_n:e._n,go:_.na,sn:e.sn}},In:e.In,kn:e.kn,Ee:i.Ee,_e:function(){return i._e},S:e.S,pe:i.pe,Re:u.Re,N:function(){return e.N&&e.N()},P:e.P,bo:function(n){return e.x.bo(n)},rr:a.rr,du:m.du,Ue:u.Ue,Bt:c.Bt,ri:l.ri,ne:o.ne,ho:function(n,t){return null==n?e.Pn:null==t?-3===n?e.Sn:e.Pn.get(n)||null:a.indexFrame(n,t)},ko:function(){return e.Cn},ao:function(){3===e.Vn&&(e.mn||(s.We("keyMappings"),0===e.yn.o&&(_.Vt["m-s-c"]=36)),gA.ao=null,s.Xe("hideHud",true),s.Xe("nextPatterns",true),s.Xe("previousPatterns",true),s.We("autoDarkMode"),s.We("autoReduceMotion"),o.me.runtime.onConnect.addListener(function(n){return a.OnConnect(n,0|n.name)}),o.me.runtime.onConnectExternal.addListener(function(n){var t,r=n.sender,o=n.name;if(r&&a.isExtIdAllowed(r)&&o.startsWith("vimium-c.")&&(t=o.split("@")).length>1){if(t[1]!==e.u.GitVer)return n.postMessage({N:2,t:1}),void n.disconnect();a.OnConnect(n,32|t[0].slice(9))}else n.disconnect()}))},vo:d.pr.co},o.me.commands.onCommand.addListener(p),o.me.runtime.onMessageExternal.addListener(function(n,t,r){if(a.isExtIdAllowed(t))if("string"!=typeof n){if("object"==typeof n&&n)switch(n.handler){case"shortcut":var o=n.shortcut;o&&p(o+"");break;case"id":r({name:"Vimium C",host:location.host,shortcuts:true,injector:e.u.st,version:e.u.ft});break;case 99:r({s:n.scripts?e.u.lt:null,version:e.u.ft,host:"",h:"@"+e.u.GitVer});break;case"command":f.executeExternalCmd(n,t)}}else f.executeExternalCmd({command:n},t);else r(false)}),s.We("extAllowList"),o.ve.onReplaced.addListener(function(n,t){var r,o=e.Pn.get(t);if(o)for(r of(e.Pn.delete(t),e.Pn.set(n,o),o.oo))r.s.ur=n}),s.We("vomnibarOptions"),s.We("vomnibarPage",null),s.We("searchUrl",null),e.x.pu=function(n,t,r){setTimeout(function(){e.x.pu(n,t,r)},210)},e.J(2|e.Vn),gA.ao(),setTimeout(function(){setTimeout(function(){new Promise(function(t,e){n(["/background/browsing_data_manager.js"],t,e)}).then(__importStar),new Promise(function(t,e){n(["/background/completion_utils.js"],t,e)}).then(__importStar),new Promise(function(t,e){n(["/background/completion.js"],t,e)}).then(__importStar)},400),new Promise(function(t,e){n(["/background/others.js"],t,e)}).then(__importStar),o.me.extension.isAllowedIncognitoAccess(function(n){e.u.rt=false===n})},200),globalThis.onunload=function(n){if(!n||n.isTrusted){for(var t of e.Sn)t.disconnect();e.Pn.forEach(function(n){for(var t of n.oo.slice(0))t.disconnect()})}},globalThis.window||(globalThis.onclose=onunload),e.Un<59||!r.m("\\p{L}","u",0)?r.o("words.txt").then(function(n){e.L(n.replace(/[\n\r]/g,"").replace(/\\u(\w{4})/g,function(n,t){return String.fromCharCode(+("0x"+t))}))}):e.L("")});