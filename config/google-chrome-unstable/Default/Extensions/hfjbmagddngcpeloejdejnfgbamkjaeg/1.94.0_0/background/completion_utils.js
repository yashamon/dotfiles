"use strict";__filename="background/completion_utils.js",define(["require","exports","./store","./browser","./utils","./settings","./parse_urls","./tools","./browsing_data_manager"],function(r,n,t,e,u,o,i,f,a){var l,c,s,_,v,m,h,d,p,b,w,g,x,M,T,k,y,E,R,S,I,K,P,j;Object.defineProperty(n,"__esModule",{value:true}),n.zu=n.tf=n.sortBy0=n.shortenUrl=n.highlight=n.cutTitle=n.Hu=n.get2ndArg=n.ComputeRelevancy=n.ComputeRecency=n.ComputeWordRelevancy=n.Tu=n.Mu=n.Bu=n.Xu=n.wi=n.qu=n.lf=n.setupQueryTerms=n.set_tabsInNormal=n.Uu=n.tabsInNormal=void 0,u=__importStar(u),o=__importStar(o),l=[0,0],n.tabsInNormal=c=null,s=null,_=0,v=[],b=0,n.Uu=w=3,g=function(r){n.tabsInNormal=c=r},n.set_tabsInNormal=g,n.setupQueryTerms=function(r,n,t){m=r,h=n,p=false,d=t},n.lf=function(r){b=r},x=function(r){n.Uu=w=r},n.qu=x,n.wi={yu:null,xu:null,Hr:0,wo:0,lo:function(r){var e,u,o,i,f,a=null,l=0,c=m.join(" ");for(e=v,u=c?e.length:0;0<=--u;)if(e[u].xo||!r){for(o=e[u].Zr,i=0,f=0;i<o.length&&f<m.length;f++)m[f].includes(o[i])&&i++;if(i>=o.length){a=e[u];break}}n.wi.yu=a,a&&(t.qn.t<200||!a.Zn||a.Zn.length>1e3)&&(l=performance.now())-a.Ci<Math.max(300,1.3*t.qn.t)?(n.wi.xu=a,a.Zr=m.slice(0)):!c||a&&c===a.Zr.join(" ")||!(c.length>4||/\w\S|[^\x00-\x80]/.test(c))?n.wi.xu=null:(n.wi.xu={Zr:m.slice(0),xo:r,Ci:l||performance.now(),Zn:a&&a.Zn,Kn:a&&a.Kn},v.push(n.wi.xu),n.wi.Hr||(n.wi.Hr=setInterval(n.wi.Mo,6e3)))},Mo:function(){for(var r=v,t=-1,e=performance.now()-5983;++t<r.length&&r[t].Ci<e;);++t<r.length?r.splice(0,t):(r.length=0,clearInterval(n.wi.Hr),n.wi.Hr=0)},xr:function(r){for(var n of v)r<2?n.Zn=null:r<3?n.Kn=null:s=null},Zi:function(r){s!==r&&(n.wi.wo&&(clearTimeout(n.wi.wo),n.wi.wo=0),s=r,r&&(n.wi.wo=setTimeout(n.wi.Zi,3e3,null)))}},n.Xu={To:0,ro:0,Vu:function(){var r=m[0],e=t.An.searchKeywords;return null==e?(n.Xu.ro=n.Xu.ro||setTimeout(n.Xu.yo,67),true):!(r.length>=n.Xu.To)&&e.includes("\n"+r)},yo:function(){var r,e,i,f=u.At(t.An.searchEngineMap).sort(),a=0,l="",c=[];for(r=f.length;0<=--r;)l.startsWith(e=f[r])||(a=(i=e.length)>a?i:a,l=e,c.push(e));o.Ve("searchKeywords","\n"+c.join("\n")),n.Xu.To=a,n.Xu.ro=0}},n.Bu={Au:null,Du:null,_f:null,sf:function(){var r,t=n.Bu.Au=[];for(r of(n.Bu.Du=n.Bu._f=null,m))t.push(new RegExp(u.t(r),r!==r.toUpperCase()&&r.toLowerCase()===r?"i":""))},Eu:function(){var r,t,e,u=n.Bu.Du=[],o=n.Bu._f=[];for(r of n.Bu.Au)t="\\b"+r.source,e=r.flags,u.push(new RegExp(t,e)),o.push(new RegExp(t+"\\b",e))},mf:function(r){n.Bu.Au&&(n.Bu.Au[0]=new RegExp(u.t(r),n.Bu.Au[0].flags))}},n.Mu=function(r,t){for(var e of n.Bu.Au)if(!(e.test(r)||e.test(t)))return false;return true},M=function(r,t){var e,u,o,i=0,f=0,a=0,l=0,c=!!t;for(n.Bu.Du||n.Bu.Eu(),e=0,u=m.length;e<u;e++)l+=(o=k(e,r))[0],a+=o[1],c&&(f+=(o=k(e,t))[0],i+=o[1]);return l=l/w*T(a,r.length),0===i?t?l/2:l:l<(f=f/w*T(i,t.length))?f:(l+f)/2},n.Tu=M,T=function(r,n){return r<n?r/n:n/r},k=function(r,t){var e,u=0;return(e=t.split(n.Bu.Au[r]).length)<1?l:(u=1,n.Bu.Du[r].test(t)&&(u+=1,n.Bu._f[r].test(t)&&(u+=1)),[u,(e-1)*m[r].length])},y=function(r){return n.Tu(r.t,r.title)},n.ComputeWordRelevancy=y,n.ComputeRecency=function(r){var n=(r-b)/18144e5;return n<0?0:n<1?n*n*.666667:n<1.000165?.666446:0},E=function(r,t,e){var u=n.ComputeRecency(e),o=n.Tu(r,t);return u<=o?o:(o+u)/2},n.ComputeRelevancy=E,n.get2ndArg=function(r,n){return n},R=function(r){var t,e,u;h||r.v||(r.v=n.tf(r.u)),null==r.textSplit?(r.title=n.cutTitle(r.title),(e=i.je(t=r.t)).length!==t.length?u=I(t,"\\"===e[0]?5:"/"===t.charAt(7)&&"%3a"===t.substr(9,3).toLowerCase()?10:8):(e=n.shortenUrl(t),u=K(e)),r.t=t.length!==r.u.length?e:"",r.textSplit=P(e,u,t.length-e.length,h?d-13-Math.min(r.title.length,40):d)):r.t===r.u&&(r.t="")},n.Hu=R,S=function(r,t){var e=r.length>d+40;return e&&(r=u.Et(r,0,d+39)),n.highlight(e?r+"\u2026":r,t||K(r))},n.cutTitle=S,n.highlight=function(r,n){var t,e,o,i,f;if(p)return r;if(0===n.length)return u.It(r);for(t="",e=0,o=0;o<n.length;o+=2)f=n[o+1],(i=n[o])>=r.length||(t+=u.It(r.slice(e,i)),t+="<match>",t+=u.It(r.slice(i,f)),t+="</match>",e=f);return t+u.It(r.slice(e))},n.shortenUrl=function(r){var n=u.v(r);return!n||n>=r.length?r:r.slice(n,r.length-+(r.endsWith("/")&&!r.endsWith("://")))},I=function(r,n){var t,e=K(r);for(t=0;t<e.length;)e[t+1]<=n?e.splice(t,2):(e[t]=Math.max(e[t]-n,0),e[t+1]-=n,t+=2);return e},K=function(r){var t,e,u,o,i,f,a,l,c,s,_,v=[];for(t=0,e=m.length;t<e;t++)for(u=0,o=0,i=void 0,a=(f=r.split(n.Bu.Au[t])).length-1,l=m[t].length;u<a;u++,o=i)i=(o+=f[u].length)+l,v.push([o,i]);if(0===v.length)return v;if(1===v.length)return v[0];for(v.sort(n.sortBy0),c=v[0],t=1,s=1,e=v.length;s<e;s++)c[t]>=(_=v[s])[0]?c[t]<_[1]&&(c[t]=_[1]):(c.push(_[0],_[1]),t+=2);return c},n.sortBy0=function(r,n){return r[0]-n[0]},P=function(r,n,t,e){var o,i,f,a,l,c="",s=r.length,_=s,v="";if(s<=e||(t>1?_=r.indexOf("/")+1||s:(_=r.indexOf(":"))<0?_=s:u.Dt.test(r.slice(0,_+3).toLowerCase())?_=r.indexOf("/",_+4)+1||s:_+=22),_<s&&n.length)for(o=n.length,i=s+8;(o-=2)>-4&&i>=_;i=o<0?0:n[o])if(f=o<0?_:n[o+1],(a=i-20-Math.max(f,_))>0&&(s-=a)<=e){_=f+(e-s);break}for(s=0,o=0;s<e&&o<n.length;o+=2)(a=(i=n[o])-20-(l=Math.max(s,_)))>0?(e+=a,v=u.Et(r,s,l+11),c+=p?v:u.It(v),c+="\u2026",v=u.Ct(r,i-8,i),c+=p?v:u.It(v)):s<i&&(v=r.slice(s,i),c+=p?v:u.It(v)),v=r.slice(i,s=n[o+1]),p?c+=v:(c+="<match>",c+=u.It(v),c+="</match>");return v=r.length<=e?r.slice(s):u.Et(r,s,e-1>s?e-1:s+10),c+(p?v:u.It(v))+(r.length<=e?"":"\u2026")},n.tf=function(r){for(var n=a.li.Mi&&r.startsWith("http")?a.li.Si(r):-1,e=n<0?~n-1:n,u=e<0?[]:t.hn.Zn,o=r.indexOf(":")+3,i=0,f=0,l="",c="",s=0,_=0;i<=e&&(o="/"===r[o]?o+1:r.indexOf("/",o+1)+(f?0:1))>0;f=o){for(l=r.slice(f,o),_=e;i<=_;)if((c=u[s=i+_>>>1].u.slice(f))>l)_=s-1;else{if(c===l)return f?u[s].u:"";i=s+1}if(i<=e&&f&&"/"===(l=u[i].u)[o]&&l.length<=++o)return l}return""},j=function(r,u,o,i,f){var a,l,v=t.wn;null===c&&(v=1!==v?v:t.Un>51||t.u.rt||s?t.on(0):1),1!==v||2048&u?(n.tabsInNormal=c=2!==v&&!(2048&u),_!==(a=(c?2:0)|(r?1:0))&&(s=null,_=a),(f=f||s)?o(i,f):(l=o.bind(null,i),r?(512&u?e.getCurTabs:e.fe)(l):e.ve.query({},l))):e.getCurWnd(r,function(e){t.on(e.incognito?2:0),i.o||n.zu(r,u,o,i,r?e.tabs:null)})},n.zu=j,f.mr.so=function(){s&&(1&_||!(2&_)!=(2===t.wn))&&n.wi.Zi(null)},setTimeout(function(){o.We("searchEngines",null)},80)});