"use strict";__filename="background/eval_urls.js",define(["require","exports","./store","./utils","./normalize_urls","./parse_urls","./ports","./exclusions","./i18n","./run_commands","./key_mappings"],function(e,s,n,r,a,u,t,l,c,i,f){var o,p,d;Object.defineProperty(s,"__esModule",{value:true}),l=__importStar(l),o=0,n.r(function(s,l,c){var g,b,m,y,_,h,v,x,k,$;if("paste"===s&&(s+=" ."),(l|=0)<0||!(s=s.trim())||(g=s.search(/[/ ]/))<=0||!/^[a-z][\da-z\-]*(?:\.[a-z][\da-z\-]*)*$/i.test(b=s.slice(0,g).toLowerCase())||/\.(?:css|html?|js)$/i.test(b))return null;if(!(s=s.slice(g+1).trim()))return null;if(1===l)switch(b){case"sum":case"mul":s=s.replace(/[\s+,\uff0b\uff0c]+/g,"sum"===b?" + ":" * "),b="e";break;case"avg":case"average":m=s.split(/[\s+,\uff0b\uff0c]+/g),s="("+m.join(" + ")+") / "+m.length,b="e"}if(1===l)switch(b){case"e":case"exec":case"eval":case"expr":case"calc":case"m":case"math":return new Promise(function(s,n){e(["/lib/math_parser.js"],s,n)}).then(__importStar).then(p.bind(0,s));case"error":return[s,3]}else if(l>=2)switch(b){case"run":return n.set_cEnv(null),h=n.Pn.get(n.Cn),setTimeout(function(){i.executeCommand(f.Yt("runKey",r.qt({keys:[s]})),1,0,h?h.cr:null,0,null)},0),[s,6];case"status":case"state":return l>=3&&d(s),[s,l>=3?4:7];case"url-copy":case"search-copy":case"search.copy":case"copy-url":if((_=a.Ee(s,null,1))instanceof Promise)return _.then(function(e){var s=e[0]||e[2]||"";return s=s instanceof Array?s.join(" "):s,[s=n.I(s),1]});s=(_=5===a._e&&_ instanceof Array?_[0]:_)instanceof Array?_.join(" "):_;case"cp":case"copy":case"clip":return[s=n.I(s),1]}switch(b){case"cd":case"up":if(!(m=(s+"  ").split(" "))[2]){if(l<1)return null;if("string"!=typeof(_=t.rr()))return _.then(function(e){var r=e&&n.S("cd "+s+" "+(s.includes(" ")?e:". "+e),l,c);return r?"string"==typeof r?[r,7]:r:[e?"fail in parsing":"No current tab found",3]});m[2]=_}return v="/"===(b=m[0])[0],g=parseInt(b,10),g=isNaN(g)?"/"===b?1:v?b.replace(/(\.+)|./g,"$1").length+1:-b.replace(/\.(\.+)|./g,"$1").length||-1:g,(x=u.He({u:m[2],p:g,t:null,f:1,a:"."!==m[1]?m[1]:""}))&&x.u||[x?x.e:"No upper path",3];case"parse":case"decode":(b=s.split(" ",1)[0]).search(/\/|%2f/i)<0?s=s.slice(b.length+1).trimLeft():b="~",m=[s=r.kt(s)],s=a.Ee(s),4!==a._e&&(y=u.He({u:s}))?""===y.u?m=[b]:(m=y.u.split(" ")).unshift(b):m=m[0].split(r.Mt);break;case"sed":case"substitute":case"sed-p":case"sed.p":case"sed2":return k=s.split(" ",1)[0],s=s.slice(k.length+1).trim(),$="sed2"===b?s.split(" ",1)[0]:"",[s=(s=s.slice($.length).trim())&&n.P(s,b.endsWith("p")?32768:0,$?{r:k,k:$}:/^[@#$-]?[a-z]+$|^\.$/.test(k)?{r:null,k:k}:{r:k,k:null}),5];case"u":case"url":case"search":m=r.kt(s).split(r.Mt);break;case"paste":if(l>0)return(_=n.V(s))instanceof Promise?_.then(function(e){return[e?e.trim().replace(r.Mt," "):"",5]}):[_?_.trim().replace(r.Mt," "):"",5];default:return null}return c?[m,2]:(g=o++)>12?null:12===g?a.be(m,"",0):g>0?a.be(m,"",l):(_=a.be(m,"",l),o=0,_)}),p=function(e,s){var n,r,u;for(a.xe.test(e)&&(e=e.slice(1,-1)),e=(e=(e=e.replace(/\uff0c/g," ")).replace(/deg\b/g,"\xb0").replace(/[\xb0']\s*\d+(\s*)(?=\)|$)/g,function(e,s){return(e=e.trim())+("'"===e[0]?"''":"'")+s}).replace(/([\u2070-\u2079\xb2\xb3\xb9]+)|[\xb0\uff0b\u2212\xd7\xf7]|''?/g,function(e,s){var n,r,a="";if(!s)return"\xb0"===e?"/180*PI+":(n="\uff0b\u2212\xd7\xf7".indexOf(e))>=0?"+-*/"[n]:"/"+("''"===e?3600:60)+"/180*PI+";for(r of e)a+=r<"\xba"?r>"\xb3"?1:r<"\xb3"?2:3:r.charCodeAt(0)-8304;return a&&"**"+a}).replace(/\*PI\+(?!\s*\d)/g,"*PI").replace(/([\d.])rad\b/g,"$1")).replace(/^=+|=+$/g,"").trim(),n=[].reduce.call(e,function(e,s){return e+("("===s?1:")"===s?-1:0)},0);n<0;n++)e="("+e;for(;n-- >0;)e+=")";if(e){for(;e&&"("===e[0]&&")"===e.slice(-1);)e=e.slice(1,-1).trim();e=e||"()"}if(r="",(u=s.MathParser||globalThis.MathParser||{}).evaluate){try{r="function"==typeof(r=u.evaluate("()"!==e?e:"0"))?"":""+r}catch(e){}u.clean(),u.errormsg&&(u.errormsg="")}return[r,0,e]},d=function(e){var s,a,u,i,f,o,p,d,g,b,m,y,_,h,v,x,k,$,w=n.Cn;if(!parseInt(e,10)||(w=parseInt(e,10),e=e.slice(e.search(/[/ ]/)+1)),s=n.Pn.get(w||(w=n.Cn))){for(k of(n.set_cPort(s.ar||s.cr),u=(a=e.search(/[/ ]/))>0?e.slice(a+1):"",e=e.toLowerCase(),a>0&&(e=e.slice(0,a)),e.includes("-")&&e.endsWith("able")&&(e+="d"),u=((i=!!u&&/^silent/i.test(u))?u.slice(7):u).trim(),f=0,o=function(e){console.log(e),f||t.showHUD(e),f=1},u.includes("%")&&/%[a-f0-9]{2}/i.test(u)&&(u=r.jt(u)),u&&!u.startsWith("^ ")?(o('"vimium://status" only accepts a list of hooked keys'),u=""):u&&(p=u.match(/<(?!<)(?:a-)?(?:c-)?(?:m-)?(?:s-)?(?:[a-z]\w+|[^\sA-Z])>|\S/g),u=p?p.join(" ").replace(/<(\S+)>/g,"$1"):""),b=(g=n.cPort.s).Wn,m=l.lr?1===b?b:(d=l.ir(g.Ae,g))?1:null===d?0:2:0,_=!!u&&"enable"===e,v={N:1,p:2===(y="enable"===e?0:"disable"===e?2:"toggle-disabled"===e?2!==b?2===m?null:2:2===m?0:null:"toggle-enabled"===e?0!==b?0===m?null:0:0===m?2:null:"toggle-next"===e?1===b?0:0===b?2===m?null:2:2===m?0:null:"toggle"===e||"next"===e?0!==b?0:2:("reset"!==e&&o('Unknown status action: "'+e+'", so reset'),null))||_?u:null,f:h=null===y?0:2===y?3:1},x=h?y:0,s.tr=h?{Wn:x,er:v.p}:null,s.oo))$=k.s,!h&&l.lr&&1!=(x=null===(d=v.p=l.ir($.Ae,$))?0:d?1:2)&&$.Wn===x||($.Wn=x,k.postMessage(v));x=s.cr.s.Wn,i||f||t.showHUD(c._r("newStat",c._r(0!==x||_?2===x?"fullyDisabled":"halfDisabled":"fullyEnabled"))),n.xn&&x!==b&&n.R(w,x)}}});