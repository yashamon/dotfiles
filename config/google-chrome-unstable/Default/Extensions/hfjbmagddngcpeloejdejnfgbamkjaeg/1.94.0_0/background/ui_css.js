"use strict";__filename="background/ui_css.js",define(["require","exports","./store","./utils","./settings","./ports"],function(n,i,r,e,t,o){var u,s,f,c,a;Object.defineProperty(i,"__esModule",{value:true}),i.ni=i.ii=i.ri=void 0,u=r.u.ft+","+r.Un+";",i.ri=function(n,i){return-1===n?a(i,-1):(2===n&&r.Z(null),(o=0===n&&t.Ze.getItem("findCSS"))?(s=null,r.F(c(o)),r.z(i.slice(u.length)),void(r.qn.c=t.Ze.getItem("omniCSS")||"")):void e.o("vimium-c.css").then(function(i){var e,o,s,c,d;u.slice(u.indexOf(",")+1),r.Un<54&&(i=i.replace(/user-select\b/g,"-webkit-$&")),r.Un<62&&(i=i.replace(/#[\da-f]{4}([\da-f]{4})?\b/gi,function(n){n=5===n.length?"#"+n[1]+n[1]+n[2]+n[2]+n[3]+n[3]+n[4]+n[4]:n;var i=parseInt(n.slice(1),16);return"rgba("+(i>>>24)+","+(i>>16&255)+","+(i>>8&255)+","+((255&i)/255+"").slice(0,4)+")"})),o=(i=(e=f(i)).ui).indexOf("all:"),s=i.lastIndexOf("{",o),c=r.Un>=53?i.indexOf(";",o):i.length,i=i.slice(0,s+1)+i.slice(o,c+1)+i.slice(i.indexOf("\n",c)+1||i.length),r.Un>64&&true?(o=i.indexOf("display:"),s=i.lastIndexOf("{",o),i=i.slice(0,s+1)+i.slice(o)):i=i.replace("contents","block"),r.Un<73&&(i=i.replace("3px 5px","3px 7px")),r.Un<69&&(i=i.replace(".LH{",".LH{box-sizing:border-box;")),r.zn&&r.Un<89&&(i=i.replace("forced-colors","-ms-high-contrast")),i=i.replace(/\n/g,""),r.Un<85&&(i=i.replace(/0\.01|\/\*!DPI\*\/ ?[\d.]+/g,"/*!DPI*/"+(r.Un<48?1:.5))),t.Ze.setItem("innerCSS",u+i),t.Ze.setItem("findCSS",(d=e.find).length+"\n"+d),a(t.Xe("userDefinedCss"),n)}));var o},f=function(n){var i,r,e=n?n.split(/^\/\*\s?#!?([A-Za-z:]+)\s?\*\//m):[""],t={ui:e[0].trim()};for(i=1;i<e.length;i+=2)t[r=e[i].toLowerCase()]=(t[r]||"")+e[i+1].trim();return t},c=function(n){var i=(n=n.slice(n.indexOf("\n")+1)).indexOf("\n")+1,r=n.indexOf("\n",i);return{c:n.slice(0,i-1),s:n.slice(i,r).replace("  ","\n"),i:n.slice(r+1)}},a=function(n,e){var s,a,d,l,S,v,b,g,m=t.Ze.getItem("innerCSS"),C=m.indexOf("\n");if(m=C>0?m.slice(0,C):m,a=(s=f(n)).ui?m+"\n"+s.ui:m,d=s["find:host"],l=s.find,S=s.omni,v="omniCSS",C=(m=t.Ze.getItem("findCSS")).indexOf("\n"),b=(m=m.slice(0,C+1+ +m.slice(0,C))).indexOf("\n",m.indexOf("\n",C+1)+1),g=m.lastIndexOf("  ",b),d=d?"  "+d.replace(/\n/g," "):"",(g>0?m.slice(g,b)!==d:d)&&(m=(m=m.slice(C+1,g>0?g:b)+d+m.slice(b)).length+"\n"+m),l=l?m+"\n"+l:m,m=(t.Ze.getItem(v)||"").split("\n",1)[0],S=S?m+"\n"+S:m,-1===e)return{ui:a.slice(u.length),find:c(l),omni:S};t.Ze.setItem("innerCSS",a),t.Ze.setItem("findCSS",l),S?t.Ze.setItem(v,S):t.Ze.removeItem(v),i.ri(0,a),0!==e&&1!==e&&(o.eo(function(n){var e;for(e of n.oo)8&e.s.fr&&e.postMessage({N:12,H:r.Dn,f:32&e.s.fr?i.ni(e.s):void 0})}),t.Ye({N:47,d:{c:r.qn.c}}))},i.ii=function(n,i){var t,o,u,s,f,c,a=r.qn.s;!n.o&&r.Hn||(s=(u=a&&" "+a+" ").includes(o=" "+n.t+" "),t=(t=(f=null!=n.e?n.e:s)?s?a:a+o:u.replace(o," ")).trim().replace(e.Mt," "),false!==n.b?(n.o&&r.K(f!==(" "+r.An.vomnibarOptions.styles+" ").includes(o)),t!==a&&(r.qn.s=t,c={N:47,d:{s:t}},e.a(r.Sn.slice(0),function(n){return n!==i&&r.Sn.includes(n)&&n.postMessage(c),1}))):r.qn.s=t)},i.ni=function(n){var i=r.Gn;return r.Un<86&&n.Ae.startsWith("file://")?s||(s={c:i.c+"\n.icon.file { -webkit-user-select: auto !important; user-select: auto !important; }",s:i.s,i:i.i}):i},t.Je.userDefinedCss=a,r.z(t.Ze.getItem("innerCSS")||""),r.Dn&&!r.Dn.startsWith(u)?(t.Ze.removeItem("vomnibarPage_f"),i.ri(1,r.Dn)):i.ri(0,r.Dn)});