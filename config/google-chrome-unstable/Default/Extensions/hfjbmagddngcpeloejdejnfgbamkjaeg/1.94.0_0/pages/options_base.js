"use strict";__filename="pages/options_base.js",define(["require","exports","./async_bg"],function(t,i,n){var s,e,u,r;Object.defineProperty(i,"__esModule",{value:true}),i.$i=i.ts=i.is=i.ns=i.ss=i.showI18n=void 0,s=function(){var t,s,e,u,r,h;if("en"!==n.es){if(t=n.es.split(",")[0],s=navigator.language||t,(u=(e=n.$("#keyMappings"))&&i.$i("keyMappingsP"))&&(e.placeholder=u),s&&(!t.startsWith("zh")||"zh-CN"!==s))for(e of n.$$("input[type=text], textarea"))e.lang=s;for(e of n.$$("[data-i]"))h=(r=e.dataset.i).endsWith("-t"),null!=(u=n.us(h?r.slice(0,-2):r))&&(h?e.title=u:e.innerText=u);document.documentElement.lang="zh"===t?"zh-CN":t}},i.showI18n=s,window.__extends=function(t,i){var n=function(){this.constructor=t};n.prototype=i.prototype,t.prototype=new n},i.ss=function(t,i,n,s){var e,u=0,r=function(){var h=Date.now()-e;if(!(h<i-4&&h>=0))return u=0,e!==s?t.call(n):void 0;u=setTimeout(r,i-h)};return s=s?1:0,function(){if(e=Date.now(),!u)return u=setTimeout(r,i),s?(s=e,t.call(n)):void 0}},e=(function(){function t(t,s){this.rs=t,this.hs=t.id,this.os=this.fs=null,this.as=false,this.hs in n.cs.Le&&(s=this.ls.bind(this,s)),this.fs=i.ss(s,330,this,1),this.Qr(t)}return t.prototype.ps=function(){},t.prototype.vs=function(){var i=this;this.as=true,this.os=this.ds(),t.ms||n.c(function(){i.ys(i.os)})},t.prototype.ds=function(){return n.cs.Xe(this.hs)},t.prototype.gs=function(t,i,s){var e=this._s;return i?(s=e||!s?JSON.stringify(e?e.xs(t):t):s,n.Ns.JSON.parse(s)):e?e.xs(t):t},t.prototype.Ss=function(){return true},t.prototype.Os=function(){var t=this.bs(),i="object"==typeof t,n=i?JSON.stringify(this.os):this.os,s=i?JSON.stringify(t):t;s!==n&&(n=s,t=this.gs(t,i,i?s:""),this.os=t=this.Js(t,i,s),this.as=true,(n!==(i?JSON.stringify(t):t)||this.$s(t))&&this.ys(t,true),this.ps())},t.prototype.ks=function(){return!this.ws(this.os,this.ds())},t.prototype.Js=function(i,s){return s&&JSON.stringify(i)===JSON.stringify(n.cs.Ne[this.hs])&&(i=n.cs.Ne[this.hs]),n.cs.Ve(this.hs,i),this.hs in n.cs.Le&&t.zs.push(this.hs),this.ds()},t.prototype.$s=function(){return false},t.Rs=function(t,i){return JSON.stringify(t)===JSON.stringify(i)},t.ms=false,t})(),i.ns=e,u=(function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.ws=e.Rs,i}return __extends(i,t),i.prototype.Qr=function(t){var s=this;this.Ks=t.querySelector("#exclusionTemplate").content.querySelector(".exclusionRule"),this.js=t.querySelector("tbody"),this.zr=[],this.js.addEventListener("input",i.As),this.js.addEventListener("input",this.fs),this.js.addEventListener("click",function(t){return s.Ms(t)}),this.Ps=false,n.$("#exclusionAddButton").onclick=function(){return s.Ts("")}},i.prototype.Cs=function(){},i.As=function(t){var i=t.target.vnode;i&&(i.Ds=true)},i.prototype.Ts=function(t,i){this.Zs(this.js,{pattern:t,passKeys:""});var s=this.zr[this.zr.length-1];false!==i&&n.c(function(){return s.qs.focus()}),t&&this.fs(),this.Cs(1)},i.prototype.ys=function(t){var i,s,u;if(!this.Ps)for(i of(this.Ps=true,e.zs&&(this.Ks.draggable=true),"en"!==n.es?n.$$("[title]",this.Ks):[]))(s=n.us(i.title))&&(i.title=s);return this.js.textContent="",this.zr=[],t.length<=0||(1===t.length?this.Zs(this.js,t[0]):(u=document.createDocumentFragment(),t.forEach(this.Zs.bind(this,u)),this.js.appendChild(u))),this.Cs(t.length)},i.prototype.Bs=function(){return true},i.prototype.Zs=function(t,i){var n,s,e,u,r,h=i.pattern,o=i.passKeys,f={Es:{pattern:h,passKeys:o},Te:null,Ds:false,ji:false,qs:null,Fs:null};f.ji=this.Bs(f),f.ji?(s=(n=document.importNode(this.Ks,true)).querySelector(".pattern"),e=n.querySelector(".passKeys"),u=o.trimRight(),s.value=h,h&&(s.placeholder=""),e.value=u,u&&(e.placeholder=""),(r=f).qs=s,r.Fs=e,s.vnode=r,e.vnode=r,this.zr.push(r),t.appendChild(n)):this.zr.push(f)},i.Gs=function(t){t.Es.pattern&&t.Fs.placeholder&&(t.Fs.placeholder="")},i.prototype.Ms=function(t){var i,n=t.target;if("path"===n.localName&&(n=n.parentElement),"svg"===n.localName&&(n=n.parentElement),n.classList.contains("remove"))return(n=n.parentNode.parentNode).classList.contains("exclusionRule")?(i=n.querySelector(".pattern").vnode,n.remove(),this.zr.splice(this.zr.indexOf(i),1),this.fs(),this.Cs(0)):void 0},i.Hs=function(t,i,n){var s=n.toLowerCase();return i||1!==n.length?n!==s?"<"+i+"s-"+s+">":t:n},i.Is=function(t){return t&&t.replace(/<(?!<)((?:[acm]-){0,3})(\S|[A-Za-z]\w+)>/g,i.Hs)},i.prototype.bs=function(t){var n,s,e,u,h,o,f,a,c,l,p=[];for(n of(t=true===t,this.zr))t&&!n.ji||(n.Ds?(s=n.qs.value.trim(),e=false,u=n.Fs.value,s?((h=s.startsWith(":")?0:s.indexOf("://"))&&(/^[\^*]|[^\\][$()*+?\[\]{|}]/.test(s)?s.startsWith("`")||(s.startsWith("^")?(f=".*$".includes(s.slice(-2))?s.endsWith(".*$")?3:s.endsWith(".*")?2:0:0,s=0!==f&&"\\"!==s[s.length-f]?s.slice(0,-f):s):(e=!s.includes("/",h+3),s.endsWith("*")&&(s=s.slice(0,/^[^\\]\.\*$/.test(s.slice(-3))?-2:-1),e=false),o=(h<0?"^https?://":"^")+((o=s=s.startsWith(".*")&&!/[(\\[]/.test(s)?"*."+s.slice(2):s).startsWith("*")&&"."!==o[1]?"[^/]"+o:(o=o.replace(/\./g,"\\.")).startsWith("*")?o.replace("*\\.","(?:[^./]+\\.)*?"):o.replace("://*\\.","://(?:[^./]+\\.)*?")),s=r(o,"")?o:s.includes("*")||s.includes("/")?":"+s:":https://"+(s.startsWith(".")?s.slice(1):s))):(e=!s.includes("/",h+3)&&!s.startsWith("vimium:"),s=(h<0?":http://":":")+(s=s.replace(/\\(.)/g,"$1")))),e&&(s+="/"),u&&((a=(u=i.Is(u)).match(/<(?!<)(?:a-)?(?:c-)?(?:m-)?(?:s-)?(?:[a-z]\w+|[^\sA-Z])>|\S/g))&&((c="^"===a[0]&&a.length>1)&&a.shift(),a.sort(),c?a.unshift("^"):"^"===a[0]&&(a.shift(),a.push("^"))),u=(u=a?a.join(" ")+" ":"").replace(/<escape>/gi,"<esc>")),n.Fs.title!==(l=u?u.length>1&&"^"===u[0]?"only hook such keys":"pass through such keys":"completely disabled")&&(n.Fs.title=l),this.Ls(n,s,u),p.push(n.Es)):this.Ls(n,"",u)):n.Es.pattern&&p.push(n.Es));return p},i.prototype.Ls=function(t,n,s){var e=!t.Es.passKeys&&!!s;t.Es={pattern:n,passKeys:s},t.Te=null,t.Ds=false,e&&i.Gs(t)},i.prototype.ps=function(){var t,i;for(t of this.zr)t.ji&&(t.qs.value!==t.Es.pattern&&(t.qs.value=t.Es.pattern),i=t.Es.passKeys.trim(),t.Fs.value!==i&&(t.Fs.value=i))},i})(e),i.is=u,r=function(t,i){try{return new RegExp(t,i)}catch(t){return null}},i.ts=n.Un<48||devicePixelRatio<2&&n.Un>=61?function(){var t=document.createElement("style"),i=devicePixelRatio,s=n.Un>=61&&i>=1,e=s||n.Un>=48?1/i:1;e=(""+(e+=999e-8)).slice(0,7).replace(/\.?0+$/,""),t.textContent=s?"html { --tiny: "+e+"px; }":"* { border-width: "+e+"px !important; }",document.head.appendChild(t)}:null,i.$i=function(t,i){return n.us(t,i)||""}});