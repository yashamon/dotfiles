"use strict";__filename="pages/options_popup.js",define(["require","exports","./async_bg","./options_base"],function(n,t,o,e){var u,i,r,c,l,s,a,f,d,v,p,h,m,_,w,g,b,O,x,R,j,P,k,y,L,T,U,A,E,I,z,M,S,W;Object.defineProperty(t,"__esModule",{value:true}),r="",c=0,l=true,s=null,a=-1,f=null,v=false,p=/^[a-z][\+\-\.\da-z]+:\/\//,h=o.$("#state-action"),m=o.$("#saveOptions"),w=(_=h.nextElementSibling).nextElementSibling,g=Object.create(null),b=o.cs.Xe("exclusionOnlyFirstMatch"),O=function(n,t){return o.us(n,t)||""},x=(function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.Ts=function(o,e){n.prototype.Ts.call(this,t.Ro(),e)},t.prototype.Bs=function(n){return n.Te=n.Es.pattern&&g[n.Es.pattern]||false,L(n.Te)},t.prototype.ys=function(u){var i,r,l;n.prototype.ys.call(this,u),this.ys=null,document.documentElement.style.height="",t.prototype.Bs=e.is.prototype.Bs,i=this.zr.filter(function(n){return n.ji}),c=(r=i.length>0)?2:1,r?(l=i[0].Fs,R(true)):(this.Ts("",false),l=this.zr[this.zr.length-1].Fs),o.c(function(){return l.focus()})},t.prototype.Ls=function(t,o,e){var u=t.Es.pattern===o,i=t.Te;n.prototype.Ls.call(this,t,o,e),u?t.Te=i:this.jo(t,o)},t.prototype.jo=function(n,o){var e,u=this,i=n.qs;o&&o!==t.Ro()?(e=T(n))instanceof Promise?e.then(function(){u.jo(n,o)}):L(e)?i.title=i.style.color="":(i.style.color="red",i.title="Red text means that the pattern does not\nmatch the current URL."):i.title=i.style.color=""},t.Ro=function(){var n=i.startsWith("http:")?"^https?://"+i.split("/",3)[2].replace(/[.[\]]/g,"\\$&")+"/":i.startsWith(location.origin)?":vimium:/"+new URL(i).pathname.replace("/pages",""):/^[^:]+:\/\/./.test(i)&&!i.startsWith("file:")?":"+i.split("/",3).join("/")+"/":":"+i;return t.Ro=function(){return n},n},t})(e.is),R=function(n){var t,o;f.bs(false),t=f.zr.filter(function(n){return n.ji&&!!n.Es.pattern}),o=c,c=2,Promise.all(t.map(function(n){return null==n.Te&&T(n)})).then(function(){j(o,n,t)})},j=function(n,t,o){var e,u,i=3===n,c=E(!!r,o);c&&(c=k(c)),t&&(s=n>=2?c:null),e=c===s,u=!!c&&c.length>2&&"^"===c[0],h.textContent=(i?c?O("o137")+O(u?"o138":"o139"):O("o140"):O(e?"o141":"o142")+O(c?u?"o138":"o139":e?"o143":"o143_2")).replace(" to be","")+O("colon")+O("NS"),_.className=c?"code":"",_.textContent=c?u?c.slice(2):c:O("o143_3")+O(null!==c?"o144":"o145"),w.textContent=v&&!i&&e?O("o147",[O(0!==a?"o144":"o145")]):v?O("o148"):"",m.disabled=e,m.firstChild.data=O(e?"o115":"o115_2")},P=function(){m.disabled||(o.Oo.S("status/"+u.ur+"/reset/silent",3),f.Os(),setTimeout(function(){setTimeout(I,150)},50),c=3,R(true),m.firstChild.data=O("o115_3"),m.disabled=true,l=true)},k=function(n){var t,o,e;for(e of((t=(n=n.trim()).length>2&&n.startsWith("^"))&&(n=n.slice(1).trimLeft()),o=Object.create(null),n.split(" ")))o[e]=1;return(t?"^ ":"")+Object.keys(o).sort().join(" ")},y=function(n,t){t&&t.preventDefault(),o.Oo.S("status/"+u.ur+"/"+n,3),window.close()},L=function(n){return!!n&&(2===n.t?i.startsWith(n.v)||!!r&&r.startsWith(n.v):n.v.test(i)||!!r&&n.v.test(r))},T=function(n){var t,e=n.Es.pattern,u=g[e];return u?n.Te=u instanceof Promise?u.then(function(t){return n.Te=t}):u:(t=Promise.resolve(o.Oo.Bt(e)[0]),g[e]=n.Te=t.then(function(t){return g[e]=n.Te=U(t)}))},U=function(n){return 2===n.t?{t:n.t,v:n.v}:3===n.t?{t:n.t,v:new URLPattern(n.v)}:{t:n.t,v:new RegExp(n.v,"")}},A=function(n){var t,e,u=o.cs.Xe("exclusionRules");for(t=0,e=u.length;t<e;t++)g["__proto__"!==u[t].pattern?u[t].pattern:"_"]=U(n[t])},E=function(n,t){var o,e,u,c="";for(o of t)if((e=o.Te)&&(2===e.t?i.startsWith(e.v):e.v.test(i))){if(0===(u=o.Es.passKeys).length||b||"^"===u[0]&&u.length>2)return u;c+=u}return!c&&n&&i.lastIndexOf("://",5)<0&&!p.test(i)&&r?E(false,t):c||null},I=function(){d=2!==u.Wn?"Disable":"Enable";var n=o.$("#toggleOnce"),t=n.nextElementSibling;o.c(function(){n.firstElementChild.textContent=(O(d)||d)+(v?"":O("Once")),n.onclick=y.bind(null,d),_.id="state-value",t.classList.toggle("hidden",!v),v&&(t.firstElementChild.onclick=y.bind(null,"Reset"))})},z=function(n){var t=o.$(".options-link"),e=location.origin+"/pages/options.html";n.startsWith(e)?o.c(function(){t.nextElementSibling.remove(),t.remove()}):(t.href!==e&&o.c(function(){t.href=e}),t.onclick=function(n){n.preventDefault();var t=o.Ns.Object.create(null);t.u=e,o.Oo.su(t),window.close()})},M=function(){o.Oo.yn.o||window.addEventListener("keydown",function(n){n.altKey&&(88===n.keyCode||v&&90===n.keyCode)&&!(n.shiftKey||n.ctrlKey||n.metaKey)&&(n.preventDefault(),n.stopImmediatePropagation(),y(88===n.keyCode?d:"Reset"))}),f=new x(o.$("#exclusionRules"),function(){if(l){l=false;var n=o.$("#helpSpan");n&&(n.nextElementSibling.style.display="",n.remove()),m.removeAttribute("disabled"),m.firstChild.data=O("o115_2")}g=Object.create(null),R(c<2)}),o.c(function(){f.vs()})},Promise.all([o.Oo.N(),o.Oo.Bt(null),new Promise(function(n){o.me.tabs.query({currentWindow:true,active:true},n)})]).then(function(n){var t,c=n[2][0],s=c.url,f=o.Oo.ho(c.id),d=o.$("#blocked-msg"),h=!(f||c&&s&&"loading"===c.status&&/^(ht|s?f)tp/.test(s));if(o.Ao(1),h||S(f))return W(d,c,s,f),z(s),void o.c(e.showI18n);o.c(function(n){var t,e;d.remove(),d=null,(t=document.documentElement.classList).toggle("no-dark",!o.Oo.yn.d),t.toggle("less-motion",!!o.Oo.yn.m),e=o.me.runtime.getManifest(),n.textContent=e.version_name||e.version},o.$(".version")),f&&f.tr&&(v=true,a=f.tr.Wn),(u=!f||f.cr.s.or&&!p.test(f.cr.s.Ae)?{or:0,sr:c.incognito,Wn:0,fr:0,ur:c.id,Ae:s}:f.cr.s).or&&(r=(null===(t=null==f?void 0:f.ar)||void 0===t?void 0:t.s.Ae)||s),i=u.Ae,m.onclick=P,document.addEventListener("keyup",function(n){13===n.keyCode&&(n.ctrlKey||n.metaKey)&&(setTimeout(window.close,300),l||P())}),A(n[1]),z(s),I(),M(),o.c(e.showI18n),e.ts&&o.c(e.ts)}),S=function(n){return!!n&&"string"==typeof n.dr&&true!==o.Oo.kn.get(n.dr)},W=function(n,t,e,u){var i,r,c,l,s,a,f=document.body,d=document.documentElement;f.innerText="",n.style.display="",i=o.me.runtime.getManifest(),n.querySelector(".version").textContent=i.version_name||i.version,r=n.querySelector("#refresh-after-install"),t&&e&&/^(ht|s?f)tp/i.test(e)?!o.zn&&(navigator.userAgentData?navigator.userAgentData.brands.find(function(n){return n.brand.includes("Opera")}):/\bOpera\//.test(navigator.userAgent))&&/\.(google|bing|baidu)\./.test(e.split("/",4).slice(0,3).join("/"))&&(n.querySelector("#opera-warning").style.display=""):r.remove(),f.style.width="auto",f.appendChild(n),null!=(l=(c=S(u)?u.dr:e.startsWith(location.protocol)&&!e.startsWith(location.origin)?new URL(e).host:"")?o.Oo.kn.get(c):null)&&true!==l&&((s=o.$("#injection-refused")).style.display="",s.nextElementSibling.remove(),u&&(u.dr=-1),o.$("#doAllowExt").onclick=function(){var n,t=o.cs.Xe("extAllowList"),e=t.split("\n"),i=c;e.indexOf(i)<0&&(n=e.indexOf("# "+i)+1||e.indexOf("#"+i)+1,e.splice(n?n-1:e.length,n?1:0,i),t=e.join("\n"),o.cs.Ve("extAllowList",t)),u&&(u.dr=null),this.onclick=null,o.me.tabs.query({active:true,currentWindow:true},function(n){var t=function(){return setTimeout(function(){return location.reload()},500),o.me.runtime.lastError};return n&&n[0]?o.me.tabs.reload(n[0].id,t):o.me.tabs.reload(t),o.me.runtime.lastError})}),d.classList.toggle("no-dark",!o.Oo.yn.d),d.style.height="",a=o.$("#retryInject"),/^(file|ftps?|https?):/.test(e)&&t?a.onclick=function(n){n.preventDefault(),o.Oo.ho(t.id)||o.Oo.ne(t.id),window.close()}:(a.nextElementSibling.remove(),a.remove())}});