"use strict";__filename="pages/options_defs.js",define(["require","exports","./async_bg","./options_base"],function(t,n,i,s){var r,e,u,h,o,f,a,c,l,v,d,p,g;Object.defineProperty(n,"__esModule",{value:true}),n.createNewOption=n.registerClass=n.savedStatus=n.exportBtn=n.saveBtn=n.th=n.nh=n.ih=n.sh=n.rh=n.eh=void 0,s.ns.Us=Object.create(null),s.ns.zs=[],s.ns.prototype.ls=function(t){t.call(this),window.VApi&&i.cs.Ke(i.cs.Le[this.hs],this.bs(),VApi.z)},s.ns.uh=function(){var t,n,i=s.ns.Us,r=[];for(t in i)!(n=i[t]).as&&n.ks()&&r.push(n.hs);if(r.length>0&&!confirm(s.$i("dirtyOptions",[r.join("\n  * ")])))return false;for(t in i)if(!(n=i[t]).as&&!n.Ss())return false;for(t in i.vimSync.as||i.vimSync.Os(),i.exclusionRules.as||i.exclusionRules.Os(),i)i[t].as||i[t].Os();return true},s.ns.hh=function(){var t,n=s.ns.Us;for(t in n)if(!n[t].as)return true;return false},s.ns.prototype.ws=function(t,n){return t===n},r=(function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return __extends(n,t),n.prototype.Qr=function(){var t,s;this._s={min:(t=this.rs.min)&&!isNaN(s=parseFloat(t))?s:null,max:(t=this.rs.max)&&!isNaN(s=parseFloat(t))?s:null,default:i.cs.Ne[this.hs],xs:n.oh},this.rs.oninput=this.fs,this.rs.onfocus=this.fh.bind(this)},n.prototype.ys=function(t){this.rs.value=""+t},n.prototype.bs=function(){return parseFloat(this.rs.value)},n.prototype.fh=function(){var t=this,n=this.rs,i=function(n){return t.ah(n)},s=function(){n.removeEventListener("wheel",i,{passive:false}),n.removeEventListener("blur",s),t.ch=0};this.ch=0,n.addEventListener("wheel",i,{passive:false}),n.addEventListener("blur",s)},n.prototype.ah=function(t){var n,i,s,r,e,u,h,o;if(t.preventDefault(),n=this.ch,!((i=Date.now())-n<100&&i+99>n&&n))return this.ch=i,e=(s=this.rs).value,"function"==typeof(h=(r=(t.deltaY||t.deltaX)>0)?s.stepUp:s.stepDown)?(h.call(s),u=s.value,s.value=e):(o=(h=parseFloat)(s.step)||1,i=(+s.value||0)+(r?o:-o),isNaN(o=h(s.max))||(i=Math.min(i,o)),isNaN(o=h(s.min))||(i=Math.max(i,o)),u=""+i),this.lh(u,n>0,false)},n.oh=function(t){return isNaN(t)&&(t=this.default),t=null!=this.min?Math.max(this.min,t):t,null!=this.max?Math.min(this.max,t):t},n})(s.ns),n.eh=r,e=(function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return __extends(n,t),n.prototype.Qr=function(){var t=this.rs,i=t.dataset.map;this.vh=i?JSON.parse(i):t.dataset.allowNull?n.dh:n.ph,this.gh=this.vh.length-1,this.gh>1&&"vimSync"!==this.hs&&t.addEventListener("change",this.onTripleStatusesClicked.bind(this),true),t.onchange=this.fs},n.prototype.ys=function(t){var n=true===t||t===this.vh[this.gh];this.rs.checked=n,this.rs.indeterminate=this.gh>1&&t===this.vh[1],this._h=n?this.gh:Math.max(0,this.vh.indexOf(t))},n.prototype.bs=function(){return this.rs.indeterminate?this.vh[1]:this.vh[this.rs.checked?this.gh:0]},n.prototype.onTripleStatusesClicked=function(t){t.preventDefault();var n=this._h;this._h=2===n?1:n?0:2,this.rs.indeterminate=2===n,this.rs.checked=2===this._h},n.ph=[false,true],n.dh=[false,null,true],n})(s.ns),n.rh=e,u=(function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return __extends(n,t),n.prototype.Qr=function(){var t=this.rs.dataset.converter||"",i=t?t.split(" "):[];this.rs.oninput=this.fs,i.length>0&&(this._s={bh:i,Wn:0,xs:n.mh})},n.prototype.vs=function(){t.prototype.vs.call(this);var n=this._s;n&&(n.Wn=0,n.Wn=n.xs(this.os)===this.os?1:0)},n.prototype.ys=function(t,n){var i=t.replace(/ /g,"\xa0");true!==n?this.rs.value=i:this.lh(i,true,true)},n.prototype.xh=function(){return this.rs.value.trim().replace(/\xa0/g," ")},n.prototype.bs=function(){var t=this.xh(),i=this._s;return t&&i&&i.xs===n.mh&&(i.Wn|=2,t=i.xs(t),i.Wn&=-3),t},n.prototype.$s=function(t){return t!==this.xh()},n.prototype.Uo=function(t,n,s){var r=this.rs,e=this.rs,u=e.classList,h=e.parentElement,o=r.nextElementSibling;o=o&&o.classList.contains("tip")?o:null,null!=s||(s=!!t),(s||o)&&i.c(function(){s?(null==o&&((o=document.createElement("div")).className="tip",h.insertBefore(o,r.nextElementSibling)),o.textContent=t,null!==n&&u.add(n||"has-error")):(u.remove("has-error"),u.remove("highlight"),o&&o.remove())})},n.mh=function(t){var n,i,s=this.bh;if(s.indexOf("lower")>=0?t=t.toUpperCase().toLowerCase():s.indexOf("upper")>=0&&(t=t.toLowerCase().toUpperCase()),t=t.normalize(),s.indexOf("chars")<0||2&this.Wn&&!(1&this.Wn))return t;for(i of(n="",t.replace(/\s/g,"")))n.includes(i)||(n+=i);return n},n})(s.ns),n.sh=u,h=(function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return __extends(n,t),n.prototype.bs=function(){var n=t.prototype.bs.call(this);return n||this.ys(n=i.cs.Ne[this.hs],true),n},n})(u),n.ih=h,o=(function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return __extends(n,t),n.prototype.Nh=function(t){var n=this.rs instanceof HTMLInputElement,i=JSON.stringify(t,null,n?1:2);return n?i.replace(/(,?)\n\s*/g,function(t,n){return n?", ":""}):i},n.prototype.ys=function(n,i){t.prototype.ys.call(this,this.Nh(n),i)},n.prototype.$s=function(t){return this.Nh(t)!==this.xh()},n.prototype.bs=function(){var n=t.prototype.bs.call(this),s=null;if(n)try{s=JSON.parse(n)}catch(t){}else this.ys(s=i.cs.Ne[this.hs],true);return s},n})(u),n.nh=o,f=(function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return __extends(n,t),n.prototype.Qr=function(){t.prototype.Qr.call(this),this.wh=true,this.Oh=this.kh.bind(this),this.rs.addEventListener("focus",this.Oh)},n.prototype.kh=function(){this.Oh&&(this.rs.removeEventListener("focus",this.Oh),this.rs.classList.remove("masked"),this.Oh=null,this.wh=false,this.rs.removeAttribute("placeholder"),this.vs())},n.prototype.ys=function(n,r){var e=this;this.wh?i.c(function(){e.rs.placeholder=s.$i("clickToUnmask")}):t.prototype.ys.call(this,n,r)},n.prototype.bs=function(){return this.wh?this.os:t.prototype.bs.call(this)},n})(u),n.th=f,u.prototype.lh=r.prototype.lh=function(t,n,i){var s=false;n&&(this.yh=true,(s=document.activeElement!==this.rs)&&this.rs.focus(),document.execCommand("undo")),this.yh=i,this.rs.select(),document.execCommand("insertText",false,t),s&&this.rs.blur(),this.yh=false},o.prototype.ws=s.ns.Rs,s.is.prototype.Cs=function(t){var n,r,e,u,h;if(this.zr.length===t)for(e of(n=i.$("#exclusionToolbar"),r=i.$$("[data-model]",n),n.style.visibility=t?"":"hidden",r))(h=(u=s.ns.Us[e.id]).rs.parentNode.style).visibility=t||u.as?"":"visible",h.display=!t&&u.as?"none":""},n.saveBtn=i.$("#saveOptions"),n.exportBtn=i.$("#exportButton"),n.createNewOption=(function(){var t,a,c,l,v=false;for(l of(n.savedStatus=function(t){return v=null!=t?t:v},t=function(){this.yh||((this.as=this.ws(this.bs(),this.os))?v&&!s.ns.hh()&&(n.saveBtn.disabled=true,n.saveBtn.firstChild.data=s.$i("o115"),n.exportBtn.disabled=false,n.savedStatus(false),window.onbeforeunload=null):v||(window.onbeforeunload=function(){return s.$i("beforeUnload")},n.savedStatus(true),n.saveBtn.disabled=false,n.saveBtn.firstChild.data=s.$i("o115_2"),n.exportBtn.disabled=true))},a={Number:r,Boolean:e,Text:u,NonEmptyText:h,JSON:o,MaskedText:f,ExclusionRules:s.is},c=function(n){var i=new(0,a[n.dataset.model])(n,t);return s.ns.Us[i.hs]=i},s.ns.ms=true,i.$$("[data-model]")))c(l);return n.registerClass=function(t,n){a[t]=n},c})(),(c=(a=s.ns.Us.exclusionRules).js).ondragstart=function(t){(a.Eh=t.target).style.opacity="0.5"},c.ondragend=function(){var t=a.Eh;a.Eh=null,t&&(t.style.opacity="")},c.ondragover=function(t){t.preventDefault()},c.ondrop=function(t){var n,i,s,r,e;t.preventDefault(),n=a.Eh,i=(i=t.target).closest(".exclusionRule"),n&&i&&n!==i&&(a.js.insertBefore(n,i),s=a.zr,r=n.querySelector(".pattern").vnode,e=i.querySelector(".pattern").vnode,s.splice(s.indexOf(r),1),s.splice(s.indexOf(e),0,r),a.fs())};v=function(t){for(var n,i,s=new RegExp("^#![^\\n]*|^[^]","gm");n=s.exec(t);)if((i=n[0])&&"\n"!==i[0]){if("#"!==i[0])break;if("!"===i[1]&&"no-check"===i.slice(2).trim()){t=t.slice(0,n.index)+t.slice(n.index+i.length).trimLeft();break}}return t.replace(/\.activateMode(To)?/g,".activate")},(l=s.ns.Us.keyMappings).ds=function(){return v(s.ns.prototype.ds.call(this))},l.gs=function(t){return t=v(t),s.ns.prototype.gs.call(this,t,false)},l.ps=function(){var t,n,r=i.Oo.po(),e=r.go,u=e?(function(t){var n,i,s=t.length>1?t.length+" Errors:\n":"Error: ";for(i of t)n=0,s+=i[0].replace(/%([a-z])/g,function(t,s){return++n,"c"===s?"":"s"===s||"d"===s?i[n]:JSON.stringify(i[n])}),n+1<i.length&&(s+=" "+i.slice(n+1).map(function(t){return"object"==typeof t&&t?JSON.stringify(t):t}).join(" ")+".\n");return s})(e):"";i.Oo.yn.l&&!u&&(t=Object.keys(r.mn).join(""),t+=(n=r._n)?Object.keys(n).join(""):"",/[^ -\xff]/.test(t))?this.Uo(s.$i("ignoredNonEN"),null):this.Uo(u)},g=s.ns.Us.filterLinkHints,(d=s.ns.Us.linkHintCharacters).ps=(p=s.ns.Us.linkHintNumbers).ps=function(){this.Uo(!this.rs.style.display&&this.os.length<4?i.me.i18n.getMessage("96"):"")},g.ps=function(){i.c(function(t){var n=g.bs();t.style.display=p.rs.style.display=n?"":"none",d.rs.style.display=n?"none":"",d.ps(),p.ps()},i.$("#waitForEnterBox"))},s.ns.Us.ignoreKeyboardLayout.ps=function(){var t=this;i.c(function(n){n.style.display=t.bs()>1?"none":""},i.$("#ignoreCapsLockBox"))},s.ns.Us.vomnibarPage.ps=function(){var t=this.rs,n=this.os,r=n.startsWith(location.protocol)||n.startsWith("front/");if(i.Un<50)return i.c(function(){t.style.textDecoration=r?"":"line-through"}),this.Uo(n===i.cs.Ne.vomnibarPage?"":s.$i("onlyExtVomnibar",[50]),null);if(n=i.Oo.An.vomnibarPage_f||n,r);else{if(n.startsWith("file:"))return this.Uo(s.$i("fileVomnibar"),"highlight");if(/^http:\/\/(?!localhost[:/])/i.test(n))return this.Uo(s.$i("httpVomnibar"),"highlight")}return this.Uo("")},s.ns.Us.newTabUrl._s={Wn:0,xs:function(t){var n=/^\/?pages\/[a-z]+.html\b/i.test(t)?i.me.runtime.getURL(t):i.Oo.Ee(t.toLowerCase());return n=n.split("?",1)[0].split("#",1)[0],t.startsWith("http")||1!==i.Oo.In.get(n)&&!/^(?!http|ftp)[a-z\-]+:\/?\/?newtab\b\/?/i.test(t)?t:i.cs.Ne.newTabUrl}},s.ns.Us.userDefinedCss.ps=function(){window.VApi&&VApi.z&&this.rs.classList.contains("debugging")&&setTimeout(function(){var t,n,r,e=VApi.y().r;for(t of i.$$("iframe",e))n=t.classList.contains("HUD"),(r=t.contentDocument.querySelector("style.debugged"))&&(n?r.remove():r.classList.remove("debugged"));s.ns.Us.userDefinedCss.rs.classList.remove("debugging")},500)}});