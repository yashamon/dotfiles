"use strict";__filename="pages/options_permissions.js",define(["require","exports","./async_bg","./options_base","./options_defs"],function(n,e,o,r,i){var t,s,u,c,f,a,m,l,p,h,d,_,v,g,w;Object.defineProperty(e,"__esModule",{value:true}),s="downloads.shelf",u="chrome://new-tab-page/*",(t={})[c="chrome://*/*"]="opt_chromeUrl",t[u]="opt_cNewtab",t[s]="opt_closeShelf",f=t,a=o.$("#optionalPermissionsTemplate"),m=a.content.firstElementChild,l=[],p=a.parentElement,h=o.me.permissions,d=o.me.runtime.getManifest().optional_permissions||[],i.registerClass("OptionalPermissions",(function(n){function e(){var e=null!==n&&n.apply(this,arguments)||this;return e.bs=function(){return l.map(function(n){return n.rs.checked?n.rs.indeterminate?"1":"2":"0"}).join("")},e.ds=function(){return l.map(function(n){return n.os}).join("")},e}return __extends(e,n),e.prototype.Qr=function(){this.rs.onchange=this.fs},e.prototype.ys=function(n){for(var e=0;e<l.length;e++)l[e].rs.checked="0"!==n[e],l[e].rs.indeterminate="1"===n[e]},e.prototype.Js=function(n){var e,i,t,f=this,a=[],m=[],p={},d=1,_=function(e){var r,i=l[e],f=+n[e];if(i.os===f)return"continue";r=i.De===u?"chrome://newtab/*":"",i.os=f,i.De===c&&o.cs.Xe("allBrowserUrls")!==(2===f)&&o.cs.Ve("allBrowserUrls",2===f),f?(i.De===s&&a.push("downloads"),(i.De.includes(":")?m:a).push(i.De),r&&m.push(r),p[i.De]=i):(d++,h.remove(i.De.includes(":")?{origins:r?[i.De,r]:[i.De]}:{permissions:i.De===s?["downloads",i.De]:[i.De]},function(n){var e=o.me.runtime.lastError;return(e||!n)&&console.log("Can not remove the permission %o :",i.De,e&&e.message||e),t(),e}))};for(e=0;e<l.length;e++)_(e);return i=function(n,e){var i,s,u,c,a,m=o.me.runtime.lastError;if((m||!e)&&console.log("Can not request permissions of %o :",n,m&&m.message||m),!e){for(i of n){if((s=p[i])&&(s.os=0),!s||!m)return;(c=(u=s.rs.parentElement).nextElementSibling)&&c.classList.contains("tip")||((c=document.createElement("div")).className="tip",u.parentElement.insertBefore(c,u.nextElementSibling)),a=(m&&m.message||JSON.stringify(m))+"",i.startsWith("chrome://")&&a.includes("Only permissions specified in the manifest")&&i.startsWith("chrome:")&&(a=r.$i("optNeedChromeUrlFirst"),a=o.zn?a.replace("chrome:","edge:"):a),c.textContent=u.title=r.$i("exc")+a,u.lastElementChild.classList.add("has-error")}f.vs()}return t(),m},t=function(){--d>0||Promise.all(l.map(v)).then(function(){f.vs()})},d+=(a.length&&1)+(m.length&&1),a.length&&h.request({permissions:a},i.bind(0,a)),m.length&&h.request({origins:m},i.bind(0,m)),t(),n},e})(r.ns)),_=function(){var n,e,t,s,c,a,h=document.createDocumentFragment();for(n of d)t=(e=document.importNode(m,true)).querySelector("input"),s=f[n],t.value=n,c=r.$i(s||"opt_"+n)||n,a="",n.startsWith("chrome:")&&(c=o.zn?c.replace("chrome:","edge:"):c,a=r.$i("optOfChromeUrl").replace(o.zn?"chrome":"edge","edge")),n===u&&o.Un<80&&(a=r.$i("requireChromium",[80]),t.disabled=true,t.checked=false,e.title=r.$i("invalidOption",[r.$i("beforeChromium",[80])])),e.lastElementChild.textContent=c+a,1===d.length&&e.classList.add("single"),h.appendChild(e),l.push({De:n,os:0,rs:t});p.appendChild(h),p.addEventListener("change",g,true),setTimeout(function(){Promise.all(l.map(v)).then(function(){p.dataset.model="OptionalPermissions",i.createNewOption(p).vs()})},17)},v=function(n){var e,r=n.De,i=new Promise(function(n){e=n});return h.contains(r.includes(":")?{origins:[r]}:{permissions:r===s?["downloads",r]:[r]},function(i){o.Un<72&&"chrome://new-tab-page/*"===r&&(i=false);var t=i?n.De!==c||o.cs.Xe("allBrowserUrls")?2:1:0;return n.os=t,e(),o.me.runtime.lastError}),i},g=function(n){var e,o,r,i,t=n.target,s=l.find(function(n){return n.rs===t});s&&(e=t.checked,s.De!==c&&s.De!==u||(r=(o=s.De===u)?c:u,(i=l.find(function(n){return n.De===r}))&&(o&&e&&!i.rs.checked?i.rs.checked=i.rs.indeterminate=true:!o&&e&&t.indeterminate?t.indeterminate=false:(i.rs.checked=e,i.rs.indeterminate=false))))},w=["downloads"],!o.zn||w.push(u),w.push("cookies"),d=d.filter(function(n){return!w.some(function(e){return"string"==typeof e?n===e:e.test(n)})}),o.c(d.length?_:function(){o.$("#optionalPermissionsBox").style.display="none"})});