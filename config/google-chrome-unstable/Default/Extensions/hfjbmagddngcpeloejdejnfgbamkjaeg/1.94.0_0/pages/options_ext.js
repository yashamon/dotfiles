"use strict";__filename="pages/options_ext.js",define(["require","exports","./async_bg","./options_base","./options_wnd"],function(n,e,o,t,i){function r(n){return new Date(+n-6e4*(new Date).getTimezoneOffset()).toJSON().slice(0,-5).replace("T"," ")}function s(n,e){return e&&("omniBlockList"===n||o.Oo.bo([e]))?"$base64:"+btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(n,e){return String.fromCharCode(parseInt(e,16))})):e}function c(n){return n instanceof Array&&(n=n.join("\n").trimRight()),(n=n.replace(/\r\n?/g,"\n").replace(/\xa0/g," ")).replace(/^\$base64:(.*)/gm,function(n,e){try{return decodeURIComponent([].map.call(atob(e),function(n){return"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)}).join(""))}catch(n){}return n})}function u(n,e,i){var s,u,l,a,f,m,p,g,v,w,b,y,h,S,C,V,O,_,k,j,T=e.environment,x=T&&T.platform||"",A=T&&T.extension&&T.extension+""||"",R=parseFloat(A||0)||0,N=R>1?A.split(".",2).join("."):"",B=R>parseFloat(o.me.runtime.getManifest().version);if(x&&(x=(""+x).slice(0,10)),confirm(t.$i("confirmImport",[t.$i(true!==i?"backupFile":"recommendedFile"),N?t.$i("fileVCVer").replace("*",N):"",(N?t.$i("fileVCVer_2").replace("*",N):"")+(B?t.$i("fileVCNewer"):""),x?t.$i("filePlatform",[t.$i(x)||x[0].toUpperCase()+x.slice(1)]):t.$i("commonPlatform"),n?t.$i("atTime",[r(n)]):t.$i("before")]))){for(v in s=new Date,u=d(s,false),Object.setPrototypeOf(e,null),(l=e.chrome)&&"object"==typeof l&&Object.assign(e,l),null==e.vimSync&&(f=(a=o.cs.Xe("vimSync"))&&confirm(t.$i("keepSyncing")),e.vimSync=f||null,a&&console.log("Before importing: You chose to",f?"keep settings synced.":"stop syncing settings.")),m=function(n,e,o,t){var i=arguments.length>3,r=i?t:o,s=["%s %c%s",n,"color:darkred",e];r="string"!=typeof r||r.length<=72?r:r.slice(0,71).trimRight()+" \u2026",i&&s.push(o),s.push(r),p++,console.log.apply(console,s)},p=0,console.group("Import settings at "+r(+s+1)),n>1e4?console.info("load settings saved at %c%s%c.","color:darkblue",r(n),"color:auto"):console.info("load the settings:",i?"recommended.":"saved before."),(g=function(n){return n.split(/\s+/g).forEach(function(n){return n&&delete e[n]})})("name time environment author description chrome firefox edge safari"),e)"@"===v[0]&&delete e[v];for(w=function(n){var o=e[n];"string"==typeof o&&o.includes("extension://",2)&&(/^(chrome|edge)-/.test(o)?o.startsWith("edge-")&&(e[n]=o.replace("edge-","chrome-")):delete e[n])},w("vomnibarPage"),w("newTabUrl"),b=localStorage,y=o.cs.Ne,h=t.ns.Us,S=b.length;0<=--S;)(v=b.key(S)).includes("|")||v in e||(e[v]=null);for(v in g("findModeRawQueryList innerCSS findCSS omniCSS newTabUrl_f vomnibarPage_f\n      focusNewTabContent dialogMode"),o.cs.Pe)v in e&&(e[o.cs.Pe[v]]=e[v],delete e[v]);for(V in e.vimSync!==o.cs.Xe("vimSync")&&(m("import","vimSync",e.vimSync),o.cs.Ve("vimSync",e.vimSync),h.vimSync.vs()),void 0!==(C=h.keyMappings)&&(delete h.keyMappings,h.keyMappings=C),h)if(_=e[v=(O=h[V]).hs],delete e[v],v in y)if(null==_?_=y[v]:("string"==typeof y[v]&&(_=c(_)),_=O.gs(_,"object"==typeof y[v])),O.ws(O.ds(),_)){if(O.as)continue;O.vs()}else m("import",v,_),o.cs.Ve(v,_),v in o.cs.Le&&t.ns.zs.push(v),O.vs(),O.ps&&O.ps();for(v in e)if(null!=(_=e[v]))"string"==typeof y[v]&&(_=c(_)),v in y?o.cs.Xe(v)!==_&&(o.cs.Ve(v,_),m("update",v,_)):(b.setItem(v,_),m("save",v,_));else{if(v in y){if(_=y[v],o.cs.Xe(v)!==_){o.cs.Ve(v,_),m("reset",v,_);continue}_=o.cs.Xe(v)}else _=b.getItem(v);b.removeItem(v),m("remove",v,":=",_)}o.$("#saveOptions").onclick(false),o.$("#advancedOptionsButton").getAttribute("aria-checked")!==""+o.cs.Xe("showAdvancedOptions")&&o.$("#advancedOptionsButton").onclick(null,true),p<=0?console.info("no differences found."):u.options>0&&console.info("[message] you may recover old configuration of "+u.options+" options, by open the blob: URL below IN THIS TAB:\n%c"+URL.createObjectURL(u.blob),"color: #15c;"),console.info("import settings: finished."),console.groupEnd(),(j=(k=window.VApi&&VApi.y().r)&&k.querySelector("#HCls"))&&(j.click(),o.$("#showCommands").click()),window.VApi&&VApi.t({k:202})}else window.VApi&&VApi.t({k:201})}function l(n,e,i){var r,s,c,l,f,d=null,m=null,p="";try{(r=a(i?e:e.replace(/\xa0/g," ")))instanceof Error?m=r:r?d=r:p=t.$i("notJSON")}catch(n){m=n}return null!=m&&(p=m?(m.message||m)+"":t.$i("exc")+(""!==m?m:t.$i("unknown")),p=(s=/^(\d+):(\d+)$/.exec(p))?t.$i("JSONParseError",[s[1],s[2]]):p),d?(n=+new Date(d.time||("object"==typeof n?+n:n))||0,"Vimium C"!==d.name&&"Vimium++"!==d.name||n<1e4&&n>0?(p=t.$i("notVCJSON"),alert(p)):(c=t.ns.Us.keyMappings._s?Promise.resolve():o.import2("./options_checker.js"),l=n,f=d,void c.then(function(){setTimeout(u,17,l,f,i)}))):alert(p)}function a(n){function e(){return/a?/.test("")}function o(n){for(var e=n.length;i.length<e;i+=i);return i.slice(0,e)}var t,i,r,s,c,u,l;if(!n||!(n=n.trimRight()))return null;i=" ";try{return r=JSON.parse(n.replace(/"(?:\\[^\r\n]|[^"\\\r\n])*"|'(?:\\[^\r\n]|[^'\\\r\n])*'|(?:\/\/|#)[^\r\n]*|\/\*[^]*?\*\//g,function(n){var e=n[0];return"/"===e||"#"===e?n.startsWith("/*")?n.replace(/[^\r\n]+/g,o):o(n):n})),e(),r}catch(n){if(t=/\b(?:position (\d+)|line (\d+) column (\d+))/.exec(n+""),e(),!t||!t[0])throw n}return t[2]?(s=+t[2],c=+t[3]):+t[1]>0?(u=n.includes("\r")?n.includes("\r\n")?"\r\n":"\r":"\n",c=(l=n.slice(0,+t[1]).split(u))[(s=l.length)-1].length+1):s=c=1,new SyntaxError(s+":"+c)}var f,d,m,p,g;Object.defineProperty(e,"__esModule",{value:true}),o.$("#showCommands").onclick=function n(e){var o,t,r;if(window.VApi&&VApi.z){if(t=VApi.y().r,e&&e.preventDefault(),t&&(o=t.querySelector("#HCls"))&&(r=null!=t.querySelector(".HelpCommandName"),i.click(o),r))return;VApi.p({H:12}),e||setTimeout(function(){var n=VApi.y(),e=n.r&&n.r.querySelector("#HDlg");e&&e.querySelector("#HCls").addEventListener("click",function(){location.hash=""},true)},100)}else"undefined"!=typeof VimiumInjector&&setTimeout(n,120,null)},t.is.prototype.Vo=function(n){var e,o,i,r,s,c;if(!n||!this.Hr){for(s of(o=/^([:^]?[a-z\-?*]+:\/\/)?((?:[^\/]|\/])+)(\/[^\]].*|\/?$)/,e=this.bs()))(r=o.exec(i=s.pattern.replace("(?:[^./]+\\.)*?","*.")))&&r[1]&&r[2]&&(i=r[3]?r[3].replace(/\\\./g,"."):"",(r=r[2].replace(/\\\./g,".").split(".")).reverse(),i=r.join(".")+i),s.la=i;e.sort(function(n,e){return n.la<e.la?-1:n.la===e.la?0:1}),this.ys(e),this.fs(),n&&(c=this,this.Hr=setTimeout(function(n,e){n.firstChild.data=e,c.Hr=0},1e3,n,n.firstChild.data),n.firstChild.data=t.$i("o3_2"))}},o.$("#exclusionSortButton").onclick=function(){t.ns.Us.exclusionRules.Vo(this)},f="",window.addEventListener("unload",function(){f&&URL.revokeObjectURL(f)}),d=function(n,e){var t,r,c,u,l,a,f,d,m,p=Object.create(null);for(p.name="Vimium C",e||(p["@time"]=n.toLocaleString(),p.time=n.getTime()),t=o.me.runtime.getManifest(),p.environment={extension:t.version,platform:i.mt},p.environment.chrome=o.Un,r=[],c=localStorage,u=o.cs.Ne,l=0,a=c.length;l<a;l++)(f=c.key(l)).includes("|")||f.endsWith("_f")||"findModeRawQueryList"===f||f.endsWith("CSS")||r.push(f);for(f of(r.sort(),d=function(n){var e=c.getItem(n);"string"!=typeof u[n]?p[n]=n in u?o.cs.Xe(n):e:e.includes("\n")?(p[n]=e.split("\n")).push(""):p[n]=e,"string"==typeof u[n]&&(p[n]="string"==typeof p[n]?s(n,p[n]):p[n].map(function(e){return s(n,e)}))},r))d(f);return m=JSON.stringify(p,null,"\t")+"\n","win"===p.environment.platform&&(m=m.replace(/\n/g,"\r\n")),{blob:new Blob([m],{type:"application/json",endings:"native"}),options:r.length}},o.$("#exportButton").onclick=function(n){var e,o,t,s,c,u;f&&(URL.revokeObjectURL(f),f=""),e=new Date,t=d(e,o=!!n&&(n.ctrlKey||n.metaKey||n.shiftKey)).blob,s=r(e),c="vimium_c-",c+=o?"settings":s.replace(/[\-:]/g,"").replace(" ","_"),c+=".json",(u=document.createElement("a")).download=c,u.href=URL.createObjectURL(t),i.click(u),f=u.href,console.info("EXPORT settings to %c%s%c at %c%s%c.","color:darkred",c,"color:auto","color:darkblue",s,"color:auto")},(m=o.$("#settingsFile")).onclick=null,m.onchange=function(){var n,e,o,i=this.files[0];this.value="",i&&(n=t.ns.Us.vimSync.os?102400:10485760,i.size&&i.size>n?alert(t.$i("JSONTooLarge",[i.name,n/1024])):(e=new FileReader,o=i.lastModified||i.lastModifiedDate||0,e.onload=function(){return l(o,this.result,false)},e.readAsText(i)))},(m=o.$("#importOptions")).onclick=null,m.onchange=function(){o.$("#importButton").focus(),"exported"!==this.value?fetch("../settings-template.json").then(function(n){return n.text()}).then(function(n){return l(0,n,true)}):i.click(o.$("#settingsFile"))},m=null,i.delayed_task&&(g=i.delayed_task,i.clear_delayed_task(),(p=o.$(g[0])).onclick&&p.onclick(g[1]))});