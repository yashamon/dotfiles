"use strict";__filename="pages/show.js",define(["require","exports","./async_bg"],function(n,e,t){function i(){var n,i,u,a,c,h,g,w,p,b,v,y,I;for(B&&(x(),M.style.display="none",B.remove(),B=null),VData=window.VData=Object.create(null),n=location.hash,i="",u="",N||!n&&t.Oo&&(a=t.Oo.C())?(n=N||a,N="",/^[^:]+[ &]data:/i.test(n)&&(F=-1),c=C(n,F=F||Math.floor(4294967296*Math.random())||3286711320,true),history.state?history.pushState(c,"",""):history.replaceState(c,"",""),window.name=""+F):n||!history.state||(F?(n=C(history.state,F,false),window.name=""+F):history.replaceState(null,"","")),VData.full=n,n.length<3||(n.startsWith("#!image")?(n=n.slice(7),i="image"):n.startsWith("#!url")&&(n=n.slice(5),i="url")),n=n.startsWith("%20")?n.slice(3):n.trim(),h=0;h=n.indexOf("&")+1;n=n.slice(h))if(w=(g=n.slice(0,h).indexOf("="))>0?n.slice(0,g):"",p=g>0?n.slice(g+1,h-1):"","download"===w)u=(u=l(p).split(/\||\uff5c| [-\xb7] /,1)[0].trim()).replace(/[\r\n"]/g,""),VData.file=u;else if(p=p.toLowerCase(),"auto"===w)VData.auto="once"===p?p:"true"===p||"false"!==p&&parseInt(p,10)>0;else if("pixel"===w)VData.pixel="1"===p||"true"===p;else{if("incognito"!==w)break;VData.incognito="true"===p||"false"!==p&&parseInt(p,10)>0}switch((n=l(n,n.includes(":")||n.includes("/")?decodeURI:null).trim())?n.toLowerCase().startsWith("javascript:")?i=n=u=VData.file="":t.Ns?(b=t.Oo.Ee(n,null,-2),t.Oo._e()<=2&&(n=b)):n.startsWith("//")?n="http:"+n:/^([-.\dA-Za-z]+|\[[\dA-Fa-f:]+])(:\d{2,5})?\//.test(n)&&(n="http://"+n):"image"===i&&(i=""),VData.type=i,/^data:/i.test(n)&&(n="data:"+n.slice(5)),VData.url=VData.original=n,i){case"image":VData.auto&&(v=R(n))&&(console.log("Auto predict a better URL:\n %o =>\n %o",n,v),n=VData.url=v),(B=f("shownImage")).onerror=function(){VData.url!==VData.original&&VData.url?A():(T(),VData.auto=false,this.onerror=this.onload=null,this.alt=VData.error=e.Io("failInLoading"),t.Un>=60&&this.classList.add("broken"),setTimeout(r,34),this.onclick=function(n){t.Ns&&t.Oo.du(VData.url)||(n.ctrlKey||n.shiftKey||n.altKey||!t.me.tabs||!t.me.tabs.update?o({target:"_top"},n):t.me.tabs.update({url:VData.url}))})},/[:.]/.test(n)?(B.onclick=s,B.onload=function(){var n,e,i,o,u,a,c,l,s,d=this.naturalWidth,m=this.naturalHeight;if(d<12&&m<12){if(VData.auto)return void A();if(d<2&&m<2)return console.log("The image is too small to see."),void this.onerror(null)}if(VData.original=VData.url,T(),((e=(n=VData.url.slice(0,6).toLowerCase()).startsWith("blob:"))||n.startsWith("data:")&&!this.src.startsWith("data"))&&(M.dataset.vimUrl=VData.original=VData.url=this.src,j(e?0:1)),this.onerror=this.onload=null,this.src.startsWith("blob:")||setTimeout(function(){B.src=B.src},0),r(),this.classList.add("zoom-in"),VData.pixel&&(z.classList.add("pixel"),i=devicePixelRatio,d>innerWidth*i*.9&&m>innerHeight*i*.9)){for((o=f("snapshot-banner",true)).querySelector(".banner-close").onclick=function(){o.remove()},u=o.querySelectorAll("[data-i]"),a=0;a<u.length;a++)l=(c=u[a].dataset.i).endsWith("-t"),(s=t.us(l?c.slice(0,-2):c))&&(l?u[a].title=s:u[a].textContent=s);z.insertBefore(o,z.firstChild)}d>=.9*innerWidth&&z.classList.add("filled")},_(n,B)):(n=VData.url="",B.onerror(null),B.alt=VData.error=e.Io("none")),u&&(VData.file=u=k(u)||u,(y=u.split(/[/\\]+/)).length>1&&B.setAttribute("download",y[y.length-1]),B.alt=u,B.setAttribute("aria-title",u));break;case"url":if(B=f("shownText"),n&&t.Ns){if(I=null,n.startsWith("vimium://")&&(I=t.Oo.S(n.slice(9),1,true)),"string"==typeof(I=null!==I?I:t.Oo.Ee(n,null,-1)))I=t.Oo.Ue(I,"whole"),I=t.Oo.pe(I);else{if(I instanceof t.Ns.Promise){I.then(function(n){m(n[1],n[0]||n[2]||"")});break}if(I instanceof t.Ns.Array){m(I[1],I[0]);break}}n=I}"string"==typeof n&&(n=L(n)||n),m(i,n);break;default:n="",(B=f("shownImage")).src="../icons/icon128.png",M.style.display="none"}M.dataset.vimUrl=n,u?(M.dataset.vimText=u,M.download=u):(M.removeAttribute("data-vim-text"),M.removeAttribute("download")),M.onclick=B?d:s}function r(){var n=B.scrollWidth;M.style.height=B.scrollHeight+"px",M.style.width=n+"px",M.style.display=""}function o(n,e){var t,i;if(e.preventDefault(),VData.url){for(i in t=document.createElement("a"),Object.setPrototypeOf(n,null),n)t.setAttribute(i,n[i]);t.href=VData.url,u(t,e)}}function u(n,e){var t=document.createEvent("MouseEvents");return t.initMouseEvent("click",true,true,window,1,0,0,0,0,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,0,null),n.dispatchEvent(t)}function a(n){var e,t,i,r,o,a,l;if(VData.error)return false;if(e=n.keyCode,"space"===(i=(t=window.VApi&&VApi.z?VApi.m({c:" ",e:n,i:e},8):32===e?"space":13===e?"enter":"").slice(t.lastIndexOf("-")+1)||t&&"-")||"enter"===i)return VData.pixel&&(o=(r=document.activeElement)&&document.querySelector("#snapshot-banner"))&&o.contains(r)?((a=o.querySelector(".banner-close")).contains(r)&&a.onclick(null),true):(n.preventDefault(),"enter"===i&&V&&V.isShown&&!V.hiding&&!V.played?V.play(true):V&&V.isShown&&!V.hiding||u(B,n),true);switch(l=0,t){case"c-=":case"m-=":case"+":case"=":case"up":l=1;break;case"left":l=-2;break;case"right":l=2;break;case"c--":case"m--":case"-":case"down":l=-1;break;default:return false}return n.preventDefault(),n.stopImmediatePropagation(),V&&V.viewed?c(V,l):v().then(y).then(function(n){c(n,l)}).catch(b),true}function c(n,e){2===e||-2===e?n.rotate(45*e):n.zoom(e/10,true)}function l(n,e){try{n=(e||decodeURIComponent)(n)}catch(n){}return n}function f(n,e){var i=t.$("#bodyTemplate"),r=document.importNode(i.content.querySelector("#"+n),true);return e||document.body.insertBefore(r,i),r}function s(n){if(n.altKey)return n.stopImmediatePropagation(),o({download:VData.file||""},n);switch(VData.type){case"url":o({target:"_blank"},n);break;case"image":if(VData.error)return;var e=n.ctrlKey||n.metaKey;v().then(function(n){return y(n,e)}).catch(b)}}function d(n){n.preventDefault(),B.onclick&&B.onclick(n)}function m(n,i){n="number"==typeof n?["math","copy","search","ERROR","status","paste","run","url"][n]:n,t.$("#textTip").dataset.text=e.Io("t_"+n)||n,t.$(".colon").dataset.colon=e.Io("colon")+e.Io("NS");var o=t.$("#textBody");return i?(o.textContent="string"!=typeof i?i.join(" "):i,B.onclick=h):o.classList.add("null"),r()}function h(n){var e,i=getSelection(),r=""+i;if(!r||"image"===VData.type&&r.trim()===B.alt.trim()){if("image"===VData.type&&VData.url){if("Range"===i.type&&!VData.url.startsWith(location.protocol))return;if(n.preventDefault(),(e=navigator.clipboard)&&e.write)return void(null!=G?Promise.resolve(G):fetch(VData.url,{cache:"force-cache",referrer:"no-referrer"}).then(function(n){return n.blob()}).catch(function(){return g(VData.url),0}).then(function(n){return G=n})).then(function(n){var i,r,o;if(n)return i={"image/png":new Blob([n],{type:"image/png"}),"text/html":new Blob,"text/plain":new Blob([VData.url],{type:"text/plain"})},r=function(){return e.write([new ClipboardItem(i)])},t.Un<86?r():((o=document.createElement("img")).src=VData.url,VData.file&&o.setAttribute("aria-title",o.alt=VData.file),i["text/html"]=new Blob([o.outerHTML],{type:"text/html"}),r().catch(function(){return delete i["text/html"],r()}))}).catch(function(n){console.log(n),g(VData.url)})}g("url"===VData.type?t.$("#textBody").textContent:VData.url,n)}}function g(n,e){n&&window.VApi&&(e&&e.preventDefault(),VApi.p({H:16,s:n}))}function w(n){"image"===VData.type&&(VData.error||V&&V.isShown&&!V.hiding?n.preventDefault():B.classList.toggle("invert"))}function p(n){if(!t.$('link[href="'+n+'"]')){var e=document.createElement("link");e.rel="stylesheet",e.href=n,document.head.insertBefore(e,t.$('link[href$="show.css"]'))}}function b(n){n&&console.log("%o",n)}function v(){return $?Promise.resolve($):(p("../lib/viewer.min.css"),t.import2("../lib/viewer.min.js").then(function(n){return(n=n&&"function"==typeof n?n:window.Viewer).setDefaults({navbar:false,shown:function(){M.style.display="none"},viewed:function(){P&&P(true)},hide:function(){M.style.display="",P&&P(false)}}),$=n,n}))}function y(n,e){var t,i=scrollX||scrollY,r=getSelection();return"Range"===r.type&&r.collapseToStart(),(t=V=V||new n(B)).scrollbarWidth=0,t.hiding&&(t.isShown=false),t.isShown||t.show(),t.hiding=false,i&&scrollTo(0,0),t.viewed?(t.zoomTo(1),t):(Object.defineProperty(t,"initialImageData",{configurable:true,enumerable:true,get:function(){return q},set:function(n){var t,i,r,o;q=n,V&&!e&&(e=true,o=(r=1*(t=V.imageData).naturalHeight)-t.height,t.left-=((i=1*t.naturalWidth)-t.width)/2,t.top-=o/2,t.width=i,t.height=r,t.ratio=1)}}),new Promise(function(n,e){P=function(i){P=null,i?n(t):e("failed to view the image")}}))}function x(){if(I(),G=null,Z&&(Z(),Z=null),"image"===VData.type){var n=document.body.classList;B.classList.remove("svg"),n.remove("pixel"),n.remove("filled"),B.removeAttribute("src"),B.onerror=B.onload=null,V&&(V.destroy(),V=null)}}function R(n){function e(n){try{return new URL(n)}catch(n){}return null}function i(n){try{n=decodeURIComponent(n||"")}catch(n){}return n}var r,o,u,a,c,l,f,s,d,m,h,g,w,p,b,v,y=n;if(!(r=e(n=t.Ns&&t.Oo.P(n,256)||n))||!/^(ht|s?f)tp/i.test(r.protocol))return null;if(o=r.origin,u=r.pathname,(a=r.search).length>10)for(c of a.slice(1).split("&")){if(l=c.split("=",1)[0],(s=f=c.slice(l.length+1)).length>7)if(!s.includes("://")&&/%(?:3[aA]|2[fF])/.test(s)&&(s=i(s).trim()),s.includes("/")&&null!=e(s)){if(/^(?:imgurl|mediaurl|objurl|origin(?:al)?|real\w*|src|url)$/i.test(l))return s;if(d=s.split("?")[0].split("/"),H.test(d[d.length-1])&&!/\bthumb/i.test(l))return s}else if("id"===l&&/&w=\d{2,4}&h=\d{2,4}/.test(a))return o+u+"?id="+f;if("name"===l&&/^(\d{2,4}x\d{2,4}|small)$/i.test(f)&&a.toLowerCase().includes("format="))return o+u+a.replace(s,"large")}if(m=null,(m=/[?&]s=\d{2,4}(&|$)/.exec(a))&&a.split("=").length<=3)return o+u;if(h=(a=u).lastIndexOf("/")+1,p=null,w=(g=(a=a.slice(h)).lastIndexOf("@")+1||a.lastIndexOf("!")+1)>2||H.test(a)){for(h+=g,a=a.slice(g),b=/(?:[.\-_]|\b)(?:[1-9]\d{2,3}[a-z]{1,3}[_\-]?|[1-9]\d?[a-z][_\-]?|0[a-z][_\-]?|[1-9]\d{1,3}[_\-]|[1-9]\d{1,2}(?=[.\-_]|\b)){2,6}(?=[.\-_]|\b)/gi;p=b.exec(a);m=p);m&&/.[_\-].|\d\dx\d/i.test(m[0])?(p=H.exec(a.slice(m.index+m[0].length)),v=m[0].length,p&&0===p.index&&(v+=p[0].length),a=u.slice((h+=m.index)+v),/[@!]$/.test(a||u.charAt(h-1))?a?a=a.slice(0,-1):h--:a||!p||0!==p.index||H.test(u.slice(Math.max(0,h-6),h))||(a=p[0])):(m=/\b([\da-f]{8,48})([_-](?:[a-z]{1,2}|\d{3,4}[whp]?))\.[a-z]{2,4}$/.exec(a))?(h+=m.index+m[1].length,a=a.slice(m.index+m[1].length+m[2].length)):w=false}return w||g>2?w=w||0:(m=/_(0x)?[1-9]\d{2,3}([whp]|x0)?\./.exec(a))?a=a.slice(0,m.index)+a.slice(m.index+m[0].length-1):a.startsWith("thumb_")?a=a.slice(6):/^[1-9]\d+$/.test(a)&&+a>0&&+a<640?(h--,a=""):H.test(a)&&/^\/(small|(thumb|mw|orj)[1-9]\d{2,3})\//.test(u)?(w=true,a="/large"+u.slice(u.indexOf("/",1)),h=0):w=0,0!==w?o+u.slice(0,h)+a:y!==n?n:null}function k(n){var e,t,i,r;if(n&&!/.\.[a-z]{3,4}\b/i.test(n)){if(e=H.exec(VData.url))return n+e[0];if((t=G?G.type.toLowerCase():"").startsWith("image/"))for(r in i={jpeg:"jpg",png:0,bmp:0,svg:0,gif:0,tif:0,ico:0})if(i.hasOwnProperty(r)&&t.includes(r))return i[r]||"."+r}}function _(n,i){var r,o,u,a,c=new Text,l=Z=function(){i.removeEventListener("load",l),i.removeEventListener("error",l),clearTimeout(a),c.remove(),Z===l&&(Z=null)};i.addEventListener("load",l,true),i.addEventListener("error",l,true),o=(r=n.slice(0,20).toLowerCase()).startsWith("blob:"),(u=r.startsWith("data:"))&&r.startsWith("data:image/svg+xml,")&&i.classList.add("svg"),o||u&&!(n.length<1e4)||(VData.incognito||t.cs.Xe("showInIncognito"))&&/^(ht|s?f)tp|^data:/.test(r)&&"cache"in Request.prototype?(I(),z.replaceChild(c,i),Promise.resolve(S[n]||(t.Un<48?new Promise(function(e,t){var i=new XMLHttpRequest;i.responseType="blob",i.onload=function(){e(this.response)},i.onerror=function(n){t("Error: "+n.message)},i.open("GET",n,true),i.send()}):fetch(n,o||u?{}:{cache:"no-store",referrer:"no-referrer"}).then(function(n){return n.blob()}))).then(function(e){return S[n]=e,O=URL.createObjectURL(G=e)},function(){return n}).then(function(n){i.src=n,c.parentNode?z.replaceChild(i,c):z.appendChild(i)})):i.src=n,a=setTimeout(function(){!i.parentNode||i.scrollHeight>=24||i.scrollWidth>=80?l():c.parentNode||(z.insertBefore(c,i),c.data=e.Io("loading"))},400)}function I(){O&&(URL.revokeObjectURL(O),O="")}function L(n){var e=n.split(":",1)[0];switch(e.toLowerCase()){case"thunder":case"flashget":case"qqdl":n=n.slice(e.length+3).split("&",1)[0];break;default:return""}try{n=atob(n)}catch(n){return""}return n.startsWith("AA")&&n.endsWith("ZZ")&&(n=n.slice(2,-2)),n.startsWith("[FLASHGET]")&&n.endsWith("[FLASHGET]")&&(n=n.slice(10,-10)),L(n)||n}function A(){console.log("Failed to visit the predicted URL, so go back to the original version."),T(),VData.auto=false,i()}function T(){var n=false;return"once"===VData.auto&&(VData.auto=false,n=true),n&&j(),n}function j(n){var e,t,i=VData.type;i&&(e="#!"+i+" "+(VData.incognito?"incognito=1&":"")+(VData.file?"download="+U(VData.file)+"&":"")+(VData.auto?"auto="+("once"===VData.auto?"once":1)+"&":"")+(VData.pixel?"pixel=1&":"")+VData.original,VData.full=e,n||(t=C(e,F,true),history.replaceState(t,"","")))}function U(n){return n.replace(t.Un<64||false?/[\x00-`{-\u0390\u03ca-\u4dff\u9fa6-\uffff\s]+/g:new RegExp("[^\\p{L}\\p{N}]+","ug"),encodeURIComponent)}function C(n,e,t){var i,r,o;if(-1===e)return n;if(i=[],t)n=encodeURIComponent(n);else try{n=atob(n)}catch(e){n=""}for(r of n)i.push(r.charCodeAt(0));for(o=0;o<i.length;o++)i[o]=255&(i[o]^e>>>8*(3&o));if(n=String.fromCharCode.apply(String,i),t)n=btoa(n);else try{n=decodeURIComponent(n)}catch(e){n=""}return n}function E(){return VData&&VData.full?location.href.split("#",1)[0]+VData.full:location.href}var VData,S,z,$,B,M,P,V,q,F,H,O,G,Z,N;Object.defineProperty(e,"__esModule",{value:true}),e.Io=void 0,VData=null,S={},z=document.body,B=null,M=t.$("#bgLink"),P=null,V=null,q=null,F=+window.name||0,H=/\.(avif|bmp|gif|icon?|jpe?g|a?png|tiff?|webp)(?=[.\-_]|\b)/i,O="",G=null,e.Io=function(n,e){return t.us(n,e)||""},t.Ao(1),t.c(function(){window.onhashchange=i,window.onpopstate=i,i()}),addEventListener("VimiumC",function n(){removeEventListener("VimiumC",n,{capture:true}),window.VApi&&(VApi.u=E)},{once:true,capture:true}),window.onunload=I,z.ondrop=function(n){var e,t,r=n.dataTransfer.files;1===r.length&&(t=(e=r.item(0)).name,(e.type.startsWith("image/")||H.test(t))&&(n.preventDefault(),N="#!image download="+t+"&"+URL.createObjectURL(e),i()))},z.ondragover=z.ondragenter=function(n){var e=n.dataTransfer.items;1===e.length&&e[0].type.startsWith("image/")&&n.preventDefault()},document.addEventListener("keydown",function(n){if(("image"!==VData.type||!a(n))&&(n.ctrlKey||n.metaKey)&&!n.altKey&&!n.shiftKey&&!n.repeat){var e=String.fromCharCode(n.keyCode);if("S"===e)return o({download:VData.file||""},n);if("C"!==e)return"A"===e?w(n):void 0;h(n)}})});